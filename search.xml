<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>BGP的选路原则</title>
    <url>/2020/10/15/BGP%E7%9A%84%E9%80%89%E8%B7%AF%E5%8E%9F%E5%88%99/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍BGP的13种选路原则。</p>
<a id="more"></a>

<h3 id="扩展团体属性"><a href="#扩展团体属性" class="headerlink" title="扩展团体属性"></a>扩展团体属性</h3><p>&emsp;&emsp;扩展团体属性拥有最高选路优先级。</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">R5(config)#ip prefix-list <span class="number">9</span> permit <span class="number">9.9</span><span class="number">.9</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line">R5(config)#route-map ecomm</span><br><span class="line">R5(config-route-map)#match ip address prefix-list <span class="number">9</span></span><br><span class="line">R5(config-route-map)#<span class="keyword">set</span> extcommunity cost pre-bestpath <span class="number">100</span> <span class="number">20190923</span></span><br><span class="line">R5(config-route-map)#exit                           </span><br><span class="line">R5(config)#route-map ecomm permit <span class="number">20</span></span><br><span class="line">R5(config-route-map)#end</span><br><span class="line">R5(config)#router bgp <span class="number">567</span></span><br><span class="line">R5(config-router)#neighbor <span class="number">192.168</span><span class="number">.15</span><span class="number">.1</span> route-map ecomm <span class="keyword">in</span></span><br><span class="line">R5(config-router)#neighbor <span class="number">7.7</span><span class="number">.7</span><span class="number">.7</span> send-community both </span><br><span class="line">R5(config-router)#end</span><br><span class="line">R7#show ip bgp <span class="number">9.9</span><span class="number">.9</span><span class="number">.0</span>  </span><br><span class="line">BGP routing table entry <span class="keyword">for</span> <span class="number">9.9</span><span class="number">.9</span><span class="number">.0</span>/<span class="number">24</span>, version <span class="number">62</span></span><br><span class="line">Paths: (<span class="number">2</span> available, best #<span class="number">1</span>, table <span class="keyword">default</span>)</span><br><span class="line">  Not advertised to any peer</span><br><span class="line">  Refresh Epoch <span class="number">3</span></span><br><span class="line">  <span class="number">1234</span> <span class="number">900</span></span><br><span class="line">    <span class="number">5.5</span><span class="number">.5</span><span class="number">.5</span> (metric <span class="number">409600</span>) <span class="keyword">from</span> <span class="number">5.5</span><span class="number">.5</span><span class="number">.5</span> (<span class="number">5.5</span><span class="number">.5</span><span class="number">.5</span>)</span><br><span class="line">      Origin IGP, metric <span class="number">0</span>, localpref <span class="number">100</span>, valid, <span class="built_in">int</span>ernal, best</span><br><span class="line">      Extended Community: Cost:pre-bestpath:<span class="number">100</span>:<span class="number">20190923</span> (<span class="keyword">default</span><span class="number">-2127292724</span>)</span><br><span class="line">      rx pathid: <span class="number">0</span>, tx pathid: <span class="number">0x0</span></span><br><span class="line">  Refresh Epoch <span class="number">5</span></span><br><span class="line">  <span class="number">1234</span> <span class="number">900</span></span><br><span class="line">    <span class="number">6.6</span><span class="number">.6</span><span class="number">.6</span> (metric <span class="number">409600</span>) <span class="keyword">from</span> <span class="number">6.6</span><span class="number">.6</span><span class="number">.6</span> (<span class="number">6.6</span><span class="number">.6</span><span class="number">.6</span>)</span><br><span class="line">      Origin IGP, metric <span class="number">0</span>, localpref <span class="number">200</span>, valid, <span class="built_in">int</span>ernal</span><br><span class="line">      rx pathid: <span class="number">0</span>, tx pathid: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="1-权重"><a href="#1-权重" class="headerlink" title="1 权重"></a>1 权重</h3><ul>
<li><p>比较原则及配置注意事项：</p>
<p>—&ensp;Cisco私有<br>—&ensp;可通过关联Route-map或neighbor <em>ip-address</em>的方式进行配置<br>—&ensp;该值无法传递给其他BGP Peer，只能在本地使用<br>—&ensp;只能在in方向做<br>—&ensp;携带的Weight值越大，则该路由越优先<br>—&ensp;本地始发路由的默认值是32768，从其他BGP Peer学习过来的路由的默认值是0</p>
</li>
<li><p>虽然Weight属性是Cisco私有的，但是很多厂商也是内置该属性</p>
</li>
</ul>
<h4 id="1-1-对特定邻居的所有条目设置"><a href="#1-1-对特定邻居的所有条目设置" class="headerlink" title="1.1 对特定邻居的所有条目设置"></a>1.1 对特定邻居的所有条目设置</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R7(config)<span class="comment">#router bgp 567</span></span><br><span class="line">R7(config-router)<span class="comment">#neighbor 6.6.6.6 weight 1</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-对特定邻居的特定条目设置"><a href="#1-2-对特定邻居的特定条目设置" class="headerlink" title="1.2 对特定邻居的特定条目设置"></a>1.2 对特定邻居的特定条目设置</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R7(config)<span class="comment">#access-list 1 permit 9.9.9.0 /24</span></span><br><span class="line">R7(config)<span class="comment">#route-map wei permit 10</span></span><br><span class="line">R7(config-route-map)<span class="comment">#match ip address 1</span></span><br><span class="line">R7(config-route-map)<span class="comment">#set weight 1</span></span><br><span class="line">R7(config-route-map)<span class="comment">#route-map wei permit 20</span></span><br><span class="line">R7(config)<span class="comment">#router bgp 567</span></span><br><span class="line">R7(config-router)<span class="comment">#neighbor 6.6.6.6 route-map wei in</span></span><br><span class="line">R7(config-router)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Local-Preference（本地优先级）"><a href="#2-Local-Preference（本地优先级）" class="headerlink" title="2 Local Preference（本地优先级）"></a>2 Local Preference（本地优先级）</h3><ul>
<li><p>比较原则及配置注意事项：<br>—&ensp;值越大，越优先</p>
<p>—&ensp;缺省，本地始发的和从EBGP Peer接收的路由的LP都为100</p>
<p>—&ensp;Local Preference属性只能在IBGP Peer之间传递，不能在EBGP Peer之间传递，如果在EBGP Peer之间收到的路由的路径属性中携带了Local Preference，则会触发Notifacation报文，造成会话中断</p>
<p>—&ensp;可以用于in/out方向</p>
</li>
<li><p>Local Preference通过如下三种方法进行设置：<br>—&ensp;通过将lGP路由引入BGP时关联Route-map进行设置</p>
<p>—&ensp;针对IBGP Peer应用IN/OUT方向的Route-map，对从Peer接收到的或者通告给Peer的所有或部分路由进行设置</p>
<p>—&ensp;针对EBGP Peer应用IN方向的Route-map，对从Peer接收到的所有或部分路由进行设置</p>
</li>
</ul>
<h4 id="2-1-全局设置"><a href="#2-1-全局设置" class="headerlink" title="2.1 全局设置"></a>2.1 全局设置</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R6(config)#router<span class="built_in"> bgp </span>567</span><br><span class="line">R6(config-router)#bgp<span class="built_in"> default </span>local-preference 200</span><br><span class="line">R6(config-router)#end</span><br></pre></td></tr></table></figure>

<h4 id="2-2-对特定条目设置"><a href="#2-2-对特定条目设置" class="headerlink" title="2.2 对特定条目设置"></a>2.2 对特定条目设置</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R6(config)<span class="comment">#ip prefix-list 9 permit 9.9.9.0/24</span></span><br><span class="line">R6(config)<span class="comment">#route-map LP permit 10</span></span><br><span class="line">R6(config-route-map)<span class="comment">#match ip address prefix-list 9</span></span><br><span class="line">R6(config-route-map)<span class="comment">#set local-preference 200</span></span><br><span class="line">R6(config)<span class="comment">#route-map LP permit 20</span></span><br><span class="line">R6(config)<span class="comment">#router bgp 567</span></span><br><span class="line">R6(config-router)<span class="comment">#neighbor 7.7.7.7 route-map LP out</span></span><br></pre></td></tr></table></figure>

<h3 id="3-本地路由始发方式"><a href="#3-本地路由始发方式" class="headerlink" title="3 本地路由始发方式"></a>3 本地路由始发方式</h3><ul>
<li><p>比较原则及配置注意事项：</p>
<p>—&ensp;该比较原则主要是指本地在进入一条IGP路由进去BGP表时，使用不同的方式比如network或redistribute等，那么这些方式之间是存在优先顺序的：network&gt;redistribute&gt;aggregate</p>
</li>
<li><p>注意，该原则是不会作为BP路由选路策略的</p>
</li>
</ul>
<h3 id="4-AS-Path长度"><a href="#4-AS-Path长度" class="headerlink" title="4 AS-Path长度"></a>4 AS-Path长度</h3><ul>
<li><p>比较原则及配置注意事项：</p>
<p>—&ensp;优选长度小的AS-Path列表</p>
<p>—&ensp;可以使用set as-path prepend命令来添加AS号，该操作只能对EBGP Peer生效，对IBGP Peer无法生效</p>
<p>—&ensp;在做聚合路由时，使用as-set后产生的AS-Path列表中的里的AS号长度只算一个AS号的长度</p>
<p>—&ensp;在联盟内的AS-Path列表中的()的AS号长度不做计算依据</p>
<p>—&ensp;bgp bestpath as-path ignore忽略这条选路原则（隐藏命令)</p>
<p>—&ensp;last-as参数：表示离这个AS最近的AS，重复的次数</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#可能导致追加的AS号与其他AS冲突，导致其AS无法顺利接受路由</span></span><br><span class="line">R8(config)<span class="comment">#route-map aspath</span></span><br><span class="line">R8(config-route-map)<span class="comment">#set as-path prepend  888 999</span></span><br><span class="line"><span class="comment">#将最后一个AS重复累加8次</span></span><br><span class="line">R8(config)<span class="comment">#route-map aspath permit 10</span></span><br><span class="line">R8(config-route-map)<span class="comment">#set as-path prepend last-as 8</span></span><br></pre></td></tr></table></figure>

<h3 id="5-Origin属性（起源代码）"><a href="#5-Origin属性（起源代码）" class="headerlink" title="5 Origin属性（起源代码）"></a>5 Origin属性（起源代码）</h3><ul>
<li><p>比较原则及配置注意事项：</p>
<p>—&ensp;三种不同的Origin属性的优先顺序：IGP&gt;EGP&gt;incomplete</p>
<p>—&ensp;Origin属性会一直在BGP路由中携带</p>
</li>
<li><p>Origin属性配置方法：</p>
<p>—&ensp;将IGP路由引入BGP时关联Route-map进行设置</p>
<p>—&ensp;默认情况下，network方式产生的BGP路由的Origin属性为IGP，而redistribute方式产生的BGP路由的Origin属性为“?”</p>
<p>—&ensp;对BGP Peer应用IN/OUT方向的Route-map进行设置</p>
</li>
<li><p>很少使用设置Origin属性作为BGP路由选路策略</p>
</li>
</ul>
<h3 id="6-MED"><a href="#6-MED" class="headerlink" title="6 MED"></a>6 MED</h3><ul>
<li><p>比较原则及配置注意事项：</p>
<p>—&ensp;MED值越小，越优先</p>
<p>—&ensp;默认情况下，只比较来自同一邻居AS的BGP路由的MED值</p>
<p>—&ensp;告诉EBGP邻居怎么进入本AS</p>
<p>—&ensp;第一个AS号相同，才会比较MED</p>
</li>
<li><p>MED设置方法：</p>
<p>—&ensp;将IGP路由引入BGP时关联Route-map进行设置</p>
<p>—&ensp;对BGP Peer应用IN/OUT方向的Route-map进行设置</p>
</li>
<li><p>非Route-map(自动)方式：</p>
<p>—&ensp;使用network或redistribute方式将IGP路由引入BGP时，MED将继承IGP路由的Metric(直联路由的Metric为0)</p>
<p>一使用aggregate-address方式引入路由，则MED为空</p>
</li>
<li><p>MED为BGP选路策略中经常使用的一个路径属性</p>
</li>
<li><p>本地在将一条BGP路由通告给EBGP Peer时，是否携带MED值，需要根据以下条件进行判断(不对EBGP Peer使用Route-map)：</p>
<p>—&ensp;如果该BGP路由是本地始发(network或redistribute)的，则携带MED值发送给EBGP Peer(如果MED为空，则设置为O)</p>
<p>—&ensp;如果该BGP路由是从其他BGP Peer学习过来的，那么将该路由通告给EBGP Peer时不携带MED</p>
</li>
<li><p>本地在将一条BGP路由通告给IBGP Peer时，一定会携带MED值</p>
<p>—&ensp;如果接收或产生的路由的MED为空，那么在向IBGP Peer通告时，将MED设置为0</p>
</li>
</ul>
<h3 id="7-EBGP优先于IBGP"><a href="#7-EBGP优先于IBGP" class="headerlink" title="7 EBGP优先于IBGP"></a>7 EBGP优先于IBGP</h3><ul>
<li>比较原则：<br>—&ensp;当使用前面六条原则仍无法决定出路由的优先顺序时，会根据EBGP路由优于IBGP路由这条原则进行优选<br>—&ensp;该原则不会做为BGP路由选路策略</li>
</ul>
<h3 id="8-到达Next-hop的代价"><a href="#8-到达Next-hop的代价" class="headerlink" title="8 到达Next-hop的代价"></a>8 到达Next-hop的代价</h3><ul>
<li>比较原则：<br>—&ensp;比较到达BGP路由路径属性中的Next-hop地址的IGP Metric值，越小越优先<br>—&ensp;注，该值与MED没有任何关系<br>—&ensp;几乎很少使用该原则作为BGP路由选路策略</li>
</ul>
<h3 id="9-BGP负载均衡"><a href="#9-BGP负载均衡" class="headerlink" title="9 BGP负载均衡"></a>9 BGP负载均衡</h3><p>&emsp;&emsp;负载均衡，BGP默认不支持负载均衡，若配置负载均衡，则不比较后面的参数(maximum-paths)</p>
<ul>
<li><p>等价负载均衡说明：</p>
<p>—&ensp;当前面的8条选路原则都无法优选出最优路由时，并且在BGP进程下面配置了maximum-paths n，n的取值为2-6，那么将执行等价负载均衡</p>
<p>—&ensp;如果不关联ibgp关键字，那么只会对EBGP路由执行等价负载均衡</p>
<p>—&ensp;如果不配置maximum-paths，那么将进行到下一条选路原则</p>
<p>—&ensp;默认未打开</p>
</li>
<li><p>BGP不等价负载均衡配置</p>
<p>—&ensp;bgp dmzlink-bw(路由进程)</p>
<p>—&ensp;neighbor ip-address dmzlink-bw（路由进程)</p>
<p>—&ensp;ip load-sharing per-packet(接口模式)</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R7(config-router)<span class="comment">#maximum-paths ?</span></span><br><span class="line">  &lt;1-32&gt;  Number of paths</span><br><span class="line">  eibgp   Both eBGP and iBGP paths as multipath</span><br><span class="line">  ibgp    iBGP-multipath</span><br><span class="line">router bgp 800</span><br><span class="line"> bgp <span class="built_in">log</span>-neighbor-changes</span><br><span class="line"> bgp dmzlink-bw</span><br><span class="line"> network 8.8.8.0 mask 255.255.255.0</span><br><span class="line"> neighbor 192.168.28.2 remote-as 1234</span><br><span class="line"> neighbor 192.168.28.2 dmzlink-bw</span><br><span class="line"> neighbor 192.168.48.4 remote-as 1234</span><br><span class="line"> neighbor 192.168.48.4 dmzlink-bw</span><br><span class="line"> maximum-paths 2</span><br></pre></td></tr></table></figure>

<h3 id="10-最老的EBGP路径"><a href="#10-最老的EBGP路径" class="headerlink" title="10 最老的EBGP路径"></a>10 最老的EBGP路径</h3><p>&emsp;&emsp;优先选择最老的路由（即最稳定的路由)，针对EBGP</p>
<h3 id="11-最小BGP-RID路径"><a href="#11-最小BGP-RID路径" class="headerlink" title="11 最小BGP RID路径"></a>11 最小BGP RID路径</h3><p>&emsp;&emsp;选择BGP Router ID小的BGP对等体通告的路由</p>
<h3 id="12-最小cluster-list长度"><a href="#12-最小cluster-list长度" class="headerlink" title="12 最小cluster-list长度"></a>12 最小cluster-list长度</h3><p>&emsp;&emsp;优先选择cluster_list长度短的路由</p>
<h3 id="13-最小邻居IP地址"><a href="#13-最小邻居IP地址" class="headerlink" title="13 最小邻居IP地址"></a>13 最小邻居IP地址</h3><p>&emsp;&emsp;优先选择邻居IP地址最小的路由(neighbor指定的地址)</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>BGP</tag>
        <tag>选路原则</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验一——简单的基础实验</title>
    <url>/2018/10/01/CCNA%E5%AE%9E%E9%AA%8C%E4%B8%80/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍通过 console 口方式登入设备；设备命令行界面的三种模式；通过 Telnet 方式远程登入设备；查看路由器相关信息的基本命令。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>熟练掌握 GNS3 模拟器的安装与使用</p>
</li>
<li><p>掌握 GNS3 与 CRT 的关联</p>
</li>
<li><p>掌握通过 console 口方式登入设备</p>
</li>
<li><p>掌握通过 Telnet 方式远程登入设备</p>
</li>
<li><p>熟悉设备命令行界面的三种模式</p>
</li>
<li><p>熟悉查看路由器相关信息的基本命令</p>
</li>
</ol>
<p>【实验需求】</p>
<ol>
<li>安装并使用 GNS3 模拟器及将 GNS3 与 CRT 关联</li>
<li>路由器不同模式的转换</li>
</ol>
<p>&emsp;&emsp;路由器的三个模式：用户模式**&gt;<strong>、特权模式</strong>#<strong>、全局/配置模式</strong>（config）#**。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用户模式转换为特权模式</span></span><br><span class="line">R1&gt;<span class="built_in">enable</span></span><br><span class="line"><span class="comment">#特权模式转换为全局/配置模式</span></span><br><span class="line">R1<span class="comment">#configure terminal </span></span><br><span class="line">R1(config)<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置关闭域名解析、控制台超时和同步</li>
</ol>
<p>&emsp;&emsp;当配置Cisco设备长时间不进行配置时，就会退出用户模式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#这是在做实验的时候的优化命令时，往往会由于打错命令，造成路由器会自动去向DNS服务器发送域名解析请求，造成耗损路由器CPU，而且解析时间很长而没法继续其他命令。为了加快命令的执行就关闭域名解析功能。在连入公网的路由器上，不需要关于域名解析，可以直接通过输入www.baidu.com去访问百度网站。输入下行命令可关闭域名解析</span></span><br><span class="line">R1(config)<span class="comment">#no ip domain lookup </span></span><br><span class="line"><span class="comment">#当配置Cisco设备长时间不进行配置时，就会退出用户模式。可以进入console口，将控制台超时的时间置为0（永不超时）</span></span><br><span class="line">R1(config)<span class="comment">#line console 0</span></span><br><span class="line">R1(config-line)<span class="comment">#exec-timeout 0</span></span><br><span class="line"><span class="comment">#在实验过程中控制台尝尝或出现一些提示信息，可以输入下行命令关闭日志同步，</span></span><br><span class="line">R1(config-line)<span class="comment">#logging synchronous </span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>设置设备名称</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#hostname Huangzc</span></span><br><span class="line">Huangzc(config)<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看路由器的 IOS 版本，IOS 文件名，flash 大小，flash 可用空间及CPU 的利用率以及接口的简要信息</li>
</ol>
<p>&emsp;&emsp;查看路由器的IOS版本，IOS文件名：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Huangzc<span class="comment">#show version </span></span><br><span class="line">Cisco IOS Software, 3700 Software (C3745-ADVENTERPRISEK9_SNA-M), Version 12.4(25d), RELEASE SOFTWARE (fc1)</span><br><span class="line">Technical Support: http://www.cisco.com/techsupport</span><br><span class="line">Copyright (c) 1986-2010 by Cisco Systems, Inc.</span><br><span class="line">Compiled Wed 18-Aug-10 08:18 by prod_rel_team</span><br><span class="line"></span><br><span class="line">ROM: ROMMON Emulation Microcode</span><br><span class="line">ROM: 3700 Software (C3745-ADVENTERPRISEK9_SNA-M), Version 12.4(25d), RELEASE SOFTWARE (fc1)</span><br><span class="line"></span><br><span class="line">Huangzc uptime is 21 minutes</span><br><span class="line">System returned to ROM by unknown reload cause - suspect boot_data[BOOT_COUNT] 0x0, BOOT_COUNT 0, BOOTDATA 19</span><br><span class="line">System image file is <span class="string">&quot;tftp://255.255.255.255/unknown&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This product contains cryptographic features and is subject to United</span><br><span class="line">States and <span class="built_in">local</span> country laws governing import, <span class="built_in">export</span>, transfer and</span><br><span class="line">use. Delivery of Cisco cryptographic products does not imply</span><br><span class="line">third-party authority to import, <span class="built_in">export</span>, distribute or use encryption.</span><br><span class="line">Importers, exporters, distributors and users are responsible <span class="keyword">for</span></span><br><span class="line">compliance with U.S. and <span class="built_in">local</span> country laws. By using this product you</span><br><span class="line">agree to comply with applicable laws and regulations. If you are unable</span><br><span class="line">to comply with U.S. and <span class="built_in">local</span> laws, <span class="built_in">return</span> this product immediately.</span><br><span class="line"></span><br><span class="line">A summary of U.S. laws governing Cisco cryptographic products may be found at:</span><br><span class="line">http://www.cisco.com/wwl/<span class="built_in">export</span>/crypto/tool/stqrg.html</span><br><span class="line"></span><br><span class="line">If you require further assistance please contact us by sending email to</span><br><span class="line"><span class="built_in">export</span>@cisco.com.</span><br><span class="line"></span><br><span class="line">Cisco 3745 (R7000) processor (revision 2.0) with 249856K/12288K bytes of memory.</span><br><span class="line">Processor board ID FTX0945W0MY</span><br><span class="line">R7000 CPU at 350MHz, Implementation 39, Rev 2.1, 256KB L2, 512KB L3 Cache</span><br><span class="line">18 FastEthernet interfaces</span><br><span class="line">8 Serial interfaces</span><br><span class="line">1 Serial(sync/async) interface</span><br><span class="line">DRAM configuration is 64 bits wide with parity enabled.</span><br><span class="line">151K bytes of NVRAM.</span><br><span class="line"></span><br><span class="line">Configuration register is 0x2102</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看CPU 的利用率：</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">Huangzc#show processes cpu </span><br><span class="line">CPU utilization <span class="keyword">for</span> five seconds: <span class="number">0</span>%/<span class="number">0</span>%; one minute: <span class="number">0</span>%; five minutes: <span class="number">0</span>%</span><br><span class="line"> PID Runtime(ms)   Invoked      uSecs   <span class="number">5</span>Sec   <span class="number">1</span>Min   <span class="number">5</span>Min TTY Process </span><br><span class="line">   <span class="number">1</span>           <span class="number">4</span>         <span class="number">5</span>        <span class="number">800</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Chunk Manager    </span><br><span class="line">   <span class="number">2</span>           <span class="number">4</span>       <span class="number">284</span>         <span class="number">14</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Load Meter       </span><br><span class="line">   <span class="number">3</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> chkpt message ha </span><br><span class="line">   <span class="number">4</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> EDDRI_MAIN       </span><br><span class="line">   <span class="number">5</span>         <span class="number">296</span>       <span class="number">145</span>       <span class="number">2041</span>  <span class="number">0.00</span>%  <span class="number">0.01</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Check heaps      </span><br><span class="line">   <span class="number">6</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Pool Manager     </span><br><span class="line">   <span class="number">7</span>           <span class="number">0</span>         <span class="number">2</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Timers           </span><br><span class="line">   <span class="number">8</span>           <span class="number">0</span>        <span class="number">24</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC Dynamic Cach </span><br><span class="line">   <span class="number">9</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC Zone Manager </span><br><span class="line">  <span class="number">10</span>           <span class="number">0</span>      <span class="number">1417</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC Periodic Tim </span><br><span class="line">  <span class="number">11</span>           <span class="number">0</span>      <span class="number">1417</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC Deferred Por </span><br><span class="line">  <span class="number">12</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC Seat Manager </span><br><span class="line">  <span class="number">13</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> IPC BackPressure </span><br><span class="line">  <span class="number">14</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> OIR Handler      </span><br><span class="line">  <span class="number">15</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Crash writer     </span><br><span class="line">  <span class="number">16</span>           <span class="number">4</span>        <span class="number">49</span>         <span class="number">81</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Environmental mo </span><br><span class="line">  <span class="number">17</span>          <span class="number">12</span>        <span class="number">28</span>        <span class="number">428</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> ARP Input        </span><br><span class="line">  <span class="number">18</span>           <span class="number">0</span>         <span class="number">2</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> ATM Idle Timer   </span><br><span class="line">  <span class="number">19</span>           <span class="number">0</span>         <span class="number">2</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> AAA high-capacit </span><br><span class="line">  <span class="number">20</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> AAA_SERVER_DEADT </span><br><span class="line">  <span class="number">21</span>           <span class="number">0</span>         <span class="number">1</span>          <span class="number">0</span>  <span class="number">0.00</span>%  <span class="number">0.00</span>%  <span class="number">0.00</span>%   <span class="number">0</span> Policy Manager  </span><br><span class="line">  --more--</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看接口的简要信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Huangzc<span class="comment">#show ip interface brief </span></span><br><span class="line">Interface                  IP-Address      OK? Method Status                Protocol</span><br><span class="line">FastEthernet0/0            unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial0/0                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">FastEthernet0/1            unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial1/0                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial1/1                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial1/2                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial1/3                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial2/0                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial2/1                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial2/2                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">Serial2/3                  unassigned      YES <span class="built_in">unset</span>  administratively down down    </span><br><span class="line">FastEthernet3/0            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/1            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/2            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/3            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/4            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/5            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/6            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/7            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/8            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/9            unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/10           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/11           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/12           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/13           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/14           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">FastEthernet3/15           unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br><span class="line">Vlan1                      unassigned      YES <span class="built_in">unset</span>  up                    down    </span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;受实验环境所限，flash信息暂时无法查看</p>
<ol start="6">
<li>路由器的安全加固：console 口加密和进入特权模式的加密</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置console口的密码，并应用</span></span><br><span class="line">Huangzc(config)<span class="comment">#line console 0</span></span><br><span class="line">Huangzc(config-line)<span class="comment">#password 123</span></span><br><span class="line">Huangzc(config-line)<span class="comment">#login</span></span><br><span class="line"><span class="comment">#配置进入特权模式的密码（明文）</span></span><br><span class="line">Huangzc(config)<span class="comment">#enable password 456</span></span><br><span class="line"><span class="comment">#配置进入特权模式的密码（密文），若两者都启用的话，则明文不生效</span></span><br><span class="line">Huangzc(config)<span class="comment">#enable secret 789</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/22/wOvXwV.png"></p>
<ol start="7">
<li>使用 Telnet 远程登入设备</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Huangzc(config)<span class="comment">#line vty 0 4</span></span><br><span class="line">Huangzc(config-line)<span class="comment">#password 123456</span></span><br><span class="line">Huangzc(config-line)<span class="comment">#transport input telnet </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/22/wOvjoT.png"></p>
<ol start="8">
<li>了解 DTE 和 DCE 的区别以及 DCE 的时钟频率设置</li>
</ol>
<p>① 意思不同</p>
<p>&emsp;&emsp;DCE的意思是数据通信设备或者数据电路终端设备，该设备和其与通信网络的连接构成了网络终端的用户网络接口。DTE的意思是数据终端设备，指的是位于用户网络接口用户端的设备。</p>
<p>② 作用不同</p>
<p>&emsp;&emsp;DCE提供了到网络的一条物理连接、转发业务量，并且提供了一个用于同步DCE设备和DTE设备之间数据传输的时钟信号。调制解调器和接口卡都是DCE设备的例子。</p>
<p>&emsp;&emsp;DTE它能够作为信源、信宿或同时为二者。数据终端设备通过数据通信设备连接到一个数据网络上，并且通常使用数据通信设备产生的时钟信号。</p>
<p>③用法和功能不同</p>
<p>&emsp;&emsp;DTE与DCE比较Data Communications Equipment（数据通讯设备）的首字母缩略词DCE，它在DTE和传输线路之间提供信号变换和编码功能，并负责建立、保持和释放链路的连接，如 Modem。DCE设备通常是与DTE对接，因此针脚的分配相反，也就是2是接收，3是发送。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Huangzc(config)<span class="comment">#int s1/0</span></span><br><span class="line">Huangzc(config-if)<span class="comment">#clock rate 1000</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li>查看当前的配置信息以及保存配置文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看当前的配置信息</span></span><br><span class="line">R1<span class="comment">#show running-config </span></span><br><span class="line"><span class="comment">#保存配置文件</span></span><br><span class="line">R1<span class="comment">#write </span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>基础配置</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验七——STP 的运用</title>
    <url>/2018/10/13/CCNA%E5%AE%9E%E9%AA%8C%E4%B8%83/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 STP 的作用； STP 的工作原理； STP 的查看命令。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>理解 STP 的作用</p>
</li>
<li><p>熟悉 STP 的工作原理</p>
</li>
<li><p>掌握 STP 的查看命令</p>
</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/28/0Vrbex.png" alt="图片1"></p>
<center>STP 的运用拓扑</center>

<p>【实验需求】</p>
<ol>
<li>在相应的交换机上创建 VLAN10，并将连接 PC1 和 PC2 的交换端口都划分进该 VLAN 中</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在相应的交换机上创建VLAN10</span></span><br><span class="line">SW1(config)<span class="comment">#vlan 10</span></span><br><span class="line">SW2(config)<span class="comment">#vlan 10</span></span><br><span class="line">SW3(config)<span class="comment">#vlan 10</span></span><br><span class="line"><span class="comment">#将PC1的交换机端口划分进VLAN10中</span></span><br><span class="line">SW2(config)<span class="comment">#int e0/2</span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line"><span class="comment">#将PC2的交换机端口划分进VLAN10中</span></span><br><span class="line">SW3(config)<span class="comment">#int e0/2</span></span><br><span class="line">SW3(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">SW3(config-if)<span class="comment">#switchport access vlan 10 </span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>为主机设置合适的 IP 地址，IP 地址自定，完成必要的配置实现主机间的通信</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PC1&gt; ip 192.168.1.1 255.255.255.0</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.1.1 255.255.255.0</span><br><span class="line"></span><br><span class="line">PC2&gt; ip 192.168.1.2 255.255.255.0</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.1.2 255.255.255.0</span><br><span class="line"></span><br><span class="line">SW1(config)<span class="comment">#int range e0/0-1</span></span><br><span class="line">SW1(config-if-range)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">SW1(config-if-range)<span class="comment">#switchport mode trunk</span></span><br><span class="line"></span><br><span class="line">SW2(config)<span class="comment">#int e0/0-1</span></span><br><span class="line">SW2(config-if-range)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">SW2(config-if-range)<span class="comment">#switchport mode trunk </span></span><br><span class="line"></span><br><span class="line">SW3(config)<span class="comment">#int range e0/0-1 </span></span><br><span class="line">SW3(config-if-range)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">SW3(config-if-range)<span class="comment">#switchport mode trunk</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/28/0VrXFO.png" alt="image-20200928194704233"></p>
<ol start="3">
<li>找出每个交换机的桥 ID，根据原理算出根桥、根端口、指定端口和非指定端口</li>
</ol>
<blockquote>
<p>STP的选举规则：</p>
<p>① 根桥（Root）——拥有最小的桥ID的交换机被选为根桥 </p>
<ul>
<li>桥ID：交换机的默认优先级 32768  + MAC地址（可通过 show version查看）</li>
</ul>
<p>② 根端口（RP）——非根交换机上去往根桥路径最优的端口，用于接收BPDU</p>
<ul>
<li>最小根桥开销</li>
<li>最小发送者桥ID</li>
<li>最小发送者端口ID  </li>
</ul>
<p>③ 指定端口（DP）——用来发送或转发配置BPDU</p>
<ul>
<li>最小根路径开销</li>
<li>最小发送者桥ID</li>
<li>最小发送者端口ID  </li>
</ul>
<p>④ 非指定端口（NDP）——既不转发数据帧，也不会将在该网段接收到的数据包源MAC地址填入MAC地址表中</p>
<ul>
<li>上述端口选举完后，剩下的既不是根端口也不是指定端口的端口成为非指定端口</li>
</ul>
</blockquote>
<p><img src="https://s1.ax1x.com/2020/09/28/0Vrbex.png" alt="图片1"></p>
<p>&emsp;&emsp;根据选举规则，各交换机的桥ID，以及根桥、根端口、指定端口、非指定端口如上图所示。 </p>
<ol start="4">
<li>使用相关命令查看各交换机的 STP 信息，比较与根据理论算出来的结果是否一致</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/28/0VsEtS.png" alt="image-20200928202002597"></p>
<p><img src="https://s1.ax1x.com/2020/09/28/0VsAk8.png" alt="image-20200928202035666"></p>
<p><img src="https://s1.ax1x.com/2020/09/28/0VsVfg.png" alt="image-20200928202108499"></p>
<ol start="5">
<li>将 SW2 设置为 VLAN10 的根桥，使用相关命令验证和查看各交换机上根桥的变化</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">SW2(config)#spanning-tree<span class="built_in"> vlan </span>10 root primary</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/28/0Vsn6s.png" alt="image-20200928202930067"></p>
<p>&emsp;&emsp;将SW2设置为根桥后，SW2的e0/0、e0/1为指定端口；SW1的e0/1为根端口、e0/0为指定端口；SW3的e0/1为根端口、e0/0为非指定端口。SW1与SW3之间的链路被阻塞。</p>
<ol start="6">
<li>测试正常链路出现故障对主机通信的影响</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">#将SW2的e0/<span class="number">1</span>端口关闭，模拟正常链路出现故障</span><br><span class="line"><span class="function"><span class="title">SW2</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">SW2</span><span class="params">(config-if)</span></span><span class="selector-id">#shutdown</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/28/0Vs3kT.png" alt="image-20200928203642085"></p>
<ol start="7">
<li>先断开 PC1 与交换机的连接，然后恢复 PC1 与交换机的连接，观察主机重新接入交换机要经历多久才能够进行数据转发</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SW2(config)<span class="comment">#int e0/2</span></span><br><span class="line"><span class="comment">#通过关闭与PC1连接的端口来模拟PC1与交换机断开连接</span></span><br><span class="line">SW2(config-if)<span class="comment">#shutdown </span></span><br><span class="line"><span class="comment">#观察下面4条spanning-tree的events，可以知道PC1与交换机断开连接后，端口的状态迅速变为down</span></span><br><span class="line">*Sep 28 12:42:48.425: STP: VLAN0010 we are the spanning tree root</span><br><span class="line">*Sep 28 12:42:48.425: STP[10]: Generating TC <span class="built_in">trap</span> <span class="keyword">for</span> port Ethernet0/2</span><br><span class="line">*Sep 28 12:42:50.430: %LINK-5-CHANGED: Interface Ethernet0/2, changed state to administratively down</span><br><span class="line">*Sep 28 12:42:51.436: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/2, changed state to down</span><br><span class="line"><span class="comment">#通过开启与PC1连接的端口来模拟PC1与交换机恢复连接</span></span><br><span class="line">SW2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"><span class="comment">#通过观察下面几条spanning-tree的events,根据端口e0/2从12：43：01的listening状态</span></span><br><span class="line">到12：43：31的forwarding状态可以得出，主机重新接入交换机需要经历30s才可以进行数据转发</span><br><span class="line">*Sep 28 12:43:01.692: <span class="built_in">set</span> portid: VLAN0010 Et0/2: new port id 8003</span><br><span class="line">*Sep 28 12:43:01.692: STP: VLAN0010 Et0/2 -&gt; listening</span><br><span class="line">*Sep 28 12:43:03.695: %LINK-3-UPDOWN: Interface Ethernet0/2, changed state to up</span><br><span class="line">*Sep 28 12:43:04.701: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/2, changed state to up</span><br><span class="line">*Sep 28 12:43:16.695: STP: VLAN0010 Et0/2 -&gt; learning</span><br><span class="line">*Sep 28 12:43:31.704: STP[10]: Generating TC <span class="built_in">trap</span> <span class="keyword">for</span> port Ethernet0/2</span><br><span class="line">*Sep 28 12:43:31.704: STP: VLAN0010 Et0/2 -&gt; forwarding</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>使用合适的命令观察 STP 端口的变化过程</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">SW2#<span class="builtin-name">debug</span> spanning-tree events </span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/28/0Vs8tU.png" alt="image-20200928205550232"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>STP</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验三——RIP 的应用</title>
    <url>/2018/10/05/CCNA%E5%AE%9E%E9%AA%8C%E4%B8%89/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 RIPv2 的基本配置； RIPv2 路由条目的结构含义;自动汇总的含义；和观察周期性更新； debug ip rip 命令的作用。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>掌握 RIPv2 的基本配置</li>
<li>理解 RIPv2 路由条目的结构含义</li>
<li>理解自动汇总的含义</li>
<li>理解和观察周期性更新</li>
<li>理解 debug ip rip 命令的作用</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/24/0pV0UK.png" alt="图片1"></p>
<center>RIP 的应用拓扑</center>

<p>【实验需求】</p>
<ol>
<li>参照逻辑拓扑，使用合适的线缆完成物理拓扑的搭建</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/24/0pVrCD.png" alt="图片4"></p>
<ol start="2">
<li>完成各路由器的基本配置，实现各直连设备之间可以互 ping 对方，要求PC1 的 IP 地址设置为 172.16.1.1/24，网关设置为172.16.1.254，PC2 的IP 地址设置为 172.16.3.1/24，网关设置为172.16.3.254，各路由器接口间的地址自己规划</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 192.168.12.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">R1(config)<span class="comment">#int e0/1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 172.16.1.254 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.12.2 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R2(config)<span class="comment">#int s2/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.23.2 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 172.16.3.254 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R3(config)<span class="comment">#int s2/1</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 192.168.23.3 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 172.16.1.1 255.255.255.0 172.16.1.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 172.16.1.1 255.255.255.0 gateway 172.16.1.254</span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 172.16.3.1 255.255.255.0 172.16.3.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 172.16.3.1 255.255.255.0 gateway 172.16.3.254</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在三台路由器上都启用 RIPv2 协议，通告各自的直连网络路由，并开启自动汇总</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#router rip </span></span><br><span class="line">R1(config-router)<span class="comment">#version 2</span></span><br><span class="line">R1(config-router)<span class="comment">#network 192.168.12.0 </span></span><br><span class="line">R1(config-router)<span class="comment">#network 172.16.1.0   </span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router rip                                </span></span><br><span class="line">R2(config-router)<span class="comment">#version 2</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.12.0      </span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.23.0 </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router rip </span></span><br><span class="line">R3(config-router)<span class="comment">#version 2</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.23.0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 172.16.3.0 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在RIP协议中，自动汇总是默认开启的</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 R1 上使用 show ip protocols 命令，观察并理解该命令的输出信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show ip protocols </span></span><br><span class="line">*** IP Routing is NSF aware ***</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;application&quot;</span></span><br><span class="line">  Sending updates every 0 seconds</span><br><span class="line">  Invalid after 0 seconds, hold down 0, flushed after 0</span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Maximum path: 32</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">  Distance: (default is 4)</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;rip&quot;</span></span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Sending updates every 30 seconds, next due <span class="keyword">in</span> 11 seconds</span><br><span class="line">  Invalid after 180 seconds, hold down 180, flushed after 240</span><br><span class="line">  Redistributing: rip</span><br><span class="line">  Default version control: send version 2, receive version 2</span><br><span class="line">    Interface             Send  Recv  Triggered RIP  Key-chain</span><br><span class="line">    Ethernet0/0           2     2                                    </span><br><span class="line">    Ethernet0/1           2     2                                    </span><br><span class="line">  Automatic network summarization is <span class="keyword">in</span> effect</span><br><span class="line">  Maximum path: 4</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">    172.16.0.0</span><br><span class="line">    192.168.12.0</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">    192.168.12.2         120      00:00:16</span><br><span class="line">  Distance: (default is 120)</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;从该命令的输出信息中，可以查看到该路由器使用了RIP版本2的协议，端口e0/0、e0/1发送RIPv2接收RIPv2的路由表信息；更新时间30s；无效/抑制时间180s；失效时间240s；发送的路由信息172.16.0.0；192.168.12.0。</p>
<ol start="5">
<li>查看各路由器的路由表，观察 RIP 路由条目的特征</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        172.16.1.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.1.254/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        192.168.12.1/32 is directly connected, Ethernet0/1</span><br><span class="line">R     192.168.23.0/24 [120/1] via 192.168.12.2, 00:00:04, Ethernet0/1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">R     172.16.0.0/16 [120/1] via 192.168.23.3, 00:00:03, Serial1/0</span><br><span class="line">                    [120/1] via 192.168.12.1, 00:00:09, Ethernet0/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.2/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/0</span><br><span class="line">L        192.168.23.2/32 is directly connected, Serial1/0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        172.16.3.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.3.254/32 is directly connected, Ethernet0/0</span><br><span class="line">R     192.168.12.0/24 [120/1] via 192.168.23.2, 00:00:16, Serial1/1</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/1</span><br><span class="line">L        192.168.23.3/32 is directly connected, Serial1/1</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>分别在 R2 和 PC2 上测试 R2 与 PC1 以及 PC2 与 PC1 之间的连通性</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/24/0pVygH.png" alt="image-20200924184216902"></p>
<p><img src="https://s1.ax1x.com/2020/09/24/0pVXV0.png" alt="image-20200924184319088"></p>
<p>&emsp;&emsp;R2可以ping通PC1，不可以ping通PC2，PC1也不可以ping通PC2。出现这种情况的原因是开启路由的自动汇总，将172.16.1.0/24、172.16.3.0/24汇总成了一条路由（详细请见5中R2的路由表）。</p>
<ol start="7">
<li>在 R2 上使用 debug ip rip 观察路由的发送情况</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*Sep 24 10:49:16.772: RIP: sending request on Ethernet0/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:49:16.772: RIP: sending request on Serial2/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:49:16.772: RIP: sending request on Ethernet0/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:49:16.772: RIP: sending request on Serial2/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:49:16.773: RIP: received v2 update from 192.168.12.1 on Ethernet0/0</span><br><span class="line">*Sep 24 10:49:16.773:      172.16.0.0/16 via 0.0.0.0 <span class="keyword">in</span> 1 hops</span><br><span class="line">*Sep 24 10:49:16.777: RIP: received v2 update from 192.168.23.3 on Serial2/0</span><br><span class="line">*Sep 24 10:49:16.777:      172.16.0.0/16 via 0.0.0.0 <span class="keyword">in</span> 1 hops</span><br><span class="line">*Sep 24 10:49:18.774: RIP: sending v2 flash update to 224.0.0.9 via Ethernet0/0 (192.168.12.2)</span><br><span class="line">*Sep 24 10:49:18.774: RIP: build flash update entries</span><br><span class="line">*Sep 24 10:49:18.775:   192.168.23.0/24 via 0.0.0.0, metric 1, tag 0</span><br><span class="line">*Sep 24 10:49:18.775: RIP: sending v2 flash update to 224.0.0.9 via Serial2/0 (192.168.23.2)</span><br><span class="line">*Sep 24 10:49:18.775: RIP: build flash update entries</span><br><span class="line">*Sep 24 10:49:18.775:   192.168.12.0/24 via 0.0.0.0, metric 1, tag 0</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>在三台路由器上都关闭自动汇总，观察各路由表的变化，并再次测试 R2与 PC1 以及 PC2 与 PC1 之间的连通性</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#router rip </span></span><br><span class="line">R1(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router rip </span></span><br><span class="line">R2(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router rip </span></span><br><span class="line">R3(config-router)<span class="comment">#no auto-summary</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/24/0pZGIf.png" alt="image-20200924185654085"></p>
<p><img src="https://s1.ax1x.com/2020/09/24/0pZ3Zt.png" alt="image-20200924185718576"></p>
<ol start="9">
<li>再次在 R2 上使用 debug ip rip 观察路由的发送情况，比较关闭自动汇总与开启自动汇总 debug 输出信息的不同</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*Sep 24 10:58:23.882: RIP: sending request on Ethernet0/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:58:23.882: RIP: sending request on Serial2/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:58:23.883: RIP: sending request on Ethernet0/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:58:23.883: RIP: sending request on Serial2/0 to 224.0.0.9</span><br><span class="line">*Sep 24 10:58:23.884: RIP: received v2 update from 192.168.12.1 on Ethernet0/0</span><br><span class="line">*Sep 24 10:58:23.884:      172.16.1.0/24 via 0.0.0.0 <span class="keyword">in</span> 1 hops</span><br><span class="line">*Sep 24 10:58:23.888: RIP: received v2 update from 192.168.23.3 on Serial2/0</span><br><span class="line">*Sep 24 10:58:23.888:      172.16.3.0/24 via 0.0.0.0 <span class="keyword">in</span> 1 hops</span><br><span class="line">*Sep 24 10:58:23.888: RIP: received v2 update from 192.168.23.3 on Serial2/0</span><br><span class="line">*Sep 24 10:58:23.888:      172.16.3.0/24 via 0.0.0.0 <span class="keyword">in</span> 1 hops</span><br><span class="line">*Sep 24 10:58:25.888: RIP: sending v2 flash update to 224.0.0.9 via Ethernet0/0 (192.168.12.2)</span><br><span class="line">*Sep 24 10:58:25.888: RIP: build flash update entries</span><br><span class="line">*Sep 24 10:58:25.888:   172.16.3.0/24 via 0.0.0.0, metric 2, tag 0</span><br><span class="line">*Sep 24 10:58:25.888:   192.168.23.0/24 via 0.0.0.0, metric 1, tag 0</span><br><span class="line">*Sep 24 10:58:25.888: RIP: sending v2 flash update to 224.0.0.9 via Serial2/0 (192.168.23.2)</span><br><span class="line">*Sep 24 10:58:25.888: RIP: build flash update entries</span><br><span class="line">*Sep 24 10:58:25.888:   172.16.1.0/24 via 0.0.0.0, metric 2, tag 0</span><br><span class="line">*Sep 24 10:58:25.888:   192.168.12.0/24 via 0.0.0.0, metric 1, tag 0</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;开启自动汇总时，172.16.1.0/24、172.16.30./24是汇总成一条路由条目进行传输的；关闭自动汇总后，172.16.1.0/24、172.16.30./24是分开传输的。</p>
<ol start="10">
<li>在 R2 上添加一个 loopback1 接口，地址自定</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config-if)<span class="comment">#int loopback 1</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 2.2.2.2 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<ol start="11">
<li>添加必要配置，实现 PC1 和 PC2 都能够正常访问在 R2 上的 loopback1</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#router rip </span></span><br><span class="line">R2(config-router)<span class="comment">#network 2.2.2.2</span></span><br></pre></td></tr></table></figure>

<ol start="12">
<li>在 R1 上添加一个 loopback1 接口，地址自定，然后在 RIP 中通告，观察R2 和 R3 是否能马上学习到 R1 上新增的 loopback1 网段</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config-if)<span class="comment">#int loopback 1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 1.1.1.1 255.255.255.0 </span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R1(config)<span class="comment">#router rip </span></span><br><span class="line">R1(config-router)<span class="comment">#network 1.1.1.0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2#show<span class="built_in"> ip route </span></span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      1.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line"></span><br><span class="line">R        1.1.1.0 [120/1] via 192.168.12.1, 00:00:04, Ethernet0/0</span><br><span class="line">      2.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        2.2.2.0/24 is directly connected, Loopback1</span><br><span class="line">L        2.2.2.2/32 is directly connected, Loopback1</span><br><span class="line">      172.16.0.0/24 is subnetted, 2 subnets</span><br><span class="line">R        172.16.1.0 [120/1] via 192.168.12.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.3.0 [120/1] via 192.168.23.3, 00:00:10, Serial1/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.2/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/0</span><br><span class="line">L        192.168.23.2/32 is directly connected, Serial1/0</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R3#show<span class="built_in"> ip route </span></span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      1.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line"></span><br><span class="line">R        1.1.1.0 [120/2] via 192.168.23.2, 00:00:18, Serial1/1</span><br><span class="line">      2.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">R        2.2.2.0 [120/1] via 192.168.23.2, 00:00:18, Serial1/1</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line">R        172.16.1.0/24 [120/2] via 192.168.23.2, 00:00:18, Serial1/1</span><br><span class="line">C        172.16.3.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.3.254/32 is directly connected, Ethernet0/0</span><br><span class="line">R     192.168.12.0/24 [120/1] via 192.168.23.2, 00:00:18, Serial1/1</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/1</span><br><span class="line">L        192.168.23.3/32 is directly connected, Serial1/1</span><br><span class="line">R3#</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;R2 和 R3 能马上学习到 R1 上新增的 loopback1 网段</p>
<ol start="13">
<li>将 R1 上的 loopback1 接口关闭，观察 R2 和 R3 上是否还存在关于 R1 上的 loopback1 网段的路由条目</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2#sh<span class="built_in"> ip </span>rou </span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      2.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        2.2.2.0/24 is directly connected, Loopback1</span><br><span class="line">L        2.2.2.2/32 is directly connected, Loopback1</span><br><span class="line">      172.16.0.0/24 is subnetted, 2 subnets</span><br><span class="line">R        172.16.1.0 [120/1] via 192.168.12.1, 00:00:15, Ethernet0/0</span><br><span class="line">R        172.16.3.0 [120/1] via 192.168.23.3, 00:00:17, Serial1/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.2/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/0</span><br><span class="line">L        192.168.23.2/32 is directly connected, Serial1/0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      2.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line"></span><br><span class="line">R        2.2.2.0 [120/1] via 192.168.23.2, 00:00:13, Serial1/1</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line">R        172.16.1.0/24 [120/2] via 192.168.23.2, 00:00:13, Serial1/1</span><br><span class="line">C        172.16.3.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.3.254/32 is directly connected, Ethernet0/0</span><br><span class="line">R     192.168.12.0/24 [120/1] via 192.168.23.2, 00:00:13, Serial1/1</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/1</span><br><span class="line">L        192.168.23.3/32 is directly connected, Serial1/1</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;关闭R1上的loopback接口后，R2、R3的路由表就清除了此接口信息</p>
<ol start="14">
<li>使用 wireshark 抓取 RIPv2 的报文，理解 RIPv2 报文各字段的含义</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/24/0pZtJS.png" alt="图片3"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>RIP</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验九——NAT 和 PPP 的应用</title>
    <url>/2018/10/17/CCNA%E5%AE%9E%E9%AA%8C%E4%B9%9D/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 NAT 的作用；不同 NAT 的特点及配置；不同 NAT 的使用场合； PPP 的 PAP 和 CHAP 验证；辅助地址的作用； NAT 的验证和查看命令。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>理解 NAT 的作用</li>
<li>理解不同 NAT 的特点及配置</li>
<li>理解不同 NAT 的使用场合</li>
<li>掌握 PPP 的 PAP 和 CHAP 验证</li>
<li>理解辅助地址的作用</li>
<li>掌握 NAT 的验证和查看命令</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QEqhV.png" alt="图片1"></p>
<center>NAT 和 PPP 的应用拓扑</center>

<p>【实验需求】</p>
<ol>
<li>公司 COM1 和 COM2 内部网段都为 192.168.1.0/24，其中 COM1 的 SRV地址为 192.168.1.100/24，COM2 的 user 地址为 192.168.1.10/24，COM1内部的其他主机地址自己规划，并且这些主机地址用辅助地址模拟</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COM1(config)<span class="comment">#int e0/0</span></span><br><span class="line">COM1(config-if)<span class="comment">#ip address 192.168.1.254 255.255.255.0</span></span><br><span class="line">COM1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">Srv(config)<span class="comment">#int e0/0</span></span><br><span class="line">Srv(config-if)<span class="comment">#ip address 192.168.1.100 255.255.255.0</span></span><br><span class="line">Srv(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"><span class="comment">#为Srv指定网关</span></span><br><span class="line">Srv(config)<span class="comment">#ip default-gateway 192.168.1.254</span></span><br><span class="line"><span class="comment">#因为此处的服务器是用路由器进行模拟的，故关闭路由功能</span></span><br><span class="line">Srv(config)<span class="comment">#no ip routing </span></span><br><span class="line"></span><br><span class="line">COM2(config)<span class="comment">#int e0/1</span></span><br><span class="line">COM2(config-if)<span class="comment">#ip address 192.168.1.200 255.255.255.0</span></span><br><span class="line">COM2(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">COM2_user(config)<span class="comment">#int e0/0</span></span><br><span class="line">COM2_user(config-if)<span class="comment">#ip address 192.168.1.10 255.255.255.0</span></span><br><span class="line">COM2_user(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#其余主机地址如拓扑所示</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ISP 上的 Web Server 地址为 211.1.1.1/24，ISP1 与 COM2 之间的地址段为 202.101.12.0/24，ISP1 与 COM1 之间的地址段为 202.101.23.0/24,其中 COM2 连接 ISP1 的接口地址为 202.101.12.1/24,COM1 连接 ISP1 的接口地址为 202.101.23.3/24</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Web_Server(config)<span class="comment">#int e0/0</span></span><br><span class="line">Web_Server(config-if)<span class="comment">#ip address 211.1.1.1 255.255.255.0</span></span><br><span class="line">Web_Server(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">Web_Server(config)<span class="comment">#ip default-gateway 211.1.1.254</span></span><br><span class="line">Web_Server(config)<span class="comment">#no ip routing </span></span><br><span class="line">ISP(config)<span class="comment">#int e0/0</span></span><br><span class="line">ISP(config-if)<span class="comment">#ip address 211.1.1.254 255.255.255.0</span></span><br><span class="line">ISP(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">COM2(config)<span class="comment">#int e0/0</span></span><br><span class="line">COM2(config-if)<span class="comment">#ip address 202.101.12.1 255.255.255.0</span></span><br><span class="line">COM2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">ISP(config)<span class="comment">#int e0/1</span></span><br><span class="line">ISP(config-if)<span class="comment">#ip address 202.101.12.2 255.255.255.0</span></span><br><span class="line">ISP(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>要求COM1与ISP1之间的PPP链路采用CHAP验证，用户名为huangzc，密码为 123456</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ISP(config)<span class="comment">#int s2/0</span></span><br><span class="line">ISP(config-if)<span class="comment">#ip address 202.101.23.2 255.255.255.0</span></span><br><span class="line">ISP(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"><span class="comment">#封装PPP协议</span></span><br><span class="line">ISP(config-if)<span class="comment">#encapsulation ppp</span></span><br><span class="line"><span class="comment">#开启CHAP认证</span></span><br><span class="line">ISP(config-if)<span class="comment">#ppp authentication chap </span></span><br><span class="line"><span class="comment">#分配给对方的IP为202.101.23.3</span></span><br><span class="line">ISP(config-if)<span class="comment">#peer default ip address 202.101.23.3</span></span><br><span class="line">ISP(config-if)<span class="comment">#exit </span></span><br><span class="line"><span class="comment">#设置用户名与密码</span></span><br><span class="line">ISP(config)<span class="comment">#username huangzc password 123456</span></span><br><span class="line"></span><br><span class="line">COM1(config)<span class="comment">#int s2/0</span></span><br><span class="line">COM1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">COM1(config-if)<span class="comment">#encapsulation ppp</span></span><br><span class="line"><span class="comment">#端口s2/0的IP地址通过协商产生</span></span><br><span class="line">COM1(config-if)<span class="comment">#ip address negotiated </span></span><br><span class="line"><span class="comment">#发送用户名与密码</span></span><br><span class="line">COM1(config-if)<span class="comment">#ppp chap hostname huangzc</span></span><br><span class="line">COM1(config-if)<span class="comment">#ppp chap password 123456</span></span><br><span class="line"><span class="comment">#产生一条指向ISP的默认路由</span></span><br><span class="line">COM1(config-if)<span class="comment">#ppp ipcp route default</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QEvX4.png" alt="image-20201001154354765"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QVSB9.png" alt="image-20201001154655748"></p>
<p>&emsp;&emsp;配置完成后，查看COM1端口地址，可以发现COM1与ISP1之间的PPP链路CHAP验证成功，并通过IPCP协议获得IP地址，且COM1的路由表存在一条指向ISP的默认路由。</p>
<ol start="4">
<li>在 COM1 上使用静态 NAT 实现 SRV 可以访问 ISP 上的 Web Server，分别使用 ping 和 debug ip nat 进行验证和测试</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在COM1上启用一个loopback接口，用于静态NAT的映射</span></span><br><span class="line">COM1(config)<span class="comment">#interface loopback 1</span></span><br><span class="line">COM1(config-if)<span class="comment">#ip address 200.100.10.1 255.255.255.0</span></span><br><span class="line">COM1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"><span class="comment">#配置静态NAT，将Srv的IP地址192.168.1.100映射为COM1 loopback 1接口的IP地址</span></span><br><span class="line">COM1(config)<span class="comment">#ip nat inside source static 192.168.1.100 200.100.10.1</span></span><br><span class="line"><span class="comment">#指定内外接口</span></span><br><span class="line">COM1(config)<span class="comment">#int s2/0</span></span><br><span class="line">COM1(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line">COM1(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">COM1(config-if)<span class="comment">#ip nat inside</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在ISP上配置一条静态路由，确保Srv与Web_Server的通信</span></span><br><span class="line">ISP(config)<span class="comment">#ip route 200.100.10.0 255.255.255.0 s2/0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QVk9K.png" alt="image-20201001162703515"></p>
<p>&emsp;&emsp;Srv 可以成功访问 ISP 上的 Web Server。</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QVA1O.png" alt="image-20201001162746131"></p>
<p>&emsp;&emsp;查看COM1上的NAT地址转换表，可以观察到192.168.1.100被转换为了200.100.10.1。</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QVih6.png" alt="image-20201001162816179"></p>
<p>&emsp;&emsp;由于是静态的一对一转换，因此Web_Server也可以访问到Srv。</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">COM1#debug ip nat</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.852</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>-&gt;<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">55</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.861</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> [<span class="number">55</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.862</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>-&gt;<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">56</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.871</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> [<span class="number">56</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.872</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>-&gt;<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">57</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.878</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> [<span class="number">57</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.879</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>-&gt;<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">58</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.888</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> [<span class="number">58</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.889</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span>-&gt;<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">59</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">33.900</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">200.100</span><span class="number">.10</span><span class="number">.1</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> [<span class="number">59</span>]</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 COM1 上使用动态 NAT 实现 COM1 内部的其他用户可以访问 ISP 上的 Web Server，其中动态 NAT 的地址池范围为 202.101.23.10-202.101.23.12，分别使用 ping 和 debug ip nat 进行验证和测试</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置动态NAT的地址池</span></span><br><span class="line">COM1(config)<span class="comment">#ip nat pool huangzc 202.101.23.10 202.101.23.12 netmask 255.255.255.0</span></span><br><span class="line"><span class="comment">#匹配感兴趣流量</span></span><br><span class="line">COM1(config)<span class="comment">#access-list 1 permit 192.168.1.0 0.0.0.255 </span></span><br><span class="line"><span class="comment">#配置静态NAT，将COM1内部的主机映射为公网地址，并进行端口复用（overload）</span></span><br><span class="line">COM1(config)<span class="comment">#ip nat inside source list 1 pool huangzc overload </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QVmBd.png" alt="image-20201001163844595"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QVnHA.png" alt="image-20201001163823189"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COM1<span class="comment">#show ip nat translations </span></span><br><span class="line">Pro Inside global      Inside <span class="built_in">local</span>       Outside <span class="built_in">local</span>      Outside global</span><br><span class="line">icmp 202.101.23.10:3222 192.168.1.1:3222  211.1.1.1:3222     211.1.1.1:3222</span><br><span class="line">icmp 202.101.23.10:3478 192.168.1.1:3478  211.1.1.1:3478     211.1.1.1:3478</span><br><span class="line">icmp 202.101.23.10:3734 192.168.1.1:3734  211.1.1.1:3734     211.1.1.1:3734</span><br><span class="line">icmp 202.101.23.10:3990 192.168.1.1:3990  211.1.1.1:3990     211.1.1.1:3990</span><br><span class="line">icmp 202.101.23.10:1032 192.168.1.1:4246  211.1.1.1:4246     211.1.1.1:1032</span><br><span class="line">icmp 202.101.23.10:1027 192.168.1.2:3478  211.1.1.1:3478     211.1.1.1:1027</span><br><span class="line">icmp 202.101.23.10:1028 192.168.1.2:3734  211.1.1.1:3734     211.1.1.1:1028</span><br><span class="line">icmp 202.101.23.10:1030 192.168.1.2:3990  211.1.1.1:3990     211.1.1.1:1030</span><br><span class="line">icmp 202.101.23.10:1033 192.168.1.2:4246  211.1.1.1:4246     211.1.1.1:1033</span><br><span class="line">icmp 202.101.23.10:1035 192.168.1.2:4502  211.1.1.1:4502     211.1.1.1:1035</span><br><span class="line">icmp 202.101.23.10:1029 192.168.1.3:3734  211.1.1.1:3734     211.1.1.1:1029</span><br><span class="line">icmp 202.101.23.10:1031 192.168.1.3:3990  211.1.1.1:3990     211.1.1.1:1031</span><br><span class="line">icmp 202.101.23.10:1034 192.168.1.3:4246  211.1.1.1:4246     211.1.1.1:1034</span><br><span class="line">icmp 202.101.23.10:4758 192.168.1.3:4758  211.1.1.1:4758     211.1.1.1:4758</span><br><span class="line">icmp 202.101.23.10:5014 192.168.1.3:5014  211.1.1.1:5014     211.1.1.1:5014</span><br><span class="line">icmp 202.101.23.10:58773 192.168.1.3:58773 211.1.1.1:58773   211.1.1.1:58773</span><br><span class="line">icmp 202.101.23.10:59029 192.168.1.3:59029 211.1.1.1:59029   211.1.1.1:59029</span><br><span class="line">icmp 202.101.23.10:1024 192.168.1.3:59285 211.1.1.1:59285    211.1.1.1:1024</span><br><span class="line">icmp 202.101.23.10:1025 192.168.1.3:59541 211.1.1.1:59541    211.1.1.1:1025</span><br><span class="line">icmp 202.101.23.10:1026 192.168.1.3:59797 211.1.1.1:59797    211.1.1.1:1026</span><br><span class="line">icmp 202.101.23.10:4246 192.168.1.4:4246  211.1.1.1:4246     211.1.1.1:4246</span><br><span class="line">icmp 202.101.23.10:4502 192.168.1.4:4502  211.1.1.1:4502     211.1.1.1:4502</span><br><span class="line">icmp 202.101.23.10:1036 192.168.1.4:4758  211.1.1.1:4758     211.1.1.1:1036</span><br><span class="line">icmp 202.101.23.10:1037 192.168.1.4:5014  211.1.1.1:5014     211.1.1.1:1037</span><br><span class="line">icmp 202.101.23.10:5270 192.168.1.4:5270  211.1.1.1:5270     211.1.1.1:5270</span><br><span class="line">icmp 202.101.23.10:59285 192.168.1.4:59285 211.1.1.1:59285   211.1.1.1:59285</span><br><span class="line">icmp 202.101.23.10:59541 192.168.1.4:59541 211.1.1.1:59541   211.1.1.1:59541</span><br><span class="line">icmp 202.101.23.10:59797 192.168.1.4:59797 211.1.1.1:59797   211.1.1.1:59797</span><br><span class="line">icmp 202.101.23.10:60053 192.168.1.4:60053 211.1.1.1:60053   211.1.1.1:60053</span><br><span class="line">icmp 202.101.23.10:60309 192.168.1.4:60309 211.1.1.1:60309   211.1.1.1:60309</span><br><span class="line">--- 200.100.10.1       192.168.1.100      ---                ---</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看COM1的NAT地址转换表可以COM1内的IP地址都被转换成为了公网的IP地址。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COM1<span class="comment">#debug ip nat </span></span><br><span class="line">IP NAT debugging is on</span><br><span class="line">*Oct  1 08:43:08.430: NAT*: s=192.168.1.1-&gt;202.101.23.10, d=211.1.1.1 [38556]</span><br><span class="line">*Oct  1 08:43:08.440: NAT*: s=211.1.1.1, d=202.101.23.10-&gt;192.168.1.1 [38556]</span><br><span class="line">*Oct  1 08:43:09.441: NAT*: s=192.168.1.1-&gt;202.101.23.10, d=211.1.1.1 [38557]</span><br><span class="line">*Oct  1 08:43:09.450: NAT*: s=211.1.1.1, d=202.101.23.10-&gt;192.168.1.1 [38557]</span><br><span class="line">*Oct  1 08:43:10.452: NAT*: s=192.168.1.1-&gt;202.101.23.10, d=211.1.1.1 [38558]</span><br><span class="line">*Oct  1 08:43:10.462: NAT*: s=211.1.1.1, d=202.101.23.10-&gt;192.168.1.1 [38558]</span><br><span class="line">*Oct  1 08:43:11.463: NAT*: s=192.168.1.1-&gt;202.101.23.10, d=211.1.1.1 [38559]</span><br><span class="line">*Oct  1 08:43:11.472: NAT*: s=211.1.1.1, d=202.101.23.10-&gt;192.168.1.1 [38559]</span><br><span class="line">*Oct  1 08:43:12.473: NAT*: s=192.168.1.1-&gt;202.101.23.10, d=211.1.1.1 [38560]</span><br><span class="line">*Oct  1 08:43:12.484: NAT*: s=211.1.1.1, d=202.101.23.10-&gt;192.168.1.1 [38560] </span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在 COM1 和 COM2 上使用 PAT 方式实现 COM1 和 COM2 内部的用户都可以访问 ISP 上的 Web Server</li>
</ol>
<ul>
<li>COM1</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">COM1(config)#ip<span class="built_in"> nat </span>inside source list 1<span class="built_in"> interface </span>serial 2/0 overload </span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QV19f.png" alt="image-20201001165100308"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">COM1#debug ip nat    </span><br><span class="line">IP NAT debugging <span class="keyword">is</span> on</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">28.975</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>-&gt;<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">39056</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">28.986</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span> [<span class="number">39056</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">29.989</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>-&gt;<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">39057</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">30.002</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span> [<span class="number">39057</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">31.004</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>-&gt;<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">39058</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">31.015</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span> [<span class="number">39058</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">32.017</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>-&gt;<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">39059</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">32.029</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span> [<span class="number">39059</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">33.031</span>: NAT*: s=<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>-&gt;<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>, d=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span> [<span class="number">39060</span>]</span><br><span class="line">*Oct  <span class="number">1</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">33.042</span>: NAT*: s=<span class="number">211.1</span><span class="number">.1</span><span class="number">.1</span>, d=<span class="number">202.101</span><span class="number">.23</span><span class="number">.3</span>-&gt;<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span> [<span class="number">39060</span>]</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QV8gS.png" alt="image-20201001165214076"></p>
<ul>
<li>COM2</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COM2(config)<span class="comment">#access-list 1 permit 192.168.1.0 0.0.0.255</span></span><br><span class="line">COM2(config)<span class="comment">#ip nat inside source list 1 interface ethernet 0/0 overload </span></span><br><span class="line">COM2(config)<span class="comment">#int e0/0</span></span><br><span class="line">COM2(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line">COM2(config-if)<span class="comment">#int e0/1</span></span><br><span class="line">COM2(config-if)<span class="comment">#ip nat inside</span></span><br><span class="line"></span><br><span class="line">COM2(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 202.101.12.2</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QVtBj.png" alt="image-20201002001858613"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0QVaEn.png" alt="image-20201002001929323"></p>
<ol start="8">
<li>实现COM2内部的COM2_USER可以远程登录到SRV</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在COM1上配置静态nat，将SRV的地址192.168.1.100的tcp23号端口静态映射成200.100.1.1的1234号端口</span></span><br><span class="line">COM1(config)<span class="comment">#ip nat inside source static tcp 192.168.1.100 23 200.100.1.1 1234</span></span><br><span class="line"></span><br><span class="line">Srv(config)<span class="comment">#line vty 0 4</span></span><br><span class="line">Srv(config-line)<span class="comment">#password 123456</span></span><br><span class="line">Srv(config-line)<span class="comment">#transport input telnet</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0QVdNq.png" alt="image-20201002002730757"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>NAT</tag>
        <tag>PPP</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验二——静态路由的应用</title>
    <url>/2018/10/03/CCNA%E5%AE%9E%E9%AA%8C%E4%BA%8C/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍路由的作用；静态路由的配置；路由表的含义；默认路由的作用与配置；默认路由的使用场合； traceroute 和 ping 命令的使用； loopback 接口的作用。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>理解路由的作用</li>
<li>掌握静态路由的配置</li>
<li>理解路由表的含义</li>
<li>理解默认路由的作用与配置</li>
<li>理解默认路由的使用场合</li>
<li>理解 traceroute 和 ping 命令的使用</li>
<li>理解 loopback 接口的作用</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/22/wXSEGD.png"></p>
<p>【实验需求】</p>
<ol>
<li><p>参照逻辑拓扑，使用合适的线缆完成物理拓扑的搭建</p>
<p><img src="https://s1.ax1x.com/2020/09/23/wvabTg.png"></p>
</li>
<li><p>完成各路由器的基本配置，实现各直连设备之间可以互 ping 对方，主机和路由器接口的地址自己规划</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#int e0/1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 192.168.1.254 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">R1(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 192.168.10.1 255.255.255.0 </span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.10.2 255.255.255.0 </span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R2(config-if)<span class="comment">#int s2/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.20.1 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int s2/1</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 192.168.20.2 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R3(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 192.168.2.254 255.255.255.0                             </span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">PC1&gt; ip 192.168.1.1 255.255.255.0 192.168.1.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.1.1 255.255.255.0 gateway 192.168.1.254</span><br><span class="line"></span><br><span class="line">PC2&gt; ip 192.168.2.1 255.255.255.0 192.168.2.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC2 : 192.168.2.1 255.255.255.0 gateway 192.168.2.254</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>测试 PC1 与 PC2 两主机之间的连通性</li>
</ol>
<p>&emsp;&emsp;PC1与PC2之间不可达，因为PC1的网关R1处没有去往192.168.2.0/24网段的路由。</p>
<p><img src="https://s1.ax1x.com/2020/09/24/wz1LfP.png"></p>
<ol start="4">
<li>在 R1 上创建一条到达对端主机 PC2 所在网络的静态路由，要求使用下一跳方式实现</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#ip route 192.168.2.0 255.255.255.0 192.168.10.2</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在 R3 上创建一条到达对端主机 PC1 所在网络的静态路由，要求使用出接口方式实现</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3(config)<span class="comment">#ip route 192.168.1.0 255.255.255.0 serial 2/1</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>观察 R1 和 R3 上的路由表，仔细观察使用出接口与使用下一跳方式的静态路由表项的不同</li>
</ol>
<p>&emsp;&emsp;R1为下一跳：</p>
<p><img src="https://s1.ax1x.com/2020/09/24/wz1v6S.png"></p>
<p>&emsp;&emsp;R2为出接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/24/wz1xOg.png"></p>
<ol start="6">
<li>添加合适的配置，实现 PC1 与 PC2 之间的连通性，使用 ping 进行测试</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#ip route 192.168.1.0 255.255.255.0 192.168.10.1</span></span><br><span class="line">R2(config)<span class="comment">#ip route 192.168.2.0 255.255.255.0 192.168.20.2</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/24/wz3SmQ.png"></p>
<ol start="6">
<li>分别在 PC1 和 PC2 上使用 tracert 观察两主机通信过程的传输路径</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/24/wz39Ts.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/24/wz3iYq.png"></p>
<ol start="6">
<li>在 R2 上添加一个 loopback1 接口，地址自定</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#int loopback 1</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 1.1.1.1 255.255.255.255</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>添加必要配置，实现 PC1 和 PC2 都能够正常访问在 R2 上的 loopback1</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1(config)#ip<span class="built_in"> route </span>1.1.1.1 255.255.255.255 192.168.10.2</span><br><span class="line"></span><br><span class="line">R3(config)#ip<span class="built_in"> route </span>1.1.1.1 255.255.255.255 s2/1</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/24/wz3Ff0.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/24/wz3n0J.png"></p>
<ol start="6">
<li>删除 R1 和 R3 上的静态路由条目，使用默认路由实现 PC1 与 PC2 之间的连通性</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 192.168.10.2</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 serial 2/1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/24/wz3mm4.png"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>静态路由</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验五——单区域 OSPF 的实现</title>
    <url>/2018/10/09/CCNA%E5%AE%9E%E9%AA%8C%E4%BA%94/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 OSPF 的基本配置； OSPF 的邻居表、拓扑表及路由表的含义； OSPF 的 DR 和 BDR 的作用； OSPF 的 DR 和 BDR 的选举； OSPF 路由协议的相关信息的查看和调试； OSPF 中 hello 报文的作用和格式。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>掌握 OSPF 的基本配置</li>
<li>掌握 OSPF 的邻居表、拓扑表及路由表的含义</li>
<li>掌握 OSPF 的 DR 和 BDR 的作用</li>
<li>掌握 OSPF 的 DR 和 BDR 的选举</li>
<li>查看和调试 OSPF 路由协议的相关信息</li>
<li>熟悉 OSPF 中 hello 报文的作用和格式</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0lX01I.png" alt="图片4"></p>
<center>单区域 OSPF 的实现拓扑</center>

<p>【实验需求】</p>
<ol>
<li>完成各路由器的基本配置，实现各直连设备之间可以互 ping 对方，主机和路由器接口的地址自己规划</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 192.168.12.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">R1(config)<span class="comment">#int e0/1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 172.16.1.254 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.12.2 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R2(config)<span class="comment">#int s2/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 192.168.23.2 255.255.255.0</span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 172.16.3.254 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R3(config)<span class="comment">#int s2/1</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 192.168.23.3 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 172.16.1.1 255.255.255.0 172.16.1.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 172.16.1.1 255.255.255.0 gateway 172.16.1.254</span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 172.16.3.1 255.255.255.0 172.16.3.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 172.16.3.1 255.255.255.0 gateway 172.16.3.254</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>全网启用 OSPF，并划分入区域 0</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R1(config-router)#network 172.16.1.0 0.0.0.255<span class="built_in"> area </span>0</span><br><span class="line">R1(config-router)#network 192.168.12.0 0.0.0.255<span class="built_in"> area </span>0</span><br><span class="line"></span><br><span class="line">R2(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R2(config-router)#network 192.168.12.0 0.0.0.255<span class="built_in"> area </span>0</span><br><span class="line">R2(config-router)#network 192.168.23.0 0.0.0.255<span class="built_in"> area </span>0</span><br><span class="line"></span><br><span class="line">R3(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R3(config-router)#network 172.16.3.0 0.0.0.255<span class="built_in"> area </span>0</span><br><span class="line">R3(config-router)#network 192.168.23.0 0.0.0.255<span class="built_in"> area </span>0</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>观察各路由器的邻居表、拓扑表及路由表，观察哪些链路上有进行DR/BDR 的选举，并测试主机之间的连通性</li>
</ol>
<p>&emsp;&emsp;R1、R2、R3的邻居表：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1#show<span class="built_in"> ip ospf neighbor </span></span><br><span class="line"></span><br><span class="line">Neighbor ID     Pri   State           Dead Time  <span class="built_in"> Address </span>        Interface</span><br><span class="line">192.168.23.2      1   FULL/DR         00:00:35    192.168.12.2    Ethernet0/0</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2#show<span class="built_in"> ip ospf neighbor </span></span><br><span class="line"></span><br><span class="line">Neighbor ID     Pri   State           Dead Time  <span class="built_in"> Address </span>        Interface</span><br><span class="line">192.168.23.3      0   FULL/  -        00:00:37    192.168.23.3    Serial2/0</span><br><span class="line">192.168.12.1      1   FULL/BDR        00:00:30    192.168.12.1    Ethernet0/0</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R3#show<span class="built_in"> ip ospf neighbor </span></span><br><span class="line"></span><br><span class="line">Neighbor ID     Pri   State           Dead Time  <span class="built_in"> Address </span>        Interface</span><br><span class="line">192.168.23.2      0   FULL/  -        00:00:36    192.168.23.2    Serial2/1</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;R1、R2、R3的拓扑表：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1#show<span class="built_in"> ip ospf </span>topology-<span class="builtin-name">info</span> </span><br><span class="line"></span><br><span class="line">            <span class="built_in"> OSPF </span>Router with ID (192.168.12.1) (Process ID 1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                 Base Topology (MTID 0)</span><br><span class="line"></span><br><span class="line"> Topology priority is 64</span><br><span class="line"> Router is <span class="keyword">not</span> originating router-LSAs with maximum metric</span><br><span class="line"> Number of areas transit capable is 0</span><br><span class="line"> Initial SPF schedule delay 5000 msecs</span><br><span class="line"> Minimum hold time between two consecutive SPFs 10000 msecs</span><br><span class="line"> Maximum wait time between two consecutive SPFs 10000 msecs</span><br><span class="line">   <span class="built_in"> Area </span>BACKBONE(0)</span><br><span class="line">        SPF algorithm last executed 00:01:17.233 ago</span><br><span class="line">        SPF algorithm executed 5 times</span><br><span class="line">       <span class="built_in"> Area </span>ranges are</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2#show<span class="built_in"> ip ospf </span>topology-<span class="builtin-name">info</span> </span><br><span class="line"></span><br><span class="line">            <span class="built_in"> OSPF </span>Router with ID (192.168.23.2) (Process ID 1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                 Base Topology (MTID 0)</span><br><span class="line"></span><br><span class="line"> Topology priority is 64</span><br><span class="line"> Router is <span class="keyword">not</span> originating router-LSAs with maximum metric</span><br><span class="line"> Number of areas transit capable is 0</span><br><span class="line"> Initial SPF schedule delay 5000 msecs</span><br><span class="line"> Minimum hold time between two consecutive SPFs 10000 msecs</span><br><span class="line"> Maximum wait time between two consecutive SPFs 10000 msecs</span><br><span class="line">   <span class="built_in"> Area </span>BACKBONE(0)</span><br><span class="line">        SPF algorithm last executed 00:04:16.717 ago</span><br><span class="line">        SPF algorithm executed 4 times</span><br><span class="line">       <span class="built_in"> Area </span>ranges are</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R3#show<span class="built_in"> ip ospf </span>topology-<span class="builtin-name">info</span> </span><br><span class="line"></span><br><span class="line">           <span class="built_in"> OSPF </span>Router with ID (192.168.23.3) (Process ID 1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                Base Topology (MTID 0)</span><br><span class="line"></span><br><span class="line"> Topology priority is 64</span><br><span class="line"> Router is <span class="keyword">not</span> originating router-LSAs with maximum metric</span><br><span class="line"> Number of areas transit capable is 0</span><br><span class="line"> Initial SPF schedule delay 5000 msecs</span><br><span class="line"> Minimum hold time between two consecutive SPFs 10000 msecs</span><br><span class="line"> Maximum wait time between two consecutive SPFs 10000 msecs</span><br><span class="line">   <span class="built_in"> Area </span>BACKBONE(0)</span><br><span class="line">        SPF algorithm last executed 00:06:14.147 ago</span><br><span class="line">        SPF algorithm executed 2 times</span><br><span class="line">       <span class="built_in"> Area </span>ranges are</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;R1、R2、R3的路由表：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1#show<span class="built_in"> ip route </span></span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        172.16.1.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        172.16.1.254/32 is directly connected, Ethernet0/1</span><br><span class="line">O        172.16.3.0/24 [110/84] via 192.168.12.2, 00:06:53, Ethernet0/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.1/32 is directly connected, Ethernet0/0</span><br><span class="line">O     192.168.23.0/24 [110/74] via 192.168.12.2, 00:07:20, Ethernet0/0</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2#show<span class="built_in"> ip route </span></span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      172.16.0.0/24 is subnetted, 2 subnets</span><br><span class="line"></span><br><span class="line">O        172.16.1.0 [110/20] via 192.168.12.1, 00:07:42, Ethernet0/0</span><br><span class="line">O        172.16.3.0 [110/74] via 192.168.23.3, 00:07:25, Serial2/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.2/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial2/0</span><br><span class="line">L        192.168.23.2/32 is directly connected, Serial2/0</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R3#show<span class="built_in"> ip route </span></span><br><span class="line">Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA -<span class="built_in"> OSPF </span>inter<span class="built_in"> area </span></span><br><span class="line">       N1 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>1, N2 -<span class="built_in"> OSPF </span>NSSA external<span class="built_in"> type </span>2</span><br><span class="line">       E1 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>1, E2 -<span class="built_in"> OSPF </span>external<span class="built_in"> type </span>2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is <span class="keyword">not</span> set</span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">O        172.16.1.0/24 [110/84] via 192.168.23.2, 00:07:41, Serial2/1</span><br><span class="line">C        172.16.3.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.3.254/32 is directly connected, Ethernet0/0</span><br><span class="line">O     192.168.12.0/24 [110/74] via 192.168.23.2, 00:07:41, Serial2/1</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial2/1</span><br><span class="line">L        192.168.23.3/32 is directly connected, Serial2/1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DR/BDR的选举规则：</p>
<ul>
<li>先比较优先级，优先级大的优先；默认情况下以太网接口的优先级都为1，串行链路的接口优先级都为0（优先级为0不能参与DR/BDR的选举）</li>
<li>如果优先级都一样，继续比较RID，RID大的优先</li>
<li>DR的选举是非抢占的</li>
</ul>
</blockquote>
<p>&emsp;&emsp;通过各路由器的路由表以及DR/BDR的选举可以得知，R1、R2之间进行了DR/BDR的选举，R2为DR（RID比R1大），R1为BDR；串行链路不进行DR/BDR的选举。</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0lXsnf.png" alt="image-20200926205702544"></p>
<ol start="4">
<li>指定 R2 的 RID 为 20.20.20.20，R3 的 RID 为 30.30.30.30，使用相关命令观察和验证各路由器 RID 的变化</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R2(config-router)#router-id 20.20.20.20</span><br><span class="line">R2(config-router)#end</span><br><span class="line"><span class="comment">#重置OSPF协议进程</span></span><br><span class="line">R2#clear<span class="built_in"> ip ospf </span>process </span><br><span class="line">Reset ALL<span class="built_in"> OSPF </span>processes? [<span class="literal">no</span>]: y </span><br><span class="line"></span><br><span class="line">R3(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R3(config-router)#router-id 30.30.30.30</span><br><span class="line">R3(config-router)#end</span><br><span class="line">R3#clear<span class="built_in"> ip ospf </span>process  </span><br><span class="line">Reset ALL<span class="built_in"> OSPF </span>processes? [<span class="literal">no</span>]: y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>路由器RID的选举：当有手工指定的情况下最优先；在没有手工指定情况下，优先选择回环口中IP地址最大的；若没有回环口，选择物理接口（双UP）中IP地址最大。</p>
</blockquote>
<p><img src="https://s1.ax1x.com/2020/10/02/0lX7HU.png" alt="image-20200926210605837"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0lXouV.png" alt="image-20200926210638711"></p>
<ol start="5">
<li>实现 R2 为以太网链路网段上的 DR</li>
</ol>
<p>&emsp;&emsp;由于在默认情况下，各路由器的优先级都为1，并且R1的RID为192.168.12.1，R2的RID为20.20.20.20。所以根据DR/BDR的选举规则，可以修改R2中e0/0接口的优先级从而使R2成为DR。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf priority 2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于DR、BDR的选举为非抢占，此时应重置OSPF进程</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2<span class="comment">#clear ip ospf process </span></span><br><span class="line">Reset ALL OSPF processes? [no]: y</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看R1和R2的邻居表，可得此时R2成为以太网链路上的DR</p>
<p><img src="https://s1.ax1x.com/2020/10/02/0lXXC9.png" alt="image-20200926212101815"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0lXj3R.png" alt="image-20200926212311154"></p>
<ol start="6">
<li>分别在 R2 和 R3 的路由器上添加 172.16.2.0/24 和 172.16.3.0/24 的网段，添加必要配置实现该两个网络之间的连通性</li>
</ol>
<p>&emsp;&emsp;由于172.16.3.0/24网段已在R3上使用，故不在做特别配置。在R2上添加一个loopback，IP地址为172.16.2.1/24。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R2(config)#interface loopback 1</span><br><span class="line">R2(config-if)#ip<span class="built_in"> address </span>172.168.2.1 255.255.255.0</span><br><span class="line">R2(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line"></span><br><span class="line">R2(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">R2(config-router)#network 172.16.2.0 0.0.0.255<span class="built_in"> area </span>0</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/02/0ljPED.png" alt="image-20200926213245812"></p>
<p><img src="https://s1.ax1x.com/2020/10/02/0ljpDK.png" alt="image-20200926213316790"></p>
<ol start="7">
<li>开启 debug 信息，观察 OSPF 在以太网链路之间信息交互的过程</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#debug ip ospf packet </span></span><br><span class="line">OSPF packet debugging is on</span><br><span class="line">*Mar  1 00:11:35.283: OSPF: rcv. v:2 t:1 l:48 rid:20.20.20.20 aid:0.0.0.0 chk:2B1D aut:0 auk: from FastEthernet0/0</span><br><span class="line">*Mar  1 00:11:35.323: OSPF: rcv. v:2 t:2 l:32 rid:20.20.20.20 aid:0.0.0.0 chk:7D3F aut:0 auk: from FastEthernet0/0</span><br><span class="line">*Mar  1 00:11:35.359: OSPF: rcv. v:2 t:2 l:72 rid:20.20.20.20 aid:0.0.0.0 chk:7F8F aut:0 auk: from FastEthernet0/0</span><br><span class="line">*Mar  1 00:11:35.375: OSPF: rcv. v:2 t:2 l:32 rid:20.20.20.20 aid:0.0.0.0 chk:6B03 aut:0 auk: from FastEthernet0/0</span><br><span class="line">*Mar  1 00:11:35.415: OSPF: rcv. v:2 t:4 l:148 rid:20.20.20.20 aid:0.0.0.0 chk:D361 aut:0 auk: from FastEthernet0/0</span><br><span class="line">*Mar  1 00:11:35.419: %OSPF-5-ADJCHG: Process 1, Nbr 20.20.20.20 on FastEthernet0/0 from LOADING to FULL, Loading Done</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>开启 debug 信息，观察 OSPF 在串行链路之间信息交互的过程，比较以太网链路和串行链路上 OSPF 的 debug 信息输出的区别</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3<span class="comment">#debug ip ospf packet </span></span><br><span class="line">OSPF packet debugging is on</span><br><span class="line">*Mar  1 00:16:42.503: OSPF: rcv. v:2 t:1 l:48 rid:20.20.20.20 aid:0.0.0.0 chk:8836 aut:0 auk: from Serial0/1</span><br><span class="line">*Mar  1 00:16:42.547: OSPF: rcv. v:2 t:2 l:32 rid:20.20.20.20 aid:0.0.0.0 chk:6728 aut:0 auk: from Serial0/1</span><br><span class="line">*Mar  1 00:16:42.547: OSPF: rcv. v:2 t:2 l:92 rid:20.20.20.20 aid:0.0.0.0 chk:18D9 aut:0 auk: from Serial0/1</span><br><span class="line">*Mar  1 00:16:42.583: OSPF: rcv. v:2 t:2 l:32 rid:20.20.20.20 aid:0.0.0.0 chk:7BB8 aut:0 auk: from Serial0/1</span><br><span class="line">*Mar  1 00:16:42.583: OSPF: rcv. v:2 t:4 l:168 rid:20.20.20.20 aid:0.0.0.0 chk:A9BE aut:0 auk: from Serial0/1</span><br><span class="line">*Mar  1 00:16:42.583: %OSPF-5-ADJCHG: Process 1, Nbr 20.20.20.20 on Serial0/1 from LOADING to FULL, Loading Done</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;以太网链路与串行链路上OSPF最主要的区别是，串行链路不进行DR/BDR的选举，而以太网链路进行DR/BDR的选举。</p>
<p>&emsp;&emsp;以太网链路中，路由信息会先被发送到组播地址224.0.0.6，即被DR/BDR所接收，再由DR将此信息发送到组播地址224.0.0.5</p>
<ol start="9">
<li>使用 wireshark 抓取 OSPF 的 hello 报文，理解 hello 报文各字段的含义</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/10/02/0lj9HO.png" alt="image-20201002212804565"></p>
<blockquote>
<p>hello包：周期性发送，用来发现和维持OSPF邻居关系。</p>
<p>hello报文中的相关信息包括：</p>
<ul>
<li>Network Mask：发送hello报文的接口所在网络的掩码</li>
<li>Hello Interval（默认为10s）：发送hello报文的时间间隔</li>
<li>Options：可选项<ul>
<li>E：允许Flood AS-External-LSAs</li>
<li>MC：转发IP组播报文</li>
<li>N/P：处理Type-7 LSAs</li>
<li>DC：处理按需链路</li>
</ul>
</li>
<li>Router Priority：优先级，默认为1，如果设置为0，则不参与DR或BDR的选举</li>
<li>Router Dead Interval（默认40s）：失效时间，如果在此时间内未收到邻居发送的hello报文，则认为邻居失效</li>
<li>Designated Router：DR的接口地址</li>
<li>Backup Designated Router：BDR的接口地址</li>
<li>Active Neighbor：活跃的邻居，以RID标识</li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>OSPF</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验八——ACL 的运用</title>
    <url>/2018/10/15/CCNA%E5%AE%9E%E9%AA%8C%E5%85%AB/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 ACL 作用；标准和扩展 ACL 的区别；标准和扩展 ACL 的配置； ALC 的验证和查看命令；命名的 ACL 的作用与配置。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>掌握 ACL 作用</li>
<li>理解标准和扩展 ACL 的区别</li>
<li>熟悉标准和扩展 ACL 的配置</li>
<li>掌握 ALC 的验证和查看命令</li>
<li>理解命名的 ACL 的作用与配置</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/30/0Kuhp6.png" alt="图片2"></p>
<center>ACL 的运用拓扑</center>

<p>【实验需求】</p>
<ol>
<li>完成各路由器的基本配置，实现各直连设备之间可以互 ping 对方，主机和路由器接口的地址自己规划</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1(config)#int e0/1</span><br><span class="line">R1(config-if)#ip<span class="built_in"> address </span>192.168.12.1 255.255.255.0</span><br><span class="line">R1(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line">R1(config-if)#int e0/0</span><br><span class="line">R1(config-if)#ip<span class="built_in"> address </span>172.16.1.254 255.255.255.0</span><br><span class="line">R1(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line"></span><br><span class="line">R2(config)#int e0/0</span><br><span class="line">R2(config-if)#ip<span class="built_in"> address </span>192.168.12.2 255.255.255.0</span><br><span class="line">R2(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line">R2(config-if)#int s2/0</span><br><span class="line">R2(config-if)#ip<span class="built_in"> address </span>192.168.23.2 255.255.255.0</span><br><span class="line">R2(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line"></span><br><span class="line">R3(config)#int e0/0</span><br><span class="line">R3(config-if)#ip<span class="built_in"> address </span>172.16.3.254 255.255.255.0</span><br><span class="line">R3(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line">R3(config-if)#int s2/0</span><br><span class="line">R3(config-if)#ip<span class="built_in"> address </span>192.168.23.3 255.255.255.0</span><br><span class="line">R3(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line"></span><br><span class="line">PC1&gt;<span class="built_in"> ip </span>172.16.1.1 255.255.255.0 172.16.1.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address<span class="built_in">..</span>.</span><br><span class="line">PC1 : 172.16.1.1 255.255.255.0 gateway 172.16.1.254</span><br><span class="line"></span><br><span class="line">PC2&gt;<span class="built_in"> ip </span>172.16.3.1 255.255.255.0 172.16.3.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address<span class="built_in">..</span>.</span><br><span class="line">PC1 : 172.16.3.1 255.255.255.0 gateway 172.16.3.254</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 R2 上添加两个 loopback 接口，loopback1 和 loopback2，其中loopback1 地址为 2.2.2.2/24，loopback2 地址为 22.22.22.22/24</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="selector-id">#interface</span> loopback <span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> <span class="selector-tag">address</span> <span class="number">2.2</span>.<span class="number">2.2</span> <span class="number">255.255</span>.<span class="number">255.0</span> </span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#no</span> shutdown </span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="selector-id">#interface</span> loopback <span class="number">2</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> <span class="selector-tag">address</span> <span class="number">22.22</span>.<span class="number">22.22</span> <span class="number">255.255</span>.<span class="number">255.0</span> </span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#no</span> shutdown</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>完成必要的配置实现全网可达</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全网开启OSPF协议</span></span><br><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R1(config-router)<span class="comment">#network 192.168.12.0 0.0.0.255 area 0</span></span><br><span class="line">R1(config-router)<span class="comment">#network 172.16.1.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.12.0 0.0.0.255 area 0</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255 area 0</span></span><br><span class="line">R2(config-router)<span class="comment">#network 2.2.2.0 0.0.0.255 area 0</span></span><br><span class="line">R2(config-router)<span class="comment">#network 22.22.22.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255 area 0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 172.16.3.0 0.0.0.255 area 0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KM7FA.png" alt="image-20200929173916930"></p>
<ol start="4">
<li>使用标准 ACL 实现 PC1 不能访问 PC2，并使用 ping 命令验证结果</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3(config)<span class="comment">#access-list 1 deny 172.16.1.1</span></span><br><span class="line">R3(config)<span class="comment">#access-list 1 permit any </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip access-group 1 out</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/30/0KuqAA.png" alt="image-20200929201524316"></p>
<ol start="5">
<li>使用标准 ACL 实现只允许 PC2 远程登录到路由器 R2，并使用 telnet 命令验证结果</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="number">#acc</span>ess-list <span class="number">1</span> permit host <span class="number">172.16</span>.<span class="number">3.1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="selector-id">#line</span> vty <span class="number">0</span> <span class="number">4</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-line)</span></span><span class="number">#acc</span>ess-class <span class="number">1</span> <span class="keyword">in</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-line)</span></span><span class="selector-id">#password</span> <span class="number">123456</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-line)</span></span><span class="selector-id">#transport</span> <span class="selector-tag">input</span> telnet </span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;PC1无法Telnet登入到路由器R2，PC1可以Telnet登入到路由器R2。</p>
<p><img src="https://s1.ax1x.com/2020/09/30/0KKja9.png" alt="image-20200929213833311"></p>
<p><img src="https://s1.ax1x.com/2020/09/30/0KKzP1.png" alt="image-20200929213943549"></p>
<ol start="6">
<li>使用标准 ACL 实现禁止 loopback2 所在网段的所有主机访问 PC1，对loopback1 所在网段主机的访问不做限制</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#access-list 1 permit 2.2.2.0     </span></span><br><span class="line">R1(config)<span class="comment">#access-list 1 deny 22.22.22.0</span></span><br><span class="line">R1(config)<span class="comment">#access-list 1 permit any</span></span><br><span class="line"></span><br><span class="line">R1(config)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip access-group 1 out</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KMS8x.png" alt="image-20200929213725215"></p>
<ol start="7">
<li>使用命名 ACL 完成上述标准 ACL 的需求</li>
</ol>
<ul>
<li>实现 PC1 不能访问 PC2，并使用 ping 命令验证结果</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#ip</span> access-list standard huangzc</span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-std-nacl)</span></span><span class="selector-id">#deny</span> host <span class="number">172.16</span>.<span class="number">1.1</span> </span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-std-nacl)</span></span><span class="selector-id">#permit</span> any </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">0</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> access-group huangzc out</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KM9xK.png" alt="image-20200929235321690"></p>
<ul>
<li>实现只允许 PC2 远程登录到路由器 R2，并使用 telnet 命令验证结果</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#ip access-list standard huangzc</span></span><br><span class="line">R2(config-std-nacl)<span class="comment">#permit host 172.16.3.1</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#line vty 0 4</span></span><br><span class="line">R2(config-line)<span class="comment">#access-class huangzc in</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/30/0KKja9.png" alt="image-20200929213833311"></p>
<p><img src="https://s1.ax1x.com/2020/09/30/0KKzP1.png" alt="image-20200929213943549"></p>
<ul>
<li>实现禁止 loopback2 所在网段的所有主机访问 PC1，对loopback1 所在网段主机的访问不做限制</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config)</span></span><span class="selector-id">#ip</span> access-list standard huangzc</span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-std-nacl)</span></span><span class="selector-id">#deny</span> <span class="number">22.22</span>.<span class="number">22.0</span> <span class="number">0.0</span>.<span class="number">0.255</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-std-nacl)</span></span><span class="selector-id">#permit</span> <span class="number">2.2</span>.<span class="number">2.0</span> <span class="number">0.0</span>.<span class="number">0.255</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-std-nacl)</span></span><span class="selector-id">#permit</span> any</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> access-group huangzc <span class="keyword">in</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KMS8x.png" alt="image-20200929213725215"></p>
<ol start="8">
<li>使用扩展 ACL 实现禁止 PC1 远程登入到 R2，对其他访问不做限制</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#access-list 101 deny tcp host 172.16.1.1 host 192.168.12.2 eq telnet</span></span><br><span class="line">R2(config)<span class="comment">#access-list 101 deny tcp host 172.16.1.1 host 192.168.23.1 eq telnet </span></span><br><span class="line">R2(config)<span class="comment">#access-list 101 deny tcp host 172.16.1.1 host 22.22.22.22 eq telnet  </span></span><br><span class="line">R2(config)<span class="comment">#access-list 101 deny tcp host 172.16.1.1 host 2.2.2.2 eq telnet</span></span><br><span class="line">R2(config)<span class="comment">#access-list 101 permit ip any any</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip access-group 101 in</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;PC1无法远程登入到R2，但是却可以ping通（其他访问不做限制）</p>
<p><img src="https://s1.ax1x.com/2020/10/01/0KMVIA.png" alt="image-20200930155954315"></p>
<p><img src="https://s1.ax1x.com/2020/10/01/0KMePI.png" alt="image-20200930160209188"></p>
<ol start="9">
<li>使用扩展 ACL 实现 PC2 可以 telnet 到路由器 R1，但不能 ping 路由器 R1，分别使用 ping 和 telnet 验证结果</li>
</ol>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">R3(config)#access-<span class="type">list</span> <span class="number">101</span> deny icmp host <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span> host <span class="number">192.168</span><span class="number">.12</span><span class="number">.1</span></span><br><span class="line">R3(config)#access-<span class="type">list</span> <span class="number">101</span> deny icmp host <span class="number">172.16</span><span class="number">.3</span><span class="number">.1</span> host <span class="number">172.16</span><span class="number">.1</span><span class="number">.254</span></span><br><span class="line">R3(config)#access-<span class="type">list</span> <span class="number">101</span> permit ip any any</span><br><span class="line"></span><br><span class="line">R3(config)#int e0/<span class="number">0</span></span><br><span class="line">R3(config-if)#ip access-group <span class="number">101</span> in</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KMdMT.png" alt="20200930171354898"></p>
<ol start="10">
<li>使用扩展 ACL 实现 PC1 可以 ping PC2，但禁止 PC2 ping PC1，其他的访问不受限制，使用 ping 验证结果</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">#通过过滤PC2发送给PC1的ICMP echo包来达到禁止PC2 ping PC1</span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="number">#acc</span>ess-list <span class="number">102</span> deny icmp host <span class="number">172.16</span>.<span class="number">3.1</span> host <span class="number">172.16</span>.<span class="number">1.1</span> echo</span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="number">#acc</span>ess-list <span class="number">102</span> permit ip any any</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">0</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> access-group <span class="number">102</span> <span class="keyword">in</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KM8aj.png" alt="image-20200930194642453"></p>
<p><img src="https://s1.ax1x.com/2020/10/01/0KMGIs.png" alt="image-20200930194656765"></p>
<ol start="11">
<li>使用命名 ACL 完成上述扩展 ACL 的需求</li>
</ol>
<ul>
<li>实现禁止 PC1 远程登录到 R2，对其他访问不做限制</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#ip access-list extended huangzc</span></span><br><span class="line">R2(config-ext-nacl)<span class="comment">#deny tcp host 192.168.12.1 host 192.168.12.2 eq telnet </span></span><br><span class="line">R2(config-ext-nacl)<span class="comment">#deny tcp host 192.168.12.1 host 192.168.23.2 eq telnet </span></span><br><span class="line">R2(config-ext-nacl)<span class="comment">#deny tcp host 192.168.12.1 host 2.2.2.2 eq telnet </span></span><br><span class="line">R2(config-ext-nacl)<span class="comment">#deny tcp host 192.168.12.1 host 22.22.22.22 eq telnet </span></span><br><span class="line"></span><br><span class="line">R2(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip access-group huangzc in </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KM2z6.png" alt="image-20200930233004808"></p>
<ul>
<li>实现 PC2 可以 telnet 到路由器 R1，但不能 ping 路由器 R1，分别使用 ping 和 telnet 验证结果</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3(config)<span class="comment">#ip access-list extended huangzc</span></span><br><span class="line">R3(config-ext-nacl)<span class="comment">#deny icmp host 172.16.3.1 host 192.168.12.1</span></span><br><span class="line">R3(config-ext-nacl)<span class="comment">#deny icmp host 172.16.3.1 host 172.16.1.254</span></span><br><span class="line">R3(config-ext-nacl)<span class="comment">#permit ip any any</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip access-group huangzc in    </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KMdMT.png" alt="20200930171354898"></p>
<ul>
<li>实现 PC1 可以 ping PC2，但禁止 PC2 ping PC1，其他的访问不受限制，使用 ping 验证结果</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R3(config)<span class="comment">#ip access-list extended huangzc</span></span><br><span class="line">R3(config-ext-nacl)<span class="comment">#deny icmp host 172.16.3.1 host 172.16.1.1</span></span><br><span class="line">R3(config-ext-nacl)<span class="comment">#permit ip any any</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip access-group huangzc in  </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/01/0KM8aj.png" alt="image-20200930194642453"></p>
<p><img src="https://s1.ax1x.com/2020/10/01/0KMGIs.png" alt="image-20200930194656765"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>ACL</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验六——单臂路由的运用</title>
    <url>/2018/10/11/CCNA%E5%AE%9E%E9%AA%8C%E5%85%AD/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍交换机上 VLAN 的创建和划分； Trunk 的作用； VTP 的作用与配置；单臂路由原理与配置； Trunk 链路 上的 802.1Q 标记的作用。</p>
<a id="more"></a>

<p>【实验目的】 </p>
<ol>
<li><p>掌握交换机上 VLAN 的创建和划分</p>
</li>
<li><p>掌握 Trunk 的作用</p>
</li>
<li><p>掌握 VTP 的作用与配置</p>
</li>
<li><p>掌握单臂路由原理与配置</p>
</li>
<li><p>理解 Trunk 链路 上的 802.1Q 标记的作用</p>
</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/27/0AevwD.png" alt="图片2"></p>
<center>单臂路由的实现拓扑</center>

<p>【实验需求】</p>
<ol>
<li>在 Switch1 上创建两个 VLAN，VLAN10 和 VLAN20，并将 VLAN10 命名为 sales，将 VLAN20 命名为 engineers</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">SW1</span><span class="params">(config)</span></span><span class="selector-id">#vlan</span> <span class="number">10</span> </span><br><span class="line"><span class="function"><span class="title">SW1</span><span class="params">(config-vlan)</span></span><span class="selector-id">#name</span> sales</span><br><span class="line"><span class="function"><span class="title">SW1</span><span class="params">(config)</span></span><span class="selector-id">#vlan</span> <span class="number">20</span></span><br><span class="line"><span class="function"><span class="title">SW1</span><span class="params">(config-vlan)</span></span><span class="selector-id">#name</span> engineers</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/27/0AmkOf.png" alt="image-20200927163641463"></p>
<ol start="2">
<li>完成必要的配置，实现两交换的 VLAN 数据库同步，并使用相关命令验证和查看 VLAN 数据库的信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#启用VTP，将SW1配置为server模式</span></span><br><span class="line">SW1(config)<span class="comment">#vtp mode server </span></span><br><span class="line">Device mode already VTP Server <span class="keyword">for</span> VLANS.</span><br><span class="line"><span class="comment">#将SW1加入huangzc域</span></span><br><span class="line">SW1(config)<span class="comment">#vtp domain huangzc</span></span><br><span class="line">Changing VTP domain name from NULL to huangzc</span><br><span class="line"><span class="comment">#开启VTP的认证模式，密码为123456</span></span><br><span class="line">SW1(config)<span class="comment">#vtp password 123456</span></span><br><span class="line">Setting device VTP password to 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#将SW1与SW2连接的端口配置为Trunk模式</span></span><br><span class="line">SW1(config)<span class="comment">#int e0/3</span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用VTP，将SW2配置为server模式</span></span><br><span class="line">SW2(config)<span class="comment">#vtp mode client </span></span><br><span class="line">Setting device to VTP Client mode <span class="keyword">for</span> VLANS.</span><br><span class="line">SW2(config)<span class="comment">#vtp domain huangzc</span></span><br><span class="line">Changing VTP domain name from NULL to huangzc</span><br><span class="line">SW2(config)<span class="comment">#vtp password 123456</span></span><br><span class="line">Setting device VTP password to 123456</span><br><span class="line"></span><br><span class="line">SW2(config)<span class="comment">#int e0/0</span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport mode trunk</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/27/0AmEm8.png" alt="image-20200927163600475"></p>
<ol start="3">
<li>将连接 PC1 和 PC3 的交换端口划分进 VLAN10，将连接 PC2 的交换端口划分进 VLAN20 中，并为各 PC 配置合适的 IP 地址和网关</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SW1(config)<span class="comment">#int e0/1</span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport access vlan 10 </span></span><br><span class="line">SW1(config-if)<span class="comment">#int e0/2                  </span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport mode access    </span></span><br><span class="line">SW1(config-if)<span class="comment">#switchport access vlan 20 </span></span><br><span class="line"></span><br><span class="line">SW2(config)<span class="comment">#int e0/1</span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">SW2(config-if)<span class="comment">#switchport access vlan 10 </span></span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 192.168.10.1 255.255.255.0 192.168.10.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.10.1 255.255.255.0 gateway 192.168.10.254</span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 192.168.20.1 255.255.255.0 192.168.20.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.20.1 255.255.255.0 gateway 192.168.20.254</span><br><span class="line"></span><br><span class="line">VPCS&gt; ip 192.168.10.2 255.255.255.0 192.168.10.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address...</span><br><span class="line">PC1 : 192.168.10.2 255.255.255.0 gateway 192.168.10.254</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>使用 show vlan brief 查看各交换机的 VLAN 接口信息</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/27/0AmZTg.png" alt="image-20200927202926050"></p>
<p><img src="https://s1.ax1x.com/2020/09/27/0AmnYj.png" alt="image-20200927203024123"></p>
<ol start="5">
<li>测试各主机之间的连通性</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/27/0AmQlq.png" alt="image-20200927204333845"></p>
<p><img src="https://s1.ax1x.com/2020/09/27/0Aml60.png" alt="image-20200927211745826"></p>
<ol start="6">
<li>在交换机和路由器上完成必要的配置，实现各主机间可以互相通信</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R1上配置单臂路由</span></span><br><span class="line"><span class="comment">#进入子接口</span></span><br><span class="line">R1(config)<span class="comment">#int e0/0.1</span></span><br><span class="line"><span class="comment">#将子接口封装进Vlan 10</span></span><br><span class="line">R1(config-subif)<span class="comment">#encapsulation dot1Q 10</span></span><br><span class="line"><span class="comment">#配置子接口的IP地址</span></span><br><span class="line">R1(config-subif)<span class="comment">#ip address 192.168.10.254 255.255.255.0  </span></span><br><span class="line">R1(config-subif)<span class="comment">#no shutdown </span></span><br><span class="line">R1(config-subif)<span class="comment">#int e0/0.2  </span></span><br><span class="line">R1(config-subif)<span class="comment">#encapsulation dot1Q 20</span></span><br><span class="line">R1(config-subif)<span class="comment">#ip address 192.168.20.254 255.255.255.0</span></span><br><span class="line">R1(config-subif)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;PC1与PC2、PC3之间的连通性：</p>
<p><img src="https://s1.ax1x.com/2020/09/27/0Am1XV.png" alt="image-20200927203631922"></p>
<p>&emsp;&emsp;PC2与PC3的连通性：</p>
<p><img src="https://s1.ax1x.com/2020/09/27/0AmdpR.png" alt="image-20200927203931818"></p>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>单臂路由</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNA实验四——EIGRP 的简单应用</title>
    <url>/2018/10/07/CCNA%E5%AE%9E%E9%AA%8C%E5%9B%9B/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 EIGRP 的基本配置； EIGRP 的邻居表、拓扑表以及路由表的含义；查看 EIGRP 路由协议的相关信息； FD、AD、S、FS 以及 FC 的含义； EIGRP 的 hello 报文作用；路由快速收敛的含义； EIGRP 的不等价负载均衡。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li>掌握 EIGRP 的基本配置</li>
<li>理解 EIGRP 的邻居表、拓扑表以及路由表的含义</li>
<li>掌握查看 EIGRP 路由协议的相关信息</li>
<li>掌握 FD、AD、S、FS 以及 FC 的含义</li>
<li>理解 EIGRP 的 hello 报文作用</li>
<li>理解路由快速收敛的含义</li>
<li>理解 EIGRP 的不等价负载均衡</li>
</ol>
<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/09/26/0Pj8Gn.png" alt="图片1"></p>
<center>EIGRP 的简单应用拓扑</center>

<p>【实验需求】</p>
<ol>
<li>参照逻辑拓扑，使用合适的线缆完成物理拓扑的搭建</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/26/0PjtMV.png" alt="图片4"></p>
<ol start="2">
<li>完成各路由器的基本配置，实现各直连设备之间可以互 ping 对方，要求PC1 的 IP 地址设置为 172.16.1.1/24，网关设置为 172.16.1.254，PC2 的IP 地址设置为 172.16.3.1/24，网关设置为 172.16.3.254，各路由器接口间的地址自己规划</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R1(config-if)#int e0/0</span><br><span class="line">R1(config-if)#ip<span class="built_in"> address </span>192.168.12.1 255.255.255.0</span><br><span class="line">R1(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line">R1(config)#int e0/1</span><br><span class="line">R1(config-if)#ip<span class="built_in"> address </span>172.16.1.254 255.255.255.0</span><br><span class="line">R1(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line"></span><br><span class="line">R2(config)#int e0/0</span><br><span class="line">R2(config-if)#ip<span class="built_in"> address </span>192.168.12.2 255.255.255.0</span><br><span class="line">R2(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line">R2(config)#int s2/0</span><br><span class="line">R2(config-if)#ip<span class="built_in"> address </span>192.168.23.2 255.255.255.0</span><br><span class="line">R2(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line"></span><br><span class="line">R3(config)#int e0/0</span><br><span class="line">R3(config-if)#ip<span class="built_in"> address </span>172.16.3.254 255.255.255.0</span><br><span class="line">R3(config-if)#<span class="literal">no</span> shutdown </span><br><span class="line">R3(config)#int s2/1</span><br><span class="line">R3(config-if)#ip<span class="built_in"> address </span>192.168.23.3 255.255.255.0</span><br><span class="line">R3(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line"></span><br><span class="line">VPCS&gt;<span class="built_in"> ip </span>172.16.1.1 255.255.255.0 172.16.1.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address<span class="built_in">..</span>.</span><br><span class="line">PC1 : 172.16.1.1 255.255.255.0 gateway 172.16.1.254</span><br><span class="line"></span><br><span class="line">VPCS&gt;<span class="built_in"> ip </span>172.16.3.1 255.255.255.0 172.16.3.254</span><br><span class="line">Checking <span class="keyword">for</span> duplicate address<span class="built_in">..</span>.</span><br><span class="line">PC1 : 172.16.3.1 255.255.255.0 gateway 172.16.3.254</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>全网启用 EIGRP，通告各自的直连网络路由，并关闭自动汇总</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#router eigrp 90</span></span><br><span class="line">R1(config-router)<span class="comment">#network 172.16.1.0 0.0.0.255 </span></span><br><span class="line">R1(config-router)<span class="comment">#network 192.168.12.0 0.0.0.255 </span></span><br><span class="line">R1(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router eigrp 90</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.12.0 0.0.0.255</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255</span></span><br><span class="line">R2(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router eigrp 90</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255  </span></span><br><span class="line">R3(config-router)<span class="comment">#network 172.16.3.0 0.0.0.255</span></span><br><span class="line">R3(config-router)<span class="comment">#no auto-summary</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 R1 上使用 show ip protocols 命令，观察并理解该命令的输出信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#sh ip protocols </span></span><br><span class="line">*** IP Routing is NSF aware ***</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;application&quot;</span></span><br><span class="line">  Sending updates every 0 seconds</span><br><span class="line">  Invalid after 0 seconds, hold down 0, flushed after 0</span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Maximum path: 32</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">  Distance: (default is 4)</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;eigrp 90&quot;</span></span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Default networks flagged <span class="keyword">in</span> outgoing updates</span><br><span class="line">  Default networks accepted from incoming updates</span><br><span class="line">  EIGRP-IPv4 Protocol <span class="keyword">for</span> AS(90)</span><br><span class="line">    Metric weight K1=1, K2=0, K3=1, K4=0, K5=0</span><br><span class="line">    NSF-aware route hold timer is 240</span><br><span class="line">    Router-ID: 192.168.12.1</span><br><span class="line">    Topology : 0 (base) </span><br><span class="line">      Active Timer: 3 min</span><br><span class="line">      Distance: internal 90 external 170</span><br><span class="line">      Maximum path: 4</span><br><span class="line">      Maximum hopcount 100</span><br><span class="line">      Maximum metric variance 1</span><br><span class="line"></span><br><span class="line">  Automatic Summarization: disabled</span><br><span class="line">  Maximum path: 4</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">    172.16.1.0/24</span><br><span class="line">    192.168.12.0</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">    192.168.12.2          90      00:00:44</span><br><span class="line">  Distance: internal 90 external 170</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;从该命令的输出信息中，可以查看到该路由器使用了EIGRP协议，AS号为90；Metric weight k1=1 k2=0 k3=1 k4=0 k5=0；RID:192.168.12.1；内部的AD值为，90 外部的AD值为170；最大的等价负载均衡条数为4条；最大的条数为100；Variance为1；通告的网段为172.16.1.0/24、192.168.12.0/24。</p>
<ol start="5">
<li>查看各路由器的邻居表、拓扑表以及路由表，分别找出 FD、AD 以及 S等重要信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#邻居表</span></span><br><span class="line">R1<span class="comment">#show ip eigrp neighbors </span></span><br><span class="line">EIGRP-IPv4 Neighbors <span class="keyword">for</span> AS(90)</span><br><span class="line">H   Address                 Interface              Hold Uptime   SRTT   RTO  Q  Seq</span><br><span class="line">                                                   (sec)         (ms)       Cnt Num</span><br><span class="line">0   192.168.12.2            Et0/1                    13 00:05:46   10   100  0  8</span><br><span class="line"></span><br><span class="line">R2<span class="comment">#show ip eigrp neighbors </span></span><br><span class="line">EIGRP-IPv4 Neighbors <span class="keyword">for</span> AS(90)</span><br><span class="line">H   Address                 Interface              Hold Uptime   SRTT   RTO  Q  Seq</span><br><span class="line">                                                   (sec)         (ms)       Cnt Num</span><br><span class="line">1   192.168.23.3            Se1/0                    12 00:05:43   20   120  0  4</span><br><span class="line">0   192.168.12.1            Et0/0                    12 00:06:25   12   100  0  4</span><br><span class="line"></span><br><span class="line">R3<span class="comment">#show ip eigrp neighbors</span></span><br><span class="line">EIGRP-IPv4 Neighbors <span class="keyword">for</span> AS(90)</span><br><span class="line">H   Address                 Interface              Hold Uptime   SRTT   RTO  Q  Seq</span><br><span class="line">                                                   (sec)         (ms)       Cnt Num</span><br><span class="line">0   192.168.23.2            Se1/1                    14 00:05:57   27   162  0  7</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show ip protocols </span></span><br><span class="line">*** IP Routing is NSF aware ***</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;application&quot;</span></span><br><span class="line">  Sending updates every 0 seconds</span><br><span class="line">  Invalid after 0 seconds, hold down 0, flushed after 0</span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Maximum path: 32</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">  Distance: (default is 4)</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;eigrp 90&quot;</span></span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Default networks flagged <span class="keyword">in</span> outgoing updates</span><br><span class="line">  Default networks accepted from incoming updates</span><br><span class="line">  EIGRP-IPv4 Protocol <span class="keyword">for</span> AS(90)</span><br><span class="line">    Metric weight K1=1, K2=0, K3=1, K4=0, K5=0</span><br><span class="line">    NSF-aware route hold timer is 240</span><br><span class="line">    Router-ID: 192.168.12.1</span><br><span class="line">    Topology : 0 (base) </span><br><span class="line">      Active Timer: 3 min</span><br><span class="line">      Distance: internal 90 external 170</span><br><span class="line">      Maximum path: 4</span><br><span class="line">      Maximum hopcount 100</span><br><span class="line">      Maximum metric variance 1</span><br><span class="line"></span><br><span class="line">  Automatic Summarization: disabled</span><br><span class="line">  Maximum path: 4</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">    172.16.1.0/24</span><br><span class="line">    192.168.12.0</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">    192.168.12.2          90      00:06:25</span><br><span class="line">  Distance: internal 90 external 170</span><br><span class="line">  </span><br><span class="line">R2<span class="comment">#show ip protocols </span></span><br><span class="line">*** IP Routing is NSF aware ***</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;application&quot;</span></span><br><span class="line">  Sending updates every 0 seconds</span><br><span class="line">  Invalid after 0 seconds, hold down 0, flushed after 0</span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Maximum path: 32</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">  Distance: (default is 4)</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;eigrp 90&quot;</span></span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Default networks flagged <span class="keyword">in</span> outgoing updates</span><br><span class="line">  Default networks accepted from incoming updates</span><br><span class="line">  EIGRP-IPv4 Protocol <span class="keyword">for</span> AS(90)</span><br><span class="line">    Metric weight K1=1, K2=0, K3=1, K4=0, K5=0</span><br><span class="line">    NSF-aware route hold timer is 240</span><br><span class="line">    Router-ID: 2.2.2.2</span><br><span class="line">    Topology : 0 (base) </span><br><span class="line">      Active Timer: 3 min</span><br><span class="line">      Distance: internal 90 external 170</span><br><span class="line">      Maximum path: 4</span><br><span class="line">      Maximum hopcount 100</span><br><span class="line">      Maximum metric variance 1</span><br><span class="line"></span><br><span class="line">  Automatic Summarization: disabled</span><br><span class="line">  Maximum path: 4</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">    192.168.12.0</span><br><span class="line">    192.168.23.0</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">    192.168.12.1          90      00:07:13</span><br><span class="line">    192.168.23.3          90      00:07:13</span><br><span class="line">  Distance: internal 90 external 170</span><br><span class="line">  </span><br><span class="line">R3<span class="comment">#show ip protocols </span></span><br><span class="line">*** IP Routing is NSF aware ***</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;application&quot;</span></span><br><span class="line">  Sending updates every 0 seconds</span><br><span class="line">  Invalid after 0 seconds, hold down 0, flushed after 0</span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Maximum path: 32</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">  Distance: (default is 4)</span><br><span class="line"></span><br><span class="line">Routing Protocol is <span class="string">&quot;eigrp 90&quot;</span></span><br><span class="line">  Outgoing update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Incoming update filter list <span class="keyword">for</span> all interfaces is not <span class="built_in">set</span></span><br><span class="line">  Default networks flagged <span class="keyword">in</span> outgoing updates</span><br><span class="line">  Default networks accepted from incoming updates</span><br><span class="line">  EIGRP-IPv4 Protocol <span class="keyword">for</span> AS(90)</span><br><span class="line">    Metric weight K1=1, K2=0, K3=1, K4=0, K5=0</span><br><span class="line">    NSF-aware route hold timer is 240</span><br><span class="line">    Router-ID: 192.168.23.3</span><br><span class="line">    Topology : 0 (base) </span><br><span class="line">      Active Timer: 3 min</span><br><span class="line">      Distance: internal 90 external 170</span><br><span class="line">      Maximum path: 4</span><br><span class="line">      Maximum hopcount 100</span><br><span class="line">      Maximum metric variance 1</span><br><span class="line"></span><br><span class="line">  Automatic Summarization: disabled</span><br><span class="line">  Maximum path: 4</span><br><span class="line">  Routing <span class="keyword">for</span> Networks:</span><br><span class="line">    172.16.3.0/24</span><br><span class="line">    192.168.23.0</span><br><span class="line">  Routing Information Sources:</span><br><span class="line">    Gateway         Distance      Last Update</span><br><span class="line">    192.168.23.2          90      00:07:34</span><br><span class="line">  Distance: internal 90 external 170</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        172.16.1.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.1.254/32 is directly connected, Ethernet0/0</span><br><span class="line">D        172.16.3.0/24 [90/2221056] via 192.168.12.2, 00:09:00, Ethernet0/1</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        192.168.12.1/32 is directly connected, Ethernet0/1</span><br><span class="line">D     192.168.23.0/24 [90/2195456] via 192.168.12.2, 00:09:42, Ethernet0/1</span><br><span class="line"></span><br><span class="line">R2<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      2.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        2.2.2.0/24 is directly connected, Loopback1</span><br><span class="line">L        2.2.2.2/32 is directly connected, Loopback1</span><br><span class="line">      172.16.0.0/24 is subnetted, 2 subnets</span><br><span class="line">D        172.16.1.0 [90/307200] via 192.168.12.1, 00:10:18, Ethernet0/0</span><br><span class="line">D        172.16.3.0 [90/2195456] via 192.168.23.3, 00:09:29, Serial1/0</span><br><span class="line">      192.168.12.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.12.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.12.2/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/0</span><br><span class="line">L        192.168.23.2/32 is directly connected, Serial1/0</span><br><span class="line"></span><br><span class="line">R3<span class="comment">#sh ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks</span><br><span class="line">D        172.16.1.0/24 [90/2221056] via 192.168.23.2, 00:09:45, Serial1/1</span><br><span class="line">C        172.16.3.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.3.254/32 is directly connected, Ethernet0/0</span><br><span class="line">D     192.168.12.0/24 [90/2195456] via 192.168.23.2, 00:09:45, Serial1/1</span><br><span class="line">      192.168.23.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.23.0/24 is directly connected, Serial1/1</span><br><span class="line">L        192.168.23.3/32 is directly connected, Serial1/1</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>测试 PC1 与 PC2 之间的连通性</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/26/0PjDi9.png" alt="image-20200924235948555"></p>
<ol start="7">
<li>在 R2 上添加一个 loopback1 接口，地址为 200.200.200.200/24，然后在EIGRP 中通告，观察 R1 和 R3 是否能马上学习到 R2 上新增的 loopback1网段，并测试各主机与该 loopback1 之间的连通性</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="selector-id">#int</span> loopback <span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> <span class="selector-tag">address</span> <span class="number">200.200</span>.<span class="number">200.200</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-if)</span></span><span class="selector-id">#no</span> shutdown</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config)</span></span><span class="selector-id">#router</span> eigrp <span class="number">90</span></span><br><span class="line"><span class="function"><span class="title">R2</span><span class="params">(config-router)</span></span><span class="selector-id">#network</span> <span class="number">200.200</span>.<span class="number">200.0</span> <span class="number">0.0</span>.<span class="number">0.255</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/26/0PjOeS.png" alt="image-20200925000531964"></p>
<p><img src="https://s1.ax1x.com/2020/09/26/0PvSWn.png" alt="image-20200925000608975"></p>
<p><img src="https://s1.ax1x.com/2020/09/26/0PjHQP.png" alt="image-20200925000444998"></p>
<p><img src="https://s1.ax1x.com/2020/09/26/0Pj5id.png" alt="image-20200925000502718"></p>
<p>&emsp;&emsp;R1和R3能马上学习到 R2 上新增的 loopback1 网段，且连通性良好。</p>
<ol start="8">
<li>使用 wireshark 抓取 EIGRP 的报文，理解 EIGRP 报文各字段的含义</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/26/0PvAwF.png" alt="dTKTh9"></p>
<p>&emsp;&emsp;每隔5s发送一个hello包，保持时间为15s，即超过3个hello时间未收到hello则认为对端Down，断开连接。</p>
<ol start="9">
<li>在 R1 上添加一个 loopback1 接口，地址为 100.100.100.100/24，然后在EIGRP 中通告</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#int loopback 1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 100.100.100.100 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">R1(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R1(config-router)<span class="comment">#network 100.100.100.0</span></span><br></pre></td></tr></table></figure>



<ol start="10">
<li>断开 R1 和 R3 与各主机之间的连接，连接 R1 与 R3 之间的以太网接口，完成必要配置，实现 200.200.200.200 访问 100.100.100.100 的不等价负载均衡</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/26/0PveY9.png" alt="dTM0jx"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">0</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> <span class="selector-tag">address</span> <span class="number">192.168</span>.<span class="number">13.1</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-if)</span></span><span class="selector-id">#no</span> shutdown </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#int</span> e0/<span class="number">0</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#ip</span> <span class="selector-tag">address</span> <span class="number">192.168</span>.<span class="number">13.3</span> <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#no</span> shutdown </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config)</span></span><span class="selector-id">#router</span> eigrp <span class="number">90</span> </span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-router)</span></span><span class="selector-id">#network</span> <span class="number">192.168</span>.<span class="number">13.0</span> </span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-router)</span></span><span class="selector-id">#network</span> <span class="number">100.100</span>.<span class="number">100.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#router</span> eigrp <span class="number">90</span> </span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-router)</span></span><span class="selector-id">#network</span> <span class="number">192.168</span>.<span class="number">13.0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/26/0PvKQx.png" alt="image-20200926124818738"></p>
<p>&emsp;&emsp;由于此时R2的路由表中只存在一条路径到达100.100.100.100，所以不存在负载均衡。</p>
<p><img src="https://s1.ax1x.com/2020/09/26/0PvMy6.png" alt="image-20200926125126158"></p>
<p>&emsp;&emsp;EIGRP在默认情况下仅支持等价负载均衡，并且在默认情况下最多同时存在4条的等价负载均衡。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#router eigrp 90</span></span><br><span class="line"><span class="comment">#将等价负载均衡的条数改为8条</span></span><br><span class="line">R2(config-router)<span class="comment">#maximum-paths 8</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>FD    可行距离     当前路由器到到达目的网络距离</p>
<p>AD    通告距离    下一跳路由器到达目的网络距离</p>
</blockquote>
<p>&emsp;&emsp;当然EIGRP也支持不等价的负载均衡，但需满足条件：</p>
<p>①次优路径的AD值要小于最优路径的FD值（称为FC条件，只有满足了该条件，才会存在FS）。</p>
<p>②当存在FS之后，EIGRP拓扑表会存在两个下一跳，但是只会选择最优的添加进路由表。此时如果要保证路由表也有两条路径，必须手动修改V值(variance)，使得满足”最优路径的FD*V值&gt;次优路径的FD值”（默认情况下，v值为1）</p>
<p>&emsp;&emsp;在本实验中，最优路径为R2→R1到达100.100.100.100，次优路径为经过R2→R3→R1到达100.100.100.100。</p>
<p>&emsp;&emsp;由R2的路由表我们可以得到200.200.200.200→100.100.100.100路由条目的FD值为409600。</p>
<p><img src="https://s1.ax1x.com/2020/09/26/0Pv3wD.png" alt="image-20200926131633249"></p>
<p>&emsp;&emsp;次优路径为R2→R3→R1，因此R3路由表中的200.200.200.200→100.100.100.100路由条目的FD值为R2→R1的AD值为409600。</p>
<p>&emsp;&emsp;因此不满足FC条件，所以可以选择更改AD值（在R3上更改开销）或者FD值（在R2上更改开销）。此处选择将R2中e0/0接口的延迟更改为3000（默认为1000）。</p>
<p><img src="https://s1.ax1x.com/2020/09/26/0PvykQ.png" alt="image-20200926134145060"></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="constructor">R2(<span class="params">config</span>)</span>#<span class="built_in">int</span> e0/<span class="number">0</span></span><br><span class="line">#此处的数值为<span class="number">10</span>倍的关系</span><br><span class="line"><span class="constructor">R2(<span class="params">config</span>-<span class="params">if</span>)</span>#delay ?  </span><br><span class="line">  &lt;<span class="number">1</span>-<span class="number">16777215</span>&gt;  Throughput delay (tens <span class="keyword">of</span> microseconds)</span><br><span class="line"><span class="constructor">R2(<span class="params">config</span>-<span class="params">if</span>)</span>#delay <span class="number">300</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/26/0PvRlq.png" alt="image-20200926134337682"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#重启e0/0端口</span></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#shutdown </span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/26/0Pv4mT.png" alt="image-20200926134602566"></p>
<p>&emsp;&emsp;查看R2的路由表可以得知，此时满足FC条件，次优路径的AD值小于最优路径的FD值，在拓扑表中存在两条路径。此时的FS为R3</p>
<p>&emsp;&emsp;但是此时路由表中到达100.100.100.100仍然只存在一条最优路径；若想让次优路径加表，则需满足最优路径的FD*v值 &gt; 次优路径的FD才能加入到路由表；修改V值为6，此时满足条件，路由表中到达100.100.100.0网段存在两个下一跳。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#router eigrp 90</span></span><br><span class="line">R2(config-router)<span class="comment">#variance 6</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/26/0PvTk4.png" alt="image-20200926135326740"></p>
<p><img src="https://s1.ax1x.com/2020/09/26/0Px9tH.png" alt="image-20200926135524300"></p>
<p>&emsp;&emsp;查看该路由条目的详细信息，可以知道该不等价负载均衡满足1:5的关系。</p>
<p><img src="https://s1.ax1x.com/2020/09/26/0PxF1I.png" alt="image-20200926135704965"></p>
<blockquote>
<p>该实验效果不明显，当查看路由的详细信息时能得到1：5的关系即为实验成功。</p>
</blockquote>
]]></content>
      <categories>
        <category>CCNA实验</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>EIGRP</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP交换综合实验三</title>
    <url>/2019/03/14/CCNP%E4%BA%A4%E6%8D%A2%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%B8%89/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍了 HSRP 的配置与检验；掌握 VRRP 的配置与检验；GLBP 的配置与检验； NTP、Syslog、SNMP、Track 以及 SPAN 技术的应用与配置</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>掌握 HSRP 的配置与检验</p>
</li>
<li><p>掌握 VRRP 的配置与检验</p>
</li>
<li><p>掌握 GLBP 的配置与检验</p>
</li>
<li><p>熟悉 NTP、Syslog、SNMP、Track 以及 SPAN 技术的应用与配置</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p> <img src="https://s1.ax1x.com/2020/09/01/djuPsJ.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考图示，完成物理拓扑的搭建。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/01/djxDrF.png"></p>
<ol start="2">
<li>根据图示，将各主机与 NMS 划分进相应的 VLAN 中，各主机以及 NMS 的地址自己规划，其中 NMS 是一台安装了 SNMP 网管软件、Syslog 日志服务器和网络嗅探器的网络管理服务器，并且两多层交换机做为各 PC 的网关。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在各交换机上创建vlan，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#vlan 10 </span></span><br><span class="line">DSW1(config)<span class="comment">#vlan 20 </span></span><br><span class="line">DSW1(config)<span class="comment">#vlan 30</span></span><br><span class="line"><span class="comment">#将NMS所在的端口划分进vlan 30</span></span><br><span class="line">DSW1(config)<span class="comment">#interface ethernet 0/2</span></span><br><span class="line">DSW1(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">DSW1(config-if)<span class="comment">#switchport access vlan 30</span></span><br><span class="line"><span class="comment">#配置各主机的IP地址，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface e0/0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no switchport </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 11.11.11.1 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface e0/1</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no switchport </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 21.21.21.1 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line"><span class="comment">#将其余与交换机相连的端口设置为trunk，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface range e0/3,e1/0</span></span><br><span class="line">DSW1(config-if-range)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">DSW1(config-if-range)<span class="comment">#switchport mode trunk </span></span><br><span class="line"><span class="comment">#将各PC划分进对应的vlan，此处以ASW1为例。</span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#switchport mode access </span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#switchport access vlan 10 </span></span><br><span class="line"><span class="comment">#在三层交换机上启用SVI端口作为各PC机的网关，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 192.168.10.252 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 192.168.10.252 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line"><span class="comment">#其余配置略</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;各主机的端口配置情况（可以通过端口是否出现在vlan中来判断是否为trunk）：</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxiAgA.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvtr9J.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvNS3j.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvts39.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvN8UO.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvtBh4.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dvt0NF.png"></p>
<ol start="2">
<li>采用 HSRP 协议实现 VLAN10 的主网关为 DSW1，备份网关为 DSW2,VLAN20的主网关为 DSW2，备份网关为 DSW1,在园区网络内采用任意协议实现 PC 机可以访问 Internet 网络，HSRP 组编号应与它们为之提供服务的 VLAN 的编号匹配。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在DSW1上运行HSRP协议</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10</span></span><br><span class="line"><span class="comment">#配置vlan 10的虚拟网关为192.168.10.254（在HRSP协议中，虚拟IP不可以与实际物理IP相同）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 ip 192.168.10.254</span></span><br><span class="line"><span class="comment">#开启抢占模式（优先级高的设备可以抢占优先级低的设备成为主网关，默认关闭）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 preempt</span></span><br><span class="line"><span class="comment">#设置standby 10的优先级为110（可通过设置优先级来确定主/备份设备）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 priority 110</span></span><br><span class="line"><span class="comment">#开启认证，防止非法设备的接入</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 authentication md5 key-string huangzc</span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 20</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 ip 192.168.20.254</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 preempt </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 priority 105</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 authentication md5 key-string huangzc</span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line"><span class="comment">#在DSW2上运行HSRP协议</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 ip 192.168.10.254 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 priority 105 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 authentication md5 key-string huangzc</span></span><br><span class="line">DSW2(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 ip 192.168.20.254 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 priority 110 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 authentication md5 key-string huangzc</span></span><br><span class="line">DSW2(config-if)<span class="comment">#exit</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/01/dxi3gs.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxi13j.png"></p>
<ol start="4">
<li>当多层交换机的上行链路发生故障，确保来自 PC 的流量不会采用次优路径。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建track 10 跟踪DSW1上层链路interface e0/0的状态</span></span><br><span class="line">DSW1(config)<span class="comment">#track 10 interface e0/0 line-protocol </span></span><br><span class="line">DSW1(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line"><span class="comment">#当上层链路发生故障时，DSW1的优先级减少6小于DSW2的105，DSW2成为主网关 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 track 10 decrement 6</span></span><br><span class="line"><span class="comment">#DSW2同理</span></span><br><span class="line">DSW2(config)<span class="comment">#track 20 interface e0/0 line-protocol  </span></span><br><span class="line">DSW2(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 track 20 decrement 6</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;关闭DSW1上e0/0的端口，用追踪路由查看路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW1(config)<span class="comment">#interface e0/0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#shutdown </span></span><br><span class="line">*Sep  1 08:21:57.629: %TRACK-6-STATE: 10 interface Et0/0 line-protocol Up -&gt; Down</span><br><span class="line">*Sep  1 08:21:59.634: %LINK-5-CHANGED: Interface Ethernet0/0, changed state to administratively down</span><br><span class="line">*Sep  1 08:22:00.239: %HSRP-5-STATECHANGE: Vlan10 Grp 10 state Active -&gt; Speak</span><br><span class="line">*Sep  1 08:22:00.637: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/0,changed state to down</span><br><span class="line">*Sep  1 08:22:11.522: %HSRP-5-STATECHANGE: Vlan10 Grp 10 state Speak -&gt; Standby</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;由于DSW1的e0/0端口被关闭，优先级减少6，小于DSW2的105，故DSW1的Group 10状态转为Standby，DSW2的Group 10状态转为Active。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxmmt0.png"></p>
<p>在PC 1上进行对Internet的路由跟踪，从下图可以得知，数据是从DSW2上转发的。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxmDnH.png"></p>
<ol start="5">
<li>删除 HSRP 的配置，使用 VRRP 实现 VLAN10 的主网关为 DSW1，备份网关为 DSW2,VLAN20 的主网关为 DSW2，备份网关为 DSW1, VRRP 组编号应与它们为之提供服务的 VLAN 的编号匹配，如果多层交换机的上行链路发生故障，同样请确保来自 PC 的流量不会采用次优路径。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在DSW1上运行VRRP协议</span></span><br><span class="line">DSW1(config-if)<span class="comment">#interface vlan 10 </span></span><br><span class="line"><span class="comment">#配置vlan 10的虚拟网关为192.168.10.254（在VRRP协议中，虚拟IP可以与实际物理IP相同）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 10 ip 192.168.10.254</span></span><br><span class="line"><span class="comment">#开启抢占模式（优先级高的设备可以抢占优先级低的设备成为主网关，默认开启）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 10 preempt </span></span><br><span class="line"><span class="comment">#设置vrrp 10的优先级为110（可通过设置优先级来确定主/备份设备）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 10 priority 110</span></span><br><span class="line"><span class="comment">#开启认证，防止非法设备的接入</span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 10 authentication text huangzc</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 20 ip 192.168.20.254 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 20 preempt </span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 20 priority 105</span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 20 authentication text huangzc</span></span><br><span class="line"><span class="comment">#在DSW2上运行VRRP协议</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 10 ip 192.168.10.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 10 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 10 priority 105 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 10  authentication text huangzc</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 20 ip 192.168.20.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 20 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 20 priority 110 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 20  authentication text huangzc</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/01/dxoMGD.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxoQRe.png"></p>
<p>&emsp;&emsp;使用track使 PC 的流量不会采用次优路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建track 10 跟踪DSW1上层链路interface e0/0的状态</span></span><br><span class="line">DSW1(config)<span class="comment">#track 10 interface e0/0 line-protocol </span></span><br><span class="line">DSW1(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line"><span class="comment">#当上层链路发生故障时，DSW1的优先级减少6小于DSW2的105，DSW2成为主网关 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#vrrp 10 track 10 decrement 6</span></span><br><span class="line"><span class="comment">#DSW2同理</span></span><br><span class="line">DSW2(config)<span class="comment">#track 20 interface e0/0 line-protocol  </span></span><br><span class="line">DSW2(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#vrrp 20 track 20 decrement 6</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;关闭DSW2 的e0/0, 用追踪路由查看路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW2(config)<span class="comment">#interface e0/0</span></span><br><span class="line">DSW2(config-if)<span class="comment">#shutdown </span></span><br><span class="line">*Sep  1 09:03:34.438: %TRACK-6-STATE: 20 interface Et0/0 line-protocol Up -&gt; Down</span><br><span class="line">*Sep  1 09:03:34.443: %OSPF-5-ADJCHG: Process 110, Nbr 12.12.12.2 on Ethernet0/0 from FULL to DOWN, Neighbor Down: Interface down or detached</span><br><span class="line">*Sep  1 09:03:36.441: %LINK-5-CHANGED: Interface Ethernet0/0, changed state to administratively down</span><br><span class="line">*Sep  1 09:03:37.449: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/0, changed state to down</span><br><span class="line">*Sep  1 09:03:37.722: %VRRP-6-STATECHANGE: Vl20 Grp 20 state Master -&gt; Backup</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;由于DSW2的e0/0端口被关闭，优先级减少6，小于DSW2的105，故DSW2的Group 20状态转为Backup，DSW1的Group 10状态转为Master。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxrEz8.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxrmLQ.png"></p>
<ol start="6">
<li>删除 VRRP 的配置，在该园区网络中部署 GLBP 实现各 VLAN 的主机可以同时通过DSW1 和DSW2 进行外部网络资源的访问，并且实现DSW1 为VLAN10 的 AVG，DSW2 为 VLAN20 的 AVG。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在DSW1上运行GLBP协议</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line"><span class="comment">#配置vlan 10的虚拟网关为192.168.10.254（在GLBP协议中，虚拟IP不可以与实际物理IP相同）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 ip 192.168.10.254</span></span><br><span class="line"><span class="comment">#开启抢占模式（优先级高的设备可以抢占优先级低的设备成为主网关，默认关闭）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 preempt </span></span><br><span class="line"><span class="comment">#设置glbp 10的优先级为120（可通过设置优先级来确定AVG/AVF设备）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 priority 120 </span></span><br><span class="line"><span class="comment">#开启认证，防止非法设备的接入</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 authentication md5 key-string huangzc</span></span><br><span class="line"><span class="comment">#修改负载均衡方式</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 load-balancing weighted </span></span><br><span class="line"><span class="comment">#修改权重为140。（最低为100，最高为140。如果权重低于100，将不能进行数据的转发。如果想恢复转发数据，那么权重必须大于或等于140）</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 weighting 140 lower 100 upper 140</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 ip 192.168.20.254</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 preempt </span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 priority 110 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 authentication md5 key-string huangzc</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 load-balancing weighted </span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 20 weighting 140 lower 100 upper 140</span></span><br><span class="line"><span class="comment">#在DSW2上运行GLBP协议</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 ip 192.168.10.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 priority 110</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 authentication md5 key-string huangzc</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 load-balancing weighted </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 10 weighting 140 lower 100 upper 140</span></span><br><span class="line">DSW2(config-if)<span class="comment">#interface vlan 20</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 ip 192.168.20.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 priority 120 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 authentication md5 key-string huangzc</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 load-balancing weighted </span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 weighting 140 lower 100 upper 140</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看GLBP的详细信息，DSW1为Vlan 10的AVG，负责分发虚拟MAC地址，AVG同时也可以是AVF。DSW2为Vlan 20的AVF。DSW2为Vlan 20的AVG，负责分发虚拟MAC地址，同时也是AVF。DSW1为Vlan 20的AVF。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxWAK0.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxWVbT.png"></p>
<p>&emsp;&emsp;在PC1与PC2上对路由进行跟踪，PC1的数据由DSW1转发，PC2的数据由DSW2转发。实现负载均衡。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dx4ma8.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dx4MGQ.png"></p>
<p>&emsp;&emsp;使用track使 PC 的流量不会采用次优路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#创建track 10 跟踪DSW1上层链路interface e0/0的状态</span></span><br><span class="line">DSW1(config)<span class="comment">#track 10 interface e0/0 line-protocol </span></span><br><span class="line">DSW1(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line"><span class="comment">#当上层链路发生故障时，DSW1的权重减少50为90，小于100，无法转发数据</span></span><br><span class="line">DSW1(config-if)<span class="comment">#glbp 10 weighting track 10 decrement 50</span></span><br><span class="line"><span class="comment">#DSW2同理</span></span><br><span class="line">DSW2(config)<span class="comment">#track 20 interface e0/0 line-protocol  </span></span><br><span class="line">DSW2(config-track)<span class="comment">#exit</span></span><br><span class="line">DSW2(config-if)<span class="comment">#interface vlan 20</span></span><br><span class="line">DSW2(config-if)<span class="comment">#glbp 20 weighting track 20 decrement 50</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;关闭DSW2 的e0/0, 用追踪路由查看路径：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW1(config)<span class="comment">#interface e0/0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#shutdown </span></span><br><span class="line">*Sep  1 11:35:58.763: %TRACK-6-STATE: 10 interface Et0/0 line-protocol Up -&gt; Down</span><br><span class="line">*Sep  1 11:36:00.762: %LINK-5-CHANGED: Interface Ethernet0/0, changed state to administratively down</span><br><span class="line">*Sep  1 11:36:01.768: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/0, changed state to down</span><br><span class="line">*Sep  1 11:36:29.913: %GLBP-6-FWDSTATECHANGE: Vlan10 Grp 10 Fwd 2 state Active -&gt; Listen</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;当上层链路发生故障时，DSW1的Group 10的权重小于100，故不能转发数据，处于Listen状态。但是DSW1仍是Group 10 的AVG，它将原本自己的MAC地址分配给了DSW2的Group 10，因此，此时的DSW2的负责Vlan 10的所有数据转发。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxfxhQ.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxh9cn.png"></p>
<p>&emsp;&emsp;PC1与PC2访问Internet时，均为DSW2转发。</p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxhy4g.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/01/dxh2gs.png"></p>
<ol start="7">
<li>在路由器 R1 上设置路由器的当前时间为 12:00:00 Mar 7 2019，时区为 CN， NTP 的master 值为2，使用安全的方式实现多层交换通过R1 完成时钟同步。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#clock set 12:00:00 Mar 7 2019</span></span><br><span class="line">R1(config)<span class="comment">#clock timezone CN +8</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;Server：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#ntp master 2</span></span><br><span class="line">R1(config)<span class="comment">#int range e0/0-2</span></span><br><span class="line">R1(config-if-range)<span class="comment">#ntp broadcast </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;Client :</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW1(config)<span class="comment">#int e0/0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#ntp broadcast client </span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>将多层交换以及 R1 上的日志信息发送到 NMS 上的 Syslog 日志服务器上， 并且设置这些设备的 Log Buffer 为 8192 bytes，logging trap 为 5。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#logging buffered 8192</span></span><br><span class="line">R1(config)<span class="comment">#logging trap 5    </span></span><br><span class="line">R1(config)<span class="comment">#logging host 192.168.30.1</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li>在 R1 上设置 SNMP 的 community 为huangzc，并且权限为 RW，通过 PC 机上的 SNMP 工具实现对 R1 设备的管理和监控。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#snmp-server community huangzc rw </span></span><br></pre></td></tr></table></figure>

<ol start="10">
<li>使用 SPAN 将 DSW1 上的 VLAN10 数据发送到 NMS 上进行流量分析。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW1(config)<span class="comment">#no monitor session all </span></span><br><span class="line">DSW1(config)<span class="comment">#monitor session 8 source vlan 10 </span></span><br><span class="line">DSW1(config)<span class="comment">#monitor session 8 destination interface e0/2</span></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>交换</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP交换综合实验一</title>
    <url>/2019/02/18/CCNP%E4%BA%A4%E6%8D%A2%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%B8%80/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍VLAN、TRUNK、VTP 的作用和配置；DTP 的作用和配置；DHCP 及 DHCP 中继的作用和配置；掌握以太通道技术的作用和配置。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>掌握 VLAN、TRUNK、VTP 的作用和配置</p>
</li>
<li><p>掌握 DTP 的作用和配置</p>
</li>
<li><p>掌握 DHCP 及 DHCP 中继的作用和配置</p>
</li>
<li><p>掌握以太通道技术的作用和配置</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTTPG6.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考图示，完成物理拓扑的搭建。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/08/28/dTeUVH.png"></p>
<ol start="2">
<li>在该园区网络中有 4 个 VLAN，分别为 VLAN10、VLAN20、VLAN30 和VLAN40，其中 DHCP SRV 和 PC1 在 VLAN10 中，PC2、PC3 分别在VLAN20和 VLAN30 中，FTP SRV 和 PC4 在 VLAN40 中，其中 VLAN10 的地址段为192.168.10.0/24，VLAN20 的地址段为 192.168.20.0/24，VLAN30 的地址段为 192.168.30.0/24，VLAN40 的地址段为 192.168.40.0/24，各 VLAN 主机的网关都设置为其网段中可用的最后一个主机地址，并且设置 DHCP 服务器的 IP 地址为 192.168.10.100/24，其他主机通过 DHCP 方式获取 IP 地址, 园区网络外部的地址自己规划。</li>
</ol>
<p>&emsp;①网关地址：</p>
<p><img src="https://s1.ax1x.com/2020/08/28/dTexRx.png"></p>
<p>&emsp;②各主机通过DHCP获取IP地址：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTL0r8.png"></p>
<ol start="3">
<li>采用合适的方式完成交换机链路间的 TRUNK 配置，并采用标准的封装模式。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/08/29/dTLbGR.png"></p>
<ol start="4">
<li>设置 SW1 的 VTP 模式为 Server，SW2 的 VTP 模式为 Client，并且设置 VTP 域名为 Company.com，密码为 CCIEPASS，实现该园区网络的 VLAN 信息同步。</li>
</ol>
<p>&emsp;&emsp;对SW1和SW2VTP进行设置：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTOLkQ.png"></p>
<p>&emsp;&emsp;SW2的VLAN信息：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTnjv6.png"></p>
<ol start="5">
<li>使用 802.3ad 标准构建两交换机间的以太通道链路, 要求交换机将EtherChannel 的负载均衡设置为 src-dst-ip</li>
</ol>
<p>&emsp;&emsp;证捆绑端口的特性都是一样，所以都配置成trunk端口。</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTu9Ve.png"></p>
<ol start="6">
<li>根据需求在 DHCP SRV 上建立相应的地址池，并且在各个地址池中排除范围从 10 到 20 之间的 IP 地址空间，同时要求无论 FTP SRV 何时接入交换网络都会获取到 192.168.40.100/24 的地址。</li>
</ol>
<p>&emsp;&emsp;在各地址池中排除10-20的IP地址：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTuP5d.png"></p>
<p>&emsp;&emsp;在DHCP_Srv中建立一个特定的地址池用使FTP_Srv何时接入交换网络都会获取到 192.168.40.100/24 的地址（由于不知道FTP_Srv的MAC地址，所以先让FTP_Srv使用DHCP获取IP地址，再从DHCP_Srv的 ip dhcp pool binding 得到FTP_Srv的电路ID进行绑定）。</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTuExP.png"></p>
<p>FTP_Srv用DHCP获取IP地址：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTuer8.png"></p>
<ol start="7">
<li>完成其他必要的配置，实现各主机和 FTP SRV 可以获取相应的 IP 地址，并且实现各主机可以访问 ISP 上的 Web SRV。</li>
</ol>
<p>&emsp;①启用OSPF实现内网全网可达：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/d7sGvt.png"></p>
<p>&emsp;②实现外网可达：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/d7sLVO.png"></p>
<p>③  配置NAT：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/d7s6K0.png"></p>
<p>④  用R1给邻居下发默认路由：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTuqeS.png"></p>
<p>⑤  主机可以访问 ISP 上的 Web SRV：</p>
<p><img src="https://s1.ax1x.com/2020/08/29/dTuLdg.png"></p>
<p>【实验中用到的代码】</p>
<p><strong>VTP：</strong></p>
<p>vtp mode server———————————————将VTP的模式该为server模式</p>
<p>vtp domain Company.com ——————————–将VTP的域名改为Company.com</p>
<p>vtp password CCIEPASS————————————–密码设置为CCIEPASS</p>
<p>vtp mode client————————————————将VTP的模式该为client模式（该模式下不能对VLAN进行设置）</p>
<p>当域名与密码相同时才能进行同步</p>
<p>NAT：</p>
<p>access-list 1 permit 192.168.0.0 0.0.255.255———–匹配感兴趣流量（通过ACL来实现）</p>
<p>ip nat inside source list 1 interface e0/1 overload——将ACL使用在NAT中</p>
<p>int e0/0<br> ip nat inside<br> int e0/1<br> ip nat outside——————————————————–指定内、外接口</p>
<p>捆绑链路：</p>
<p>int range e0/1-2</p>
<p>switchport truck encapsulation do1q</p>
<p>switchport mode truck————————————-保证捆绑端口的特性都是一样，所以都配置成trunk端口</p>
<p>channel-protocol lacp—————————————指定捆绑协议lacp；可选</p>
<p>channel-group 1 mode active—————————–创建端口捆绑组号码，组号码是本地有效的，模式为active</p>
<p>下发默认路由：</p>
<p>router ospf 1</p>
<p>default-information originate—————————–给邻居下发默认路由</p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>交换</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP交换综合实验二</title>
    <url>/2019/03/07/CCNP%E4%BA%A4%E6%8D%A2%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%BA%8C/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍了 RSTP 的配置与检验； MST 的配置与检验；生成树特性的应用；实现 VLAN 间的通信。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>掌握 RSTP 的配置与检验</p>
</li>
<li><p>掌握 MST 的配置与检验</p>
</li>
<li><p>掌握生成树特性的应用</p>
</li>
<li><p>实现 VLAN 间的通信</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOdkOP.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考图示，完成物理拓扑的搭建。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/08/31/dOdQln.png"></p>
<ol start="2">
<li>在该园区网络中有 4 个 VLAN，VLAN10、VLAN20、VLAN30 和 VLAN40，要求在 DSW1 上创建这些 VLAN，其他交换机同步 DSW1 上的 VLAN 信息，并且设置 VTP 域名为 huang.com，VTP 密码为 huang，所有 TRUNK 链路全部采用标准的封装模式。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/08/31/dOdtkF.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOdwlR.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOdckD.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOwSBV.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOwk9J.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOwKAO.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOwovR.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOwrgs.png"></p>
<ol start="3">
<li>DSW1 与 DSW2 之间的链路不足以传递园区内部流量，使用合适的方式建立DSW1 与 DSW2 之间的以太通道链路。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/08/31/dOBmFO.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOBnYD.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOBZTK.png"></p>
<ol start="4">
<li>要求全网启用基于 802.1w 标准的生成树，并且实现 DSW1 为 VLAN 10 和 20 的主根，为 VLAN 30 和 40 的次根，实现 DSW2 为 VLAN 10 和 20 的次根， 为 VLAN 30 和 40 的主根,并且哪怕将来在接入层中有新的交换机添加进园区网络，也要确保这两台交换机的地位。</li>
</ol>
<p>&emsp;&emsp;全网启用基于 802.1w 标准的生成树：</p>
<p> <img src="https://s1.ax1x.com/2020/08/31/dODsvd.png"></p>
<p>&emsp;&emsp;实现 DSW1 为 VLAN 10 和 20 的主根，为 VLAN 30 和 40 的次根，实现 DSW2 为 VLAN 10 和 20 的次根， 为 VLAN 30 和 40 的主根：</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOrFVx.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOrPq1.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOrCrR.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOrAIK.png"></p>
<p>&emsp;&emsp;确保两台交换机的地位：</p>
<p> <img src="https://s1.ax1x.com/2020/08/31/dOrka6.png"></p>
<ol start="5">
<li>各 PC 和 VLAN 的 IP 编址如下表：</li>
</ol>
<table>
<thead>
<tr>
<th><strong>设备</strong></th>
<th><strong>VLAN</strong></th>
<th><strong>IP 地址</strong></th>
<th><strong>默认网关</strong></th>
</tr>
</thead>
<tbody><tr>
<td>PC1</td>
<td>10</td>
<td>192.168.10.100</td>
<td>192.168.10.254</td>
</tr>
<tr>
<td>PC2</td>
<td>20</td>
<td>192.168.20.100</td>
<td>192.168.20.254</td>
</tr>
<tr>
<td>PC3</td>
<td>30</td>
<td>192.168.30.100</td>
<td>192.168.30.254</td>
</tr>
<tr>
<td>PC4</td>
<td>40</td>
<td>192.168.40.100</td>
<td>192.168.40.254</td>
</tr>
</tbody></table>
<ol start="6">
<li>要求连接这些主机的交换端口忽视生成树过程，能够直接进入到转发状态， 并且这些端口在接收到配置 BPDU 时就进入 err-disrable 状态。</li>
</ol>
<p>&emsp;&emsp;忽视生成树过程，直接进入到转发状态：</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOcQ1S.png"></p>
<p>&emsp;&emsp;端口在接收到配置 BPDU 时就进入 err-disrable 状态：</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOcMp8.png"></p>
<ol start="7">
<li>在 R1 上完成必要的配置，实现各 PC 间可以互相访问。</li>
</ol>
<p>&emsp;&emsp;配置单臂路由，实现各PC间可以互相访问：</p>
<p>&emsp;&emsp;①  将子接口划分进各个VLAN中</p>
<p>&emsp;&emsp;②  在子接口中配置各网段的网关地址 </p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOc1XQ.png"></p>
<p>&emsp;&emsp;③  PC间实现互相访问</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOcl6g.png"></p>
<ol start="8">
<li>随着网络规模的扩大，该园区网将来可能需要配置更多的 VLAN，大量的VLAN 实例会影响交换机的性能，要求将该客户网络迁移到 MST 中，具体MST 需求如下：</li>
</ol>
<ul>
<li><p>创建两个 MST 实例，MST1 和 MST2，其中 MST1 用于 VLAN 10 到 25, MST2 用于 VLAN 26 到 50，其它 VLAN 属于 CIST。</p>
</li>
<li><p>使用 MST 区域名“SWITCH”，修订号“1”。</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2020/08/31/dO2MLQ.png"></p>
<ul>
<li>将 DSW1 配置为 MST1 及 CIST 的主根，为 MST2 的次根。</li>
</ul>
<p><img src="https://s1.ax1x.com/2020/08/31/dO2lZj.png"></p>
<ul>
<li>将 DSW2 配置为 MST2 的主根，为 MST1 及 CIST 的次根。</li>
</ul>
<p><img src="https://s1.ax1x.com/2020/08/31/dO2JJ0.png"></p>
<p>&emsp;&emsp;实验结果：</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTVFe.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTJYQ.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTUln.png"></p>
<ol start="9">
<li><p>该客户网络进行了升级，购买了两台新的多层交换机，升级之后的网络拓扑如下，其中客户所属的 VLAN 角色及地址段信息保持不变</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTBwT.png"></p>
</li>
<li><p>现要求你完成如下网络配置：</p>
</li>
</ol>
<ul>
<li><p>配置DSW1 和DSW2 以执行 VLAN 间路由。将 DSW1 用作与交换机ASW1 连接的 PC1 和 PC2 的默认网关。连接 DSW2 的客户端使用 DSW2 作为默认网关，所有 PC 都保留网络升级改造之前的 IP 地址和默认网关。</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTv0f.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dO7SAS.png"></p>
</li>
<li><p>R1 与两多层交换机链路的 IP 地址，以及园区外部的 ISP 和 Web SRV 地址自行规划。</p>
</li>
</ul>
<p>&emsp;&emsp;各接口的具体地址如下图所示。</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTx78.png"></p>
<ul>
<li><p>在园区网络内启用 OSPF，并且将园区网络划分到区域 0 中。</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dOTjnP.png"></p>
</li>
<li><p>将 ASW1 和 DSW1 之间的链路捆绑到一个基于标准的 EtherChannel 中。</p>
</li>
</ul>
<p>&emsp;&emsp;具体实现方法已在3中详细列出，在此不在列出。</p>
<ul>
<li>完成其他必要配置，实现各 VLAN 间的用户可以互相通信，并且实现园区网络内的用户可以访问 ISP 上的 Web SRV。</li>
</ul>
<p>&emsp;&emsp;由于前面以实现内网全网可达，外网也实现了可达性。故只需在R1上配置NAT。</p>
<p><img src="https://s1.ax1x.com/2020/08/31/dXJ3bF.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dXJGE4.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dXJ1DU.png"></p>
<p><img src="https://s1.ax1x.com/2020/08/31/dXJBDO.png"></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>交换</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP交换综合实验四</title>
    <url>/2019/03/21/CCNP%E4%BA%A4%E6%8D%A2%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E5%9B%9B/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍了掌握交换端口安全的应用与配置；DHCP SNOOPING 的应用与配置；DAI 的应用与配置；IP SG 的应用与配置；PVLAN 的应用与配置；802.1x 的应用与配置 。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>掌握交换端口安全的应用与配置</p>
</li>
<li><p>掌握 DHCP SNOOPING 的应用与配置</p>
</li>
<li><p>掌握 DAI 的应用与配置</p>
</li>
<li><p>掌握 IP SG 的应用与配置</p>
</li>
<li><p>熟悉 PVLAN 的应用与配置</p>
</li>
<li><p>熟悉 802.1x 的应用与配置 </p>
</li>
</ol>
<p>【实验拓扑】</p>
<p> <img src="https://s1.ax1x.com/2020/09/02/wpEfUI.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考图示，完成物理拓扑的搭建</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/02/wpEWVA.png"></p>
<ol start="2">
<li>根据图示，将各主机、DHCP 服务器以及 ACS 服务器划分进相应的 VLAN 中， 各 VLAN 地址段信息，以及路由器与多层交换间链路的地址自己规划，其中VLAN10 和 VLAN20 的主机通过 DHCP 方式获取 IP 地址。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在各交换机上创建vlan，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#vlan 10,20,30,40 </span></span><br><span class="line"><span class="comment">#将ACS所在的端口划分进vlan 30</span></span><br><span class="line">DSW1(config)<span class="comment">#interface ethernet 0/1</span></span><br><span class="line">DSW1(config-if)<span class="comment">#switchport mode access </span></span><br><span class="line">DSW1(config-if)<span class="comment">#switchport access vlan 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置各主机的IP地址，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface e0/0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no switchport </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 11.11.11.1 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface e0/3</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no switchport </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 21.21.21.1 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将其余与交换机相连的端口设置为trunk，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface range e1/0-1</span></span><br><span class="line">DSW1(config-if-range)<span class="comment">#switchport trunk encapsulation dot1q </span></span><br><span class="line">DSW1(config-if-range)<span class="comment">#switchport mode trunk </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将各PC划分进对应的vlan，此处以ASW1为例。</span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#switchport mode access </span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#switchport access vlan 10 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在三层交换机上启用SVI端口作为各PC机的网关，此处以DSW1为例。</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 192.168.10.252 255.255.255.0</span></span><br><span class="line"><span class="comment">#由于各PC机与DHCP服务器不在同一Vlan中，所以需要配置DHCP中继来确保PC能够通过DHCP获取IP地址</span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip helper-address 192.168.40.100</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line">DSW1(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip address 192.168.10.252 255.255.255.0</span></span><br><span class="line">DSW1(config-if)<span class="comment">#ip helper-address 192.168.40.100</span></span><br><span class="line">DSW1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DSW1(config-if)<span class="comment">#exit</span></span><br><span class="line"><span class="comment">#其余配置略</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/02/w98NgH.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w98s58.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w93s1J.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w91tIO.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w91Eq0.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w91KG4.png"></p>
<ol start="3">
<li>在该园区网络内部署合适的第一跳冗余技术以及合适的路由协议，并且要求在正常情况下，DSW1 作为 VLAN10 主网关，DSW2 作为 VLAN20 的主网关， DSW1 和 DSW2 中的任何一台设备出现故障都不能影响用户的网络访问。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在DSW1上启用HRSP协议，使DSW1作为Vlan 10的主网关</span></span><br><span class="line">DSW1(config)<span class="comment">#track 10 interface e0/0 line-protocol </span></span><br><span class="line">DSW1(config)<span class="comment">#intterface vlan 10 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 ip 192.168.10.254</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 preempt </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 priority 110 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby authentication md5 key-string huangzc</span></span><br><span class="line"><span class="comment">#当上层链路发生故障时，DSW1的优先级减少6小于DSW2的105，DSW2成为Vlan 10的主网关 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 10 track 10 decrement 6</span></span><br><span class="line">DSW1(config-if)<span class="comment">#intterface vlan 20 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 ip 192.168.20.254 </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 preempt </span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 priority 105</span></span><br><span class="line">DSW1(config-if)<span class="comment">#standby 20 authentication md5 key-string huangzc</span></span><br><span class="line"><span class="comment">#在DSW2上启用HRSP协议，使DSW2作为Vlan 20的主网关</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 10 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 ip 192.168.10.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 preempt  </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 priority 105</span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 10 authentication md5 key-string huangzc</span></span><br><span class="line">DSW2(config-if)<span class="comment">#exit </span></span><br><span class="line">DSW2(config)<span class="comment">#track 20 interface e0/0 line-protocol</span></span><br><span class="line">DSW2(config)<span class="comment">#interface vlan 20 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 ip 192.168.20.254</span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 preempt </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 priority 110</span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 authentication md5 key-string huangnzc</span></span><br><span class="line"><span class="comment">#当上层链路发生故障时，DSW2的优先级减少6小于DSW2的105，DSW1成为Vlan 20的主网关 </span></span><br><span class="line">DSW2(config-if)<span class="comment">#standby 20 track 20 decrement 6</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/02/w9J9wq.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9JFYT.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9Y6PK.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9Y8U0.png"></p>
<ol start="4">
<li>要求连接所有 PC 机和 SRV 的端口忽视生成树过程，直接跳转到转发状态。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DSW1(config)<span class="comment">#spanning-tree mode rapid-pvst  </span></span><br><span class="line">DSW1(config)<span class="comment">#interface e0/1</span></span><br><span class="line">DSW1(config-if)<span class="comment">#spanning-tree portfast edge </span></span><br><span class="line"></span><br><span class="line">DSW2(config)<span class="comment">#spanning-tree mode rapid-pvst </span></span><br><span class="line">DSW2(config)<span class="comment">#interface e0/1</span></span><br><span class="line">DSW2(config-if)<span class="comment">#spanning-tree portfast edge </span></span><br><span class="line"></span><br><span class="line">ASW1(config)<span class="comment">#spanning-tree mode rapid-pvst   </span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#spanning-tree portfast </span></span><br><span class="line"></span><br><span class="line">ASW2(config)<span class="comment">#spanning-tree mode rapid-pvst      </span></span><br><span class="line">ASW2(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line">ASW2(config-if-range)<span class="comment">#spanning-tree portfast </span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>完成必要配置，实现 VLAN10 和 VLAN20 的主机可以通过 DHCP 获取 IP 地址，并且各主机可以访问因特网。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置DHCP服务器,使得vlan 10，vlan 20的主机通过DHCP的方式获取IP地址</span></span><br><span class="line">DHCP(config)<span class="comment">#interface e0/1</span></span><br><span class="line">DHCP(config-if)<span class="comment">#ip address 192.168.40.100 255.255.255.0</span></span><br><span class="line">DHCP(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">DHCP(config-if)<span class="comment">#exit </span></span><br><span class="line">DHCP(config)<span class="comment">#ip dhcp pool vlan 10 </span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#network 192.168.10.0 255.255.255.0</span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#default-router 192.168.10.254 </span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#dns-server 8.8.8.8</span></span><br><span class="line">DHCP(config)<span class="comment">#ip dhcp pool vlan 20</span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#network 192.168.20.0 255.255.255.0</span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#default-router 192.168.20.254 </span></span><br><span class="line">DHCP(dhcp-config)<span class="comment">#dns-server 8.8.8.8</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/02/w9Ja7t.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9JwAP.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9JU0I.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9JNnA.png"></p>
<p>&emsp;&emsp;在R1上配置NAT，使各主机能够访问Internet</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置ACL，匹配感兴趣流量</span></span><br><span class="line">R1(config)<span class="comment">#access-list 1 permit 192.168.10.0 0.0.0.255 </span></span><br><span class="line">R1(config)<span class="comment">#access-list 1 permit 192.168.20.0 0.0.0.255 </span></span><br><span class="line"><span class="comment">#指定内外接口</span></span><br><span class="line">R1(config)<span class="comment">#interface e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line">R1(config)<span class="comment">#int range e0/1-2</span></span><br><span class="line">R1(config-if-range)<span class="comment">#ip nat inside</span></span><br><span class="line"><span class="comment">#配置NAT，将内网IP地址转换为外网IP地址</span></span><br><span class="line">R1(config)<span class="comment">#ip nat inside source list 1 interface e0/0 overload </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;使用PC 1访问Internet：</p>
<p><img src="https://s1.ax1x.com/2020/09/02/w9JQk6.png"></p>
<ol start="6">
<li>在 ASW1 和 ASW2 上，采用合适的方式实现连着 PC 的接口避免 MAC 地址洪泛攻击，并且一个接口只允许接入一台 PC，当有非法 PC 接入时，能够产生告警消息。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ASW1(config)<span class="comment">#int range e0/1-2</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#switchport port-security maximum 1</span></span><br><span class="line">ASW2(config)<span class="comment">#int range e0/1-2</span></span><br><span class="line">ASW2(config-if-range)<span class="comment">#switchport port-security maximum 1</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>将连接 PC1 的端口设置成该端口只允许 PC1 接入，实现任何情况下，其他主机都不允许通过该端口接入园区网络。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#将PC机与交换机对应的端口绑定起来，防止其他主机通过该端口接入园区网络</span></span><br><span class="line">ASW1(config)<span class="comment">#interface e0/1</span></span><br><span class="line">ASW1(config-if)<span class="comment">#switchport port-security mac-address sticky </span></span><br><span class="line">ASW1(config-if)<span class="comment">#switchport port-security mac-address 00:50:79:66:68:09</span></span><br><span class="line"></span><br><span class="line">ASW1(config)<span class="comment">#interface e0/2</span></span><br><span class="line">ASW1(config-if)<span class="comment">#switchport port-security mac-address sticky </span></span><br><span class="line">ASW1(config-if)<span class="comment">#switchport port-security mac-address 00:50:79:66:68:0a</span></span><br><span class="line"></span><br><span class="line">ASW2(config)<span class="comment">#int e0/1</span></span><br><span class="line">ASW2(config-if)<span class="comment">#switchport port-security mac-address sticky </span></span><br><span class="line">ASW2(config-if)<span class="comment">#switchport port-security mac-address 00:50:79:66:68:0b</span></span><br><span class="line"></span><br><span class="line">ASW2(config)<span class="comment">#int e0/2                                                    </span></span><br><span class="line">ASW2(config-if)<span class="comment">#switchport port-security mac-address sticky                 </span></span><br><span class="line">ASW2(config-if)<span class="comment">#switchport port-security mac-address 00:50:79:66:68:0c</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>为了确保该园区网内的用户可以正常获取 IP 地址，避免未授权的 DHCP 服务器接入，在该园区网合适的交换机上部署 DHCP Snooping 技术，并且为了提高园区网的安全，最大限度的降低 ARP 攻击和 IP 地址欺骗等攻击对网络造成的影响，在合适的交换机上部署动态 ARP 检测和 IP 源防护技术。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在DSW2上部署DHCP Snooping 技术</span></span><br><span class="line">DSW2(config)<span class="comment">#ip dhcp snooping </span></span><br><span class="line"><span class="comment">#在ASW1部署动态ARP检测</span></span><br><span class="line">ASW1(config)<span class="comment">#ip arp inspection vlan 10 </span></span><br><span class="line"><span class="comment">#将e0/1设置为信任端口</span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line"><span class="comment">#将非信任端口设置限制速率（此处的非信任端口为所有闲置端口）</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#ip arp inspection trust </span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/0,e0/3,e0/2-3</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#ip arp inspection limit rate 10</span></span><br><span class="line"><span class="comment">#在e0/1、e0/2上部署IP源防护技术</span></span><br><span class="line">ASW1(config)<span class="comment">#interface range e0/1-2</span></span><br><span class="line">ASW1(config-if-range)<span class="comment">#ip verify source port-security</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li>实现其他 PC 通过 ASW1 接入园区网络的时候，需要通过 802.1x 认证才能正常连入网络，如果PC 不支持802.1X 认证，那么就将该PC 划分到来宾VLAN60 里面，要求认证方式使用 AAA。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ASW1(config)<span class="comment">#aaa new-model </span></span><br><span class="line">ASW1(config)<span class="comment">#aaa authentication login default group radius local enable none </span></span><br></pre></td></tr></table></figure>

<ol start="10">
<li><p>在 ACS 上添加一个账户，用户名和密码自定，实现该用户通过 802.1x 验证后，就被自动划分到 VLAN50。</p>
</li>
<li><p>要求对所有设备的vty 登录都采用AAA 认证，并且当 AAA 服务器不可达时， 采用本地数据库进行认证。</p>
</li>
</ol>
<p>&emsp;&emsp;<strong>由于受到实验条件的限制，第10、11条要求暂时无法实现。</strong></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>交换</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP路由综合实验一</title>
    <url>/2019/03/28/CCNP%E8%B7%AF%E7%94%B1%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%B8%80/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 OSPF 的基本配置；OSPF 网络类型的应用；不连续区域的网络环境及不连续区域对 OSPF 路由选择的影响； OSPF 不连续区域的几种解决方案； OSPF 区域间和外部路由的汇总； OSPF 默认路由的配置及控制。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>熟悉 OSPF 的基本配置</p>
</li>
<li><p>熟悉OSPF 网络类型的应用</p>
</li>
<li><p>理解不连续区域的网络环境及不连续区域对 OSPF 路由选择的影响</p>
</li>
<li><p>掌握 OSPF 不连续区域的几种解决方案</p>
</li>
<li><p>掌握 OSPF 区域间和外部路由的汇总</p>
</li>
<li><p>掌握 OSPF 默认路由的配置及控制</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p><img src="https://s1.ax1x.com/2020/09/03/wipiIP.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考拓扑，完成各路由器的基本配置，除图示地址标识外，设备间的地址自己规划，并分别在路由器 R1、R2、R3、R5 和R6 上各起一个loopback 接口，地址为各路由器的编号，如 R1 的 loopback 地址就为 1.1.1.1，其他以此类推；</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/03/wipPat.png"></p>
<p>&emsp;&emsp;各路由器的基本配置以安装上图所示的地址标识配置完成，此处不再列出具体的配置代码。另外，各，在该拓扑中，各PC机均使用路由器上的Lookback端口模拟，如R9上的172.16.1.1/24、172.16.2.1/24……。以R1、R4的端口配置情况为例。</p>
<p><img src="https://s1.ax1x.com/2020/09/06/we58CF.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/06/we5NuR.png"></p>
<ol start="2">
<li>除ISP 区域外，全网启用 OSPF，并设置各路由器的 RID 为各路由器的编号，根据图示将各网段划分进相应的 OSPF 区域中，要求在 R5 上采用接口级命令将R5 相应的接口加入到 OSPF 区域中，在其他路由器上采用合适的方式启用 OSPF，并在 R2 上进行EIGRP 和 OSPF 的双向重分布；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R1上启用OSPF协议</span></span><br><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R1(config-router)<span class="comment">#network 1.1.1.0 0.0.0.255 area 0</span></span><br><span class="line">R1(config-router)<span class="comment">#network 12.12.12.0 0.0.0.255 area 0 </span></span><br><span class="line">R1(config-router)<span class="comment">#network 16.16.16.0 0.0.0.255 area 0 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R2上启用OSPF协议</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#network 2.2.2.0 0.0.0.255 area 0</span></span><br><span class="line">R2(config-router)<span class="comment">#network 12.12.12.0 0.0.0.255 area 0  </span></span><br><span class="line">R2(config-router)<span class="comment">#network 23.23.23.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R2上启用EIGRP协议</span></span><br><span class="line">R2(config)<span class="comment">#router eigrp 110 </span></span><br><span class="line">R2(config-router)<span class="comment">#network 29.0.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在 R2 上进行EIGRP 和 OSPF 的双向重分布</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute eigrp 110 subnets</span></span><br><span class="line">R2(config)<span class="comment">#router eigrp 110 </span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute ospf 1 metric 1 1 1 1 1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R3上启用OSPF协议</span></span><br><span class="line">R3(config-router)<span class="comment">#router ospf 1   </span></span><br><span class="line">R3(config-router)<span class="comment">#network 3.3.3.0 0.0.0.255 area 0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 23.23.23.0 0.0.0.255 area 0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 34.34.34.0 0.0.0.255 area 345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R4上启用OSPF协议</span></span><br><span class="line">R4(config-router)<span class="comment">#router ospf 1    </span></span><br><span class="line">R4(config-router)<span class="comment">#network 45.45.45.0 0.0.0.255 area 345</span></span><br><span class="line">R4(config-router)<span class="comment">#network 34.34.34.0 0.0.0.255 area 345</span></span><br><span class="line">R4(config-router)<span class="comment">#network 192.168.0.0 0.0.255.255 area 345 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R5上启用OSPF协议</span></span><br><span class="line">R5(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R5(config-router)<span class="comment">#network 45.45.45.0 0.0.0.255 area 345</span></span><br><span class="line">R5(config-router)<span class="comment">#network 56.56.56.0 0.0.0.255 area 0</span></span><br><span class="line">R5(config-router)<span class="comment">#network 57.57.57.0 0.0.0.255 area 578</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R6上启用OSPF协议</span></span><br><span class="line">R6(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R6(config-router)<span class="comment">#network 6.6.6.0 0.0.0.255 area 0</span></span><br><span class="line">R6(config-router)<span class="comment">#network 16.16.16.0 0.0.0.255 area 0</span></span><br><span class="line">R6(config-router)<span class="comment">#network 56.56.56.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R7上启用OSPF协议</span></span><br><span class="line">R7(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R7(config-router)<span class="comment">#network 57.57.57.0 0.0.0.255 area 578</span></span><br><span class="line">R7(config-router)<span class="comment">#network 10.7.0.0 0.0.255.255 area 578</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R8上启用OSPF协议（注意：此处R8的e0/0端口IP地址为57.57.57.8）</span></span><br><span class="line">R8(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R8(config-router)<span class="comment">#network 57.57.57.0 0.0.0.255 area 578</span></span><br><span class="line">R8(config-router)<span class="comment">#network 10.8.0.0 0.0.255.255 area 578</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R9上启用EIGRP协议</span></span><br><span class="line">R9(config)<span class="comment">#router eigrp 110 </span></span><br><span class="line">R9(config-router)<span class="comment">#network 29.0.0.0</span></span><br><span class="line">R9(config-router)<span class="comment">#network 172.16.0.0</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>采用合适的命令观察 OSPF 的邻居表、拓扑表和路由表，仔细观察路由表的各路由类型，并测试图示标注loopback 接口网段间的连通性；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看OSPF邻居表（此处以R1为例）</span></span><br><span class="line">R1<span class="comment">#show ip ospf neighbor </span></span><br><span class="line"></span><br><span class="line">Neighbor ID     Pri   State           Dead Time   Address         Interface</span><br><span class="line">6.6.6.6           1   FULL/BDR        00:00:36    16.16.16.6      Ethernet0/0</span><br><span class="line">2.2.2.2           1   FULL/BDR        00:00:39    12.12.12.2      Ethernet0/1</span><br><span class="line"><span class="comment">#查看OSPF拓扑表（此处以R1为例）</span></span><br><span class="line">R1<span class="comment">#show ip ospf database  </span></span><br><span class="line"></span><br><span class="line">            OSPF Router with ID (1.1.1.1) (Process ID 1)</span><br><span class="line"></span><br><span class="line">                Router Link States (Area 0)</span><br><span class="line"></span><br><span class="line">Link ID         ADV Router      Age         Seq<span class="comment">#       Checksum Link count</span></span><br><span class="line">1.1.1.1         1.1.1.1         793         0x8000000C 0x00AE8B 3</span><br><span class="line">2.2.2.2         2.2.2.2         1739        0x8000000B 0x007C85 3</span><br><span class="line">3.3.3.3         3.3.3.3         1514        0x80000009 0x005309 2</span><br><span class="line">5.5.5.5         5.5.5.5         807         0x80000007 0x00ADF1 1</span><br><span class="line">6.6.6.6         6.6.6.6         780         0x80000009 0x005D8E 3</span><br><span class="line"></span><br><span class="line">                Net Link States (Area 0)</span><br><span class="line"></span><br><span class="line">Link ID         ADV Router      Age         Seq<span class="comment">#       Checksum</span></span><br><span class="line">12.12.12.1      1.1.1.1         793         0x80000007 0x0040BE</span><br><span class="line">16.16.16.1      1.1.1.1         1055        0x80000006 0x007A69</span><br><span class="line">23.23.23.2      2.2.2.2         1739        0x80000006 0x00E0F0</span><br><span class="line">56.56.56.5      5.5.5.5         807         0x80000006 0x00BC8A</span><br><span class="line"></span><br><span class="line">                Summary Net Link States (Area 0)</span><br><span class="line"></span><br><span class="line">Link ID         ADV Router      Age         Seq<span class="comment">#       Checksum</span></span><br><span class="line">10.7.1.1        5.5.5.5         806         0x80000006 0x006B9A</span><br><span class="line">10.7.2.1        5.5.5.5         806         0x80000006 0x0060A4</span><br><span class="line">10.7.3.1        5.5.5.5         806         0x80000006 0x0055AE</span><br><span class="line">10.7.4.1        5.5.5.5         806         0x80000006 0x004AB8</span><br><span class="line">10.8.1.1        5.5.5.5         563         0x80000006 0x005FA5</span><br><span class="line">10.8.2.1        5.5.5.5         563         0x80000006 0x0054AF</span><br><span class="line">10.8.3.1        5.5.5.5         563         0x80000006 0x0049B9</span><br><span class="line">10.8.4.1        5.5.5.5         563         0x80000006 0x003EC3</span><br><span class="line">34.34.34.0      3.3.3.3         1514        0x80000006 0x00DAAA</span><br><span class="line">34.34.34.0      5.5.5.5         1068        0x80000007 0x000171</span><br><span class="line">45.45.45.0      3.3.3.3         1252        0x80000006 0x00B1A8</span><br><span class="line">45.45.45.0      5.5.5.5         1068        0x80000007 0x00F0A0</span><br><span class="line">57.57.57.0      5.5.5.5         1068        0x80000006 0x00412D</span><br><span class="line">192.168.1.1     3.3.3.3         1252        0x80000006 0x00EA94</span><br><span class="line">192.168.1.1     5.5.5.5         1068        0x80000007 0x008E1E</span><br><span class="line">192.168.2.1     3.3.3.3         1252        0x80000006 0x00DF9E</span><br><span class="line">192.168.2.1     5.5.5.5         1068        0x80000007 0x008328</span><br><span class="line">192.168.3.1     3.3.3.3         1252        0x80000006 0x00D4A8</span><br><span class="line">192.168.3.1     5.5.5.5         1068        0x80000007 0x007832</span><br><span class="line">192.168.4.1     3.3.3.3         1252        0x80000006 0x00C9B2</span><br><span class="line">192.168.4.1     5.5.5.5         1068        0x80000007 0x006D3C</span><br><span class="line"></span><br><span class="line">                Type-5 AS External Link States</span><br><span class="line">          </span><br><span class="line">Link ID         ADV Router      Age         Seq<span class="comment">#       Checksum Tag</span></span><br><span class="line">29.29.29.0      2.2.2.2         221         0x80000007 0x0087B3 0</span><br><span class="line">172.16.1.0      2.2.2.2         221         0x80000006 0x0011C4 0</span><br><span class="line">172.16.2.0      2.2.2.2         221         0x80000006 0x0006CE 0</span><br><span class="line">172.16.3.0      2.2.2.2         221         0x80000006 0x00FAD8 0</span><br><span class="line">172.16.4.0      2.2.2.2         221         0x80000006 0x00EFE2 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看OSPF路由表（此处以R1为例）</span></span><br><span class="line">R1<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      1.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">C        1.1.1.1 is directly connected, Loopback0</span><br><span class="line">      2.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        2.2.2.2 [110/11] via 12.12.12.2, 03:33:05, Ethernet0/1</span><br><span class="line">      3.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        3.3.3.3 [110/21] via 12.12.12.2, 03:13:48, Ethernet0/1</span><br><span class="line">      6.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        6.6.6.6 [110/11] via 16.16.16.6, 03:03:08, Ethernet0/0</span><br><span class="line">      10.0.0.0/32 is subnetted, 8 subnets</span><br><span class="line">O IA     10.7.1.1 [110/31] via 16.16.16.6, 03:00:18, Ethernet0/0</span><br><span class="line">O IA     10.7.2.1 [110/31] via 16.16.16.6, 03:00:18, Ethernet0/0</span><br><span class="line">O IA     10.7.3.1 [110/31] via 16.16.16.6, 03:00:18, Ethernet0/0</span><br><span class="line">O IA     10.7.4.1 [110/31] via 16.16.16.6, 03:00:18, Ethernet0/0</span><br><span class="line">O IA     10.8.1.1 [110/31] via 16.16.16.6, 02:58:10, Ethernet0/0</span><br><span class="line">O IA     10.8.2.1 [110/31] via 16.16.16.6, 02:58:10, Ethernet0/0</span><br><span class="line">O IA     10.8.3.1 [110/31] via 16.16.16.6, 02:58:10, Ethernet0/0</span><br><span class="line">O IA     10.8.4.1 [110/31] via 16.16.16.6, 02:58:10, Ethernet0/0</span><br><span class="line">      12.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        12.12.12.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        12.12.12.1/32 is directly connected, Ethernet0/1</span><br><span class="line">      16.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        16.16.16.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        16.16.16.1/32 is directly connected, Ethernet0/0</span><br><span class="line">      23.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O        23.23.23.0 [110/20] via 12.12.12.2, 03:32:46, Ethernet0/1</span><br><span class="line">      29.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O E2     29.29.29.0 [110/20] via 12.12.12.2, 03:28:26, Ethernet0/1</span><br><span class="line">      34.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O IA     34.34.34.0 [110/84] via 12.12.12.2, 03:12:45, Ethernet0/1</span><br><span class="line">      45.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O IA     45.45.45.0 [110/30] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      56.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O        56.56.56.0 [110/20] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      57.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O IA     57.57.57.0 [110/30] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      172.16.0.0/24 is subnetted, 4 subnets</span><br><span class="line">O E2     172.16.1.0 [110/20] via 12.12.12.2, 02:54:51, Ethernet0/1</span><br><span class="line">O E2     172.16.2.0 [110/20] via 12.12.12.2, 02:54:51, Ethernet0/1</span><br><span class="line">O E2     172.16.3.0 [110/20] via 12.12.12.2, 02:54:51, Ethernet0/1</span><br><span class="line">O E2     172.16.4.0 [110/20] via 12.12.12.2, 02:54:51, Ethernet0/1</span><br><span class="line">      192.168.1.0/32 is subnetted, 1 subnets</span><br><span class="line">O IA     192.168.1.1 [110/31] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      192.168.2.0/32 is subnetted, 1 subnets</span><br><span class="line">O IA     192.168.2.1 [110/31] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      192.168.3.0/32 is subnetted, 1 subnets</span><br><span class="line">O IA     192.168.3.1 [110/31] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br><span class="line">      192.168.4.0/32 is subnetted, 1 subnets</span><br><span class="line">O IA     192.168.4.1 [110/31] via 16.16.16.6, 03:02:58, Ethernet0/0</span><br></pre></td></tr></table></figure>

<p>R9中的loopback接口与R7中的loopback接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/we5fVP.png"></p>
<p>R9中的loopback接口与R8中的loopback接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/we5hUf.png"></p>
<p>R9中的loopback接口与R4中的loopback接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/we5v5T.png"></p>
<p>R4中的loopback接口与R7中的loopback接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/weISGF.png"></p>
<p>R4中的loopback接口与R8中的loopback接口：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/weI9xJ.png"></p>
<p>R7中的loopback接口与R8中的loopback接口：      </p>
<p><img src="https://s1.ax1x.com/2020/09/06/wev4IJ.png"></p>
<ol start="4">
<li>要求骨干区域能够快速收敛，并让R5 成为区域 578 中的 DR；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在骨干区域的路由器中配置点对点的OSPF，以实现骨干区域的快速收敛</span></span><br><span class="line">R1(config-if)<span class="comment">#int e0/1                       </span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line">R1(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/1</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line">R2(config-if)<span class="comment">#int e0/2</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf network point-to-point</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#int e0/2</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#int e0/0</span></span><br><span class="line">R6(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line">R6(config-if)<span class="comment">#int e0/1</span></span><br><span class="line">R6(config-if)<span class="comment">#ip ospf network point-to-point </span></span><br><span class="line"></span><br><span class="line">更改R5的优先级，让R5成为578区域的DR（OSPF的优先级默认为1，数值越大，优先级越高。当优先级为0时，路由器不参与选举）</span><br><span class="line">R5(config)<span class="comment">#int e0/1</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf priority 10</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/06/wev7xx.png"></p>
<ol start="5">
<li>采用合适的方案确保当骨干网络的任意链路中断的时候不会影响骨干网的连通性；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R3与R5中配置虚链路</span></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#area 345 virtual-link 5.5.5.5</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R5(config-router)<span class="comment">#area 345 virtual-link 3.3.3.3</span></span><br></pre></td></tr></table></figure>

<p>将R1的e0/0端口关闭，验证其连通性：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wevXZD.png"></p>
<ol start="6">
<li>观察各路由器上的路由表信息，然后在合适的路由器上进行必要的路由汇总，对比汇总之后各路由器路由表的变化，并观察和测试明细路由与汇总路由之间的关系；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在各边界路由器上汇总路由</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#summary-address 172.16.0.0 255.255.0.0 </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#area 345 range 192.168.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R5(config-router)<span class="comment">#area 345 range 192.168.0.0 255.255.0.0</span></span><br><span class="line">R5(config-router)<span class="comment">#area 578 range 10.0.0.0 255.0.0.0</span></span><br></pre></td></tr></table></figure>

<p>R1的路由表：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wevzid.png"></p>
<ol start="7">
<li>采用合适的方案，实现图示标注的 loopback 网段可以访问 ISP 上的主机100.100.100.100；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R1和R6上配置NAT转换</span></span><br><span class="line">R1(config)<span class="comment">#access-list 1 permit 192.168.0.0 0.0.255.255</span></span><br><span class="line">R1(config)<span class="comment">#access-list 2 permit 172.16.0.0 0.0.255.255</span></span><br><span class="line">R1(config)<span class="comment">#access-list 3 permit 10.0.0.0 0.255.255.255</span></span><br><span class="line"></span><br><span class="line">R1(config)<span class="comment">#int s1/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#int range e0/0-1</span></span><br><span class="line">R1(config-if-range)<span class="comment">#ip nat inside </span></span><br><span class="line">R1(config-if-range)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#ip nat inside source list 1 interface serial 1/0 overload </span></span><br><span class="line">R1(config)<span class="comment">#ip nat inside source list 2 interface serial 1/0 overload </span></span><br><span class="line">R1(config)<span class="comment">#ip nat inside source list 3 interface serial 1/0 overload </span></span><br><span class="line"></span><br><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R1(config-router)<span class="comment">#default-information originate</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#access-list 1 permit 192.168.0.0 0.0.255.255</span></span><br><span class="line">R6(config)<span class="comment">#access-list 2 permit 172.16.0.0 0.0.255.255</span></span><br><span class="line">R6(config)<span class="comment">#access-list 3 permit 10.0.0.0 0.255.255.255</span></span><br><span class="line">R6(config)<span class="comment">#int s1/0</span></span><br><span class="line">R6(config-if)<span class="comment">#ip nat outside</span></span><br><span class="line">R6(config-if)<span class="comment">#exit</span></span><br><span class="line">R6(config-if)<span class="comment">#int range e0/0-1</span></span><br><span class="line">R6(config-if-range)<span class="comment">#ip nat inside </span></span><br><span class="line">R6(config-if-range)<span class="comment">#exit</span></span><br><span class="line">R6(config)<span class="comment">#ip nat inside source list 1 interface serial 1/0 overload</span></span><br><span class="line">R6(config)<span class="comment">#ip nat inside source list 2 interface serial 1/0 overload</span></span><br><span class="line">R6(config)<span class="comment">#ip nat inside source list 3 interface serial 1/0 overload</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;验证其连通性：</p>
<p>&emsp;&emsp;&emsp;&emsp;（注：200.200.200.2为ISP1中s1/0的IP地址，50.50.50.2为ISP2中s1/0的IP地址）</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexEdg.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexuzq.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexYFJ.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexQyV.png"></p>
<ol start="8">
<li>要求各链路正常情况下，内网优选 ISP1 的链路对外部网络进行访问，当与 ISP1 的链路出现故障的时候，自动切换到 ISP2 的链路对外部网络进行访问，使用tracert 观察验证该现象。</li>
</ol>
<p>&emsp;&emsp;为使内网优先选择ISP1对外部网络进行访问，故更改链路的cost值，使内网从ISP1访问外网的cost比从ISP2访问外网的cost小，以R8为例，更改链路①的cost值，使得链路①的总cost值比链路②的总cost值小。</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexNWR.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在各路由器的端口下配置ospf的开销</span></span><br><span class="line">R5(config)<span class="comment">#int e0/0</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf cost 1</span></span><br><span class="line">R4(config)<span class="comment">#int s1/0</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf cost 1</span></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf cost  1</span></span><br><span class="line">R2(config)<span class="comment">#int e0/2 </span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf cost 1</span></span><br></pre></td></tr></table></figure>

<p>验证结果如下：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wexwy6.png"></p>
<p>当ISP1出现故障时（关闭R1中的S1/0端口）：</p>
<p><img src="https://s1.ax1x.com/2020/09/06/wex0OK.png"></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>CCNP</tag>
        <tag>路由</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP路由综合实验三</title>
    <url>/2019/04/12/CCNP%E8%B7%AF%E7%94%B1%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%B8%89/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 IS-IS 的基本配置； IS-IS 路由器等级； IS-IS 的路由汇总； IS-IS 的基本查看和验证； IS-IS 的报文类型及报文的作用。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>熟悉 IS-IS 的基本配置</p>
</li>
<li><p>理解 IS-IS 路由器等级</p>
</li>
<li><p>理解 IS-IS 的路由汇总</p>
</li>
<li><p>掌握 IS-IS 的基本查看和验证</p>
</li>
<li><p>理解 IS-IS 的报文类型及报文的作用</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p>​     <img src="https://s1.ax1x.com/2020/09/11/wtxetH.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考拓扑，完成各路由器的基本配置，除图示地址标识外，设备间的地址自己规划</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/11/wNSuOP.png"></p>
<p>&emsp;&emsp;各路由器的基本配置以安装上图所示的地址标识配置完成，此处不再列出具体的配置代码。另外，各，在该拓扑中，各PC机均使用路由器上的Lookback端口模拟，如R1上的11.1.1.1/24、11.1.2.1/24……。以R1、R2的端口配置情况为例。</p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNp7UU.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNpTET.png"></p>
<ol start="2">
<li>全网启用集成 IS-IS，区域划分参考图示，IS-IS 路由器的 System id 指定为各设备第一个以太网接口的 MAC 地址，实现全网的连通性</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#全网启用IS-IS协议</span></span><br><span class="line">R1(config)<span class="comment">#router isis</span></span><br><span class="line">R1(config-router)<span class="comment">#net 49.0123.aabb.cc00.1000.00</span></span><br><span class="line">R1(config-router)<span class="comment">#exit </span></span><br><span class="line">R1(config)<span class="comment">#int range loopback 1-8 </span></span><br><span class="line">R1(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R1(config-if-range)<span class="comment">#exit </span></span><br><span class="line">R1(config)<span class="comment">#int s1/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip router isis  </span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#int s1/1       </span></span><br><span class="line">R1(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router isis</span></span><br><span class="line">R2(config-router)<span class="comment">#net 49.0123.aabb.cc00.2000.00</span></span><br><span class="line">R2(config-router)<span class="comment">#exit </span></span><br><span class="line">R2(config)<span class="comment">#int range loopback 1-2</span></span><br><span class="line">R2(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R2(config-if-range)<span class="comment">#exit </span></span><br><span class="line">R2(config)<span class="comment">#int s1/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R2(config-if)<span class="comment">#exit</span></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R2(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router isis</span></span><br><span class="line">R3(config-router)<span class="comment">#net 49.0123.aabb.cc00.3000.00</span></span><br><span class="line">R3(config-router)<span class="comment">#exit </span></span><br><span class="line">R3(config)<span class="comment">#int range loopback 1-2</span></span><br><span class="line">R3(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R3(config-if-range)<span class="comment">#exit </span></span><br><span class="line">R3(config)<span class="comment">#int s1/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R3(config-if)<span class="comment">#exit</span></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R3(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router isis </span></span><br><span class="line">R4(config-router)<span class="comment">#net 49.0456.aabb.cc00.4000.00</span></span><br><span class="line">R4(config-router)<span class="comment">#exit </span></span><br><span class="line">R4(config)<span class="comment">#int range e0/0-1,lo1-2</span></span><br><span class="line">R4(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R4(config-if-range)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R5(config-router)<span class="comment">#router isis                                     </span></span><br><span class="line">R5(config-router)<span class="comment">#net 49.0456.aabb.cc00.5000.00</span></span><br><span class="line">R5(config-router)<span class="comment">#exit </span></span><br><span class="line">R5(config)<span class="comment">#int range e0/0-1,lo1-2</span></span><br><span class="line">R5(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R5(config-if-range)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router isis</span></span><br><span class="line">R6(config-router)<span class="comment">#net 49.0456.aabb.cc00.9000.00</span></span><br><span class="line">R6(config-router)<span class="comment">#exit </span></span><br><span class="line">R6(config)<span class="comment">#int range e0/1,lo1-2</span></span><br><span class="line">R6(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R6(config-if-range)<span class="comment">#exit</span></span><br><span class="line">R6(config)<span class="comment">#int s1/0</span></span><br><span class="line">R6(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R6(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R7(config)<span class="comment">#router isis</span></span><br><span class="line">R7(config-router)<span class="comment">#net 49.0007.aabb.cc00.7000.00</span></span><br><span class="line">R7(config-router)<span class="comment">#exit </span></span><br><span class="line">R7(config)<span class="comment">#int range lo1-2</span></span><br><span class="line">R7(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R7(config-if-range)<span class="comment">#exit</span></span><br><span class="line">R7(config)<span class="comment">#int s1/0</span></span><br><span class="line">R7(config-if)<span class="comment">#ip router isis</span></span><br><span class="line">R7(config-if)<span class="comment">#exit</span></span><br><span class="line"></span><br><span class="line">R8(config)<span class="comment">#router isis</span></span><br><span class="line">R8(config-router)<span class="comment">#net 49.0008.aabb.cc00.8000.00</span></span><br><span class="line">R8(config-router)<span class="comment">#exit</span></span><br><span class="line">R8(config)<span class="comment">#int range e0/0,lo1-2</span></span><br><span class="line">R8(config-if-range)<span class="comment">#ip router isis</span></span><br><span class="line">R8(config-if-range)<span class="comment">#exit </span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/11/wNjB11.png"></p>
<ol start="3">
<li>查看 IS-IS 的邻居表、拓扑表、数据库和路由表，根据拓扑，修改合适的路由器类型，对比修改完路由器类型之后 IS-IS 各数据库的变化</li>
</ol>
<p>&emsp;&emsp;由于在拓扑中，只有R1的端口在同一区域中，故在此以R1为例。</p>
<p>&emsp;&emsp;R1的邻居表：</p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNj2Ae.png"></p>
<p>&emsp;&emsp;R1的拓扑表： </p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNjqAg.png"></p>
<p>&emsp;&emsp;R1的数据库： </p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvejx.png"></p>
<p>&emsp;&emsp;R1的路由表： </p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNv8Cd.png"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">#将R1的路由器类型改为level-<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config)</span></span><span class="selector-id">#router</span> isis</span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-router)</span></span><span class="selector-id">#is-type</span> level-<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;修改之后R1的数据库：</p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvNKP.png"></p>
<ol start="4">
<li>实现 R1 优选 R2 对外部网络进行访问</li>
</ol>
<p>&emsp;&emsp;通过R1的路由表和路由跟踪可以发现R1对外部路由的访问是通过指向R2和R3的默认路由实现的，且两条路由的开销相等，负载均衡。我们可以通过更改开销来实现 R1 优选 R2 对外部网络进行访问。</p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvwVS.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvgK0.png"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">#通过配置使R1与R2之间的开销变小，从而使R1优选 R2 对外部网络进行访问</span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-if)</span></span><span class="selector-id">#int</span> s1/<span class="number">0</span>     </span><br><span class="line"><span class="function"><span class="title">R1</span><span class="params">(config-if)</span></span><span class="selector-id">#isis</span> metric <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/11/wNvqr6.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvjaD.png"></p>
<ol start="5">
<li>对 R1 上 loopback 接口网段进行合适的路由汇总</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R2、R3上进行汇总：</span></span><br><span class="line">R2(config)<span class="comment">#router isis</span></span><br><span class="line">R2(config-router)<span class="comment">#summary-address 11.0.0.0 255.0.0.0 level-2</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router isis</span></span><br><span class="line">R3(config-router)<span class="comment">#summary-address 11.0.0.0 255.0.0.0 level-2</span></span><br></pre></td></tr></table></figure>

<p>R8的路由表：</p>
<p><img src="https://s1.ax1x.com/2020/09/11/wNvzPH.png"></p>
<ol start="6">
<li>实现 R5 为多路访问网络的 DIS</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#更改R5的优先级</span></span><br><span class="line">R5(config)<span class="comment">#int e0/1</span></span><br><span class="line">R5(config-if)<span class="comment">#isis priority 100</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/11/wNx9xI.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#验证和查看 IS-IS 的相关信息的命令</span></span><br><span class="line">Router<span class="comment">#show ip protocols</span></span><br><span class="line">Router<span class="comment">#show clns protocols</span></span><br><span class="line">Router<span class="comment">#show ip route</span></span><br><span class="line">Router<span class="comment">#show clns neighbor</span></span><br><span class="line">Router<span class="comment">#show clns interface</span></span><br><span class="line">Router<span class="comment">#show isis</span></span><br><span class="line">Router<span class="comment">#show clns route</span></span><br><span class="line">Router<span class="comment">#show isis topology</span></span><br><span class="line">Router<span class="comment">#show isis database</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>路由</tag>
        <tag>IS-IS</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP路由综合实验二</title>
    <url>/2019/04/05/CCNP%E8%B7%AF%E7%94%B1%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%BA%8C/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍 OSPF stub 区域的特点和配置； OSPF totally stub 区域的特点和配置； OSPF NSSA 区域的特点和配置； OSPF totally NSSA 区域的特点和配置；被动接口的作用掌握 OSPF LSA7 的作用； OSPF 邻居间的验证。</p>
<a id="more"></a>

<p>【实验目的】</p>
<ol>
<li><p>理解和掌握 OSPF stub 区域的特点和配置</p>
</li>
<li><p>理解和掌握 OSPF totally stub 区域的特点和配置</p>
</li>
<li><p>理解和掌握 OSPF NSSA 区域的特点和配置</p>
</li>
<li><p>理解和掌握 OSPF totally NSSA 区域的特点和配置</p>
</li>
<li><p>掌握被动接口的作用</p>
</li>
<li><p>掌握 OSPF LSA7 的作用</p>
</li>
<li><p>掌握 OSPF 邻居间的验证</p>
</li>
</ol>
<p>【实验拓扑】</p>
<p>   <img src="https://s1.ax1x.com/2020/09/08/wQ9aSU.png"></p>
<p>【实验需求】</p>
<ol>
<li>参考拓扑，完成各路由器的基本配置，除图示地址标识外，设备间的地址自己规划。</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/08/wQ9NWT.png"></p>
<p>&emsp;&emsp;各路由器的基本配置以安装上图所示的地址标识配置完成，此处不再列出具体的配置代码。另外，各，在该拓扑中，各PC机均使用路由器上的Lookback端口模拟，如R1上的11.1.1.1/24、11.1.2.1/24……。以R1、R2的端口配置情况为例。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYKHVH.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYKTqe.png"></p>
<ol start="2">
<li>完成各路由协议的基本配置，在 R2 上进行 OSPF 与 RIPv2 的双向重分布，在 R6 上进行 EIGRP 与 OSPF 的双向重分布，然后完成必要的配置， 实现全网可达，并且在 OSPF 区域内的各个路由器上手工指定各路由器的 RID 为各路由器的编号。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在各路由器上完成动态路由的配置（此处以R1为例），在端口上进行ospf的通告</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.1.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment"># exit     </span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback2</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.2.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback3</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.3.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback4</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.4.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback5</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.5.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback6</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.6.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback7</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.7.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line">R1(config-if)<span class="comment">#exit</span></span><br><span class="line">R1(config)<span class="comment">#interface Loopback8</span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 11.1.8.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R2上启用OSPF协议（略）与RIP协议</span></span><br><span class="line">R2(config)<span class="comment">#router rip </span></span><br><span class="line">R2(config-router)<span class="comment">#version 2</span></span><br><span class="line">R2(config-router)<span class="comment">#network 29.0.0.0</span></span><br><span class="line">R2(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"><span class="comment">#R2双向重分布</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute rip metric 2 subnets</span></span><br><span class="line">R2(config)<span class="comment">#router rip </span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute ospf 1 metric 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R6上启用OSPF协议（略）与EIGRP协议</span></span><br><span class="line">R6(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R6(config-router)<span class="comment">#network 61.0.0.0</span></span><br><span class="line"><span class="comment">#R6双向重分布</span></span><br><span class="line">R6(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R6(config-router)<span class="comment">#redistribute ospf 1 metric 1 1 1 1 1 </span></span><br><span class="line">R6(config-router)<span class="comment">#router ospf 1 </span></span><br><span class="line">R6(config-router)<span class="comment">#redistribute eigrp 90 subnets </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#由于非骨干之间的通信需要经过骨干区域，所以需要在将area 78与骨干区域连接在一起（可以通过配置“虚链路”或“隧道”），此处采用隧道的方法</span></span><br><span class="line">R7(config)<span class="comment">#int tunnel 1</span></span><br><span class="line">R7(config-if)<span class="comment">#tunnel source 47.47.47.7</span></span><br><span class="line">R7(config-if)<span class="comment">#tunnel destination 47.47.47.4</span></span><br><span class="line">R7(config-if)<span class="comment">#ip address 7.7.7.7 255.255.255.255</span></span><br><span class="line">R7(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line">R7(config-if)<span class="comment">#exit </span></span><br><span class="line">R7(config)<span class="comment">#int tunnel 2</span></span><br><span class="line">R7(config-if)<span class="comment">#tunnel source 47.47.47.7 </span></span><br><span class="line">R7(config-if)<span class="comment">#tunnel destination 56.56.56.5</span></span><br><span class="line">R7(config-if)<span class="comment">#ip address 5.5.5.7 255.255.255.255</span></span><br><span class="line">R7(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#int tunnel 1</span></span><br><span class="line">R4(config-if)<span class="comment">#tunnel source 47.47.47.4 </span></span><br><span class="line">R4(config-if)<span class="comment">#tunnel destination 47.47.47.7</span></span><br><span class="line">R4(config-if)<span class="comment">#ip address 7.7.7.8 255.255.255.255</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#int tunnel 2 </span></span><br><span class="line">R5(config-if)<span class="comment">#tunnel source 56.56.56.5</span></span><br><span class="line">R5(config-if)<span class="comment">#tunnel destination 47.47.47.7</span></span><br><span class="line">R5(config-if)<span class="comment">#ip address 5.5.5.5 255.255.255.255</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/10/wYMCZQ.png"></p>
<ol start="3">
<li>在 R1 上，采用合适的方式将相应的接口设置为 passive-interface。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line"><span class="comment">#将R1上所有的端口设置成passive-interface</span></span><br><span class="line">R1(config-router)<span class="comment">#passive-interface default </span></span><br><span class="line"><span class="comment">#取消Serial1/0、Serial 1/1的passive-interface</span></span><br><span class="line">R1(config-router)<span class="comment">#no passive-interface serial 1/0</span></span><br><span class="line">R1(config-router)<span class="comment">#no passive-interface serial 1/1</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 R1 与 R2 的链路之间使用链路明文认证，密码为“huangzc”，并使用 wireshark 抓包观察认证信息。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config-if)<span class="comment">#int s1/1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf authentication</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br><span class="line">R2(config)<span class="comment">#int s1/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf authentication</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;由于使用eve模拟无法使用Wireshark抓包观察串行端口，所以暂时无法实现。</p>
<ol start="5">
<li>在 R1 与 R3 的链路之间使用链路 MD5 认证，密码为“huangzc”，并使用 wireshark 抓包观察认证信息。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config)<span class="comment">#int s1/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf authentication message-digest </span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int s1/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf authentication message-digest </span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;由于使用eve模拟无法使用Wireshark抓包观察串行端口，所以暂时无法实现。</p>
<ol start="6">
<li>在 area 4567 上使用区域间的 MD5 认证，密码自定。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在ospf进程中启用area 4567的区域间认证</span></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 4567 authentication message-digest </span></span><br><span class="line">R4(config-router)<span class="comment">#exit   </span></span><br><span class="line"><span class="comment">#在端口上配置区域间的密码</span></span><br><span class="line">R4(config)<span class="comment">#int e0/1</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R5(config-router)<span class="comment">#area 4567 authentication message-digest </span></span><br><span class="line">R5(config-router)<span class="comment">#exit </span></span><br><span class="line">R5(config)<span class="comment">#int e0/1</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R6(config-router)<span class="comment">#area 4567 authentication message-digest </span></span><br><span class="line">R6(config-router)<span class="comment">#exit</span></span><br><span class="line">R6(config)<span class="comment">#int e0/0</span></span><br><span class="line">R6(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line">R6(config-if)<span class="comment">#int e0/1                                                     </span></span><br><span class="line">R6(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line"></span><br><span class="line">R7(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R7(config-router)<span class="comment">#area 4567 authentication message-digest </span></span><br><span class="line">R7(config-router)<span class="comment">#exit</span></span><br><span class="line">R7(config)<span class="comment">#int e0/1</span></span><br><span class="line">R7(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br><span class="line">R7(config-if)<span class="comment">#int e0/0</span></span><br><span class="line">R7(config-if)<span class="comment">#ip ospf message-digest-key 1 md5 huangzc</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>在骨干区域上采用区域间的明文认证，密码自定。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config-router)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf authentication </span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#int e0/0</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf authentication</span></span><br><span class="line">R5(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf authentication</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#int e0/0</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf authentication</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf authentication-key huangzc</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>仔细观察各区域路由器的路由表，观察各 OSPF 路由器 LSDB 数据库的信息，重点观察各 OSPF 路由器存在哪些类型的 LSA 信息。</li>
</ol>
<p>&emsp;&emsp;此处以R1、R2路由器上的LSDB数据库信息为例，观察路由器上存在LSA类型信息。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMeMT.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMYQK.png"><img src="https://s1.ax1x.com/2020/09/10/wYMGz6.png"></p>
<ol start="9">
<li>将 area 123 设置为 stub 区域，然后观察 R1 上的 OSPF 数据库和 R1 路由条目的变化，并测试 R1 与其他区域的连通性。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#将area 123设置为stub区域</span></span><br><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R1(config-router)<span class="comment">#area 123 stub </span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#area 123 stub </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#area 123 stub </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;从R1的OSPF数据库中可以看出，将area 123设置为stub区域后，LSA 4类和LSA 5类的路由被过滤掉了，并下发三类的默认路由。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMDJI.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMcy8.png"></p>
<p>&emsp;&emsp;R1与其他区域的联通性良好，如下图所示。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMfoj.png"></p>
<ol start="10">
<li>将 area 123 设置为 totally stub 区域，再次观察 R1 上的 OSPF 数据库和路由条目的变化，并测试 R1 与其他区域的连通性。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在9的基础上进行totally stub的配置 只需在ABR上进行配置</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#are 123 stub no-summary </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#are 123 stub no-summary </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;观察R1上的OSPF数据库和路由条目的变化可得知，将area 123设置为totally stub区域后，LSA 3类、LSA 4类、LSA 5类的路由均被过滤，并下发LSA 3类的默认路由。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMHyT.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYMbOU.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYQ9l6.png"></p>
<ol start="10">
<li>将 area 4567 设置为 NSSA 区域，再次观察各路由条目的变化，完成必要的配置，实现全网可达。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在进程下将area 4567设置为nssa区域（由于area 4567存在ASBR（R6），所以只能设置为nssa区域）</span></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 4567 nssa  </span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1  </span></span><br><span class="line">R5(config-router)<span class="comment">#area 4567 nssa</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router ospf 1  </span></span><br><span class="line">R6(config-router)<span class="comment">#area 4567 nssa</span></span><br><span class="line"></span><br><span class="line">R7(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R7(config-router)<span class="comment">#area 4567 nssa</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;通过观察R5的路由表可以发现，将area 4567设置为nssa区域后，LSA 4类、LSA 5类的路由均被过滤，且不会下发LSA 3类的默认路由。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYKGDg.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在ABR手动向内部下发默认路由</span></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 4567 nssa default-information-originate </span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1 </span></span><br><span class="line">R5(config-router)<span class="comment">#area 4567 nssa default-information-originate</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/10/wYQVkd.png"></p>
<ol start="11">
<li>将 area 4567 设置为 Totally NSSA 区域，再次观察各路由条目的变化， 完成必要的配置，实现全网可达。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 4567 nssa no-summary </span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R5(config-router)<span class="comment">#area 4567 nssa no-summary</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router ospf 1  </span></span><br><span class="line">R6(config-router)<span class="comment">#area 4567 nssa no-summary</span></span><br><span class="line"></span><br><span class="line">R7(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R7(config-router)<span class="comment">#area 4567 nssa no-summary</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;观察R6上路由表的变化可以发现，将area 123设置为totally nssa区域后，LSA 3类、LSA 4类、LSA 5类的路由均被过滤，并下发LSA 3类的默认路由。</p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYQu1P.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/10/wYQnpt.png"></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>CCNP</tag>
        <tag>路由</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP路由综合实验五——BGP</title>
    <url>/2019/04/26/CCNP%E8%B7%AF%E7%94%B1%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E4%BA%94/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇本章主要介绍了建立 IBGP 邻居的配置；建立 EBGP 邻居的配置；BGP的选路的配置；BGP邻居的安全建立。</p>
<a id="more"></a>

<p>【拓扑结构】</p>
<p><img src="https://s1.ax1x.com/2020/10/16/0qSzf1.png" alt="image-20201016220418903"></p>
<center>BGP综合实验拓扑</center>

<p>【实验需求】</p>
<ol>
<li>大型企业需要承担起因特网互连任务，其AS号为2。内网使用OSPF协议来保证内部通信</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在大型企业内部启用OSPF协议，并通告内部网段</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255 area 0</span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.24.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.23.0 0.0.0.255 area 0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.34.0 0.0.0.255 area 0</span></span><br><span class="line">R3(config-router)<span class="comment">#network 192.168.35.0 0.0.0.255 area 0</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#network 192.168.24.0 0.0.0.255 area 0</span></span><br><span class="line">R4(config-router)<span class="comment">#network 192.168.34.0 0.0.0.255 area 0</span></span><br><span class="line">R4(config-router)<span class="comment">#network 192.168.45.0 0.0.0.255 area 0</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>大型企业和ISP1及ISP2之间运行EBGP协议，在R1以及R6各起个回环口模拟ISP1及ISP2上的服务器</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#建立大型企业与ISP1之间的EBGP邻居关系</span></span><br><span class="line">R1(config)<span class="comment">#router bgp 1</span></span><br><span class="line">R1(config-router)<span class="comment">#neighbor 202.101.12.2 remote-as 2</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 202.101.12.1 remote-as 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#建立大型企业与ISP2之间的EBGP邻居关系</span></span><br><span class="line">R3(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 202.101.35.5 remote-as 3</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 202.101.45.5 remote-as 3</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#router bgp 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 202.101.45.4 remote-as 2</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 202.101.35.3 remote-as 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R1以及R6各起个回环口模拟ISP1及ISP2上的服务器</span></span><br><span class="line">R1(config)<span class="comment">#int loopback 1 </span></span><br><span class="line">R1(config-if)<span class="comment">#ip address 1.1.1.1 255.255.255.0</span></span><br><span class="line">R1(config-if)<span class="comment">#no shutdown </span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#int loopback 1 </span></span><br><span class="line">R6(config-if)<span class="comment"># ip address 6.6.6.6 255.255.255.0</span></span><br><span class="line">R6(config-if)<span class="comment">#no shutdown  </span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>IP地址自行规划，内部使用私有地址，连着ISP的接口使用公有地址</li>
</ol>
<p>&emsp;&emsp;该拓扑中各设备的IP地址如拓扑图所示，此处不再做过多的赘述。</p>
<ol start="4">
<li>大型企业内部运行全互联的IBGP，要求避免物理接口故障引起的 BGP 邻居关系DOWN</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#由于需要避免物理接口故障引起的 BGP 邻居关系DOWN，所以我们建立基于回环端口的BGP邻居关系</span></span><br><span class="line"><span class="comment">#在大型企业中的各路由配置回环口</span></span><br><span class="line">R2(config)<span class="comment">#int loopback 1</span></span><br><span class="line">R2(config-if)<span class="comment">#ip address 2.2.2.2 255.255.255.0 </span></span><br><span class="line">R2(config-if)<span class="comment">#no shutdown </span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int loopback 1</span></span><br><span class="line">R3(config-if)<span class="comment">#ip address 3.3.3.3 255.255.255.0</span></span><br><span class="line">R3(config-if)<span class="comment">#no shutdown  </span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#int loopback 1</span></span><br><span class="line">R4(config-if)<span class="comment">#ip address 4.4.4.4 255.255.255.0</span></span><br><span class="line">R4(config-if)<span class="comment">#no shutdown  </span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在大型企业内部建立全互联的IBGP</span></span><br><span class="line">R2(config)<span class="comment">#router bgp 2                         </span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 3.3.3.3 remote-as 2</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 3.3.3.3 update-source Loopback1</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 3.3.3.3 next-hop-self </span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 4.4.4.4 remote-as 2</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 4.4.4.4 update-source Loopback1</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 4.4.4.4 next-hop-self </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 2.2.2.2 remote-as 2</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 2.2.2.2 update-source Loopback1</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 2.2.2.2 next-hop-self</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 4.4.4.4 remote-as 2</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 4.4.4.4 update-source Loopback1</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 4.4.4.4 next-hop-self</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 2.2.2.2 remote-as 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 2.2.2.2 update-source Loopback1</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 2.2.2.2 next-hop-self</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 3.3.3.3 remote-as 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 3.3.3.3 update-source Loopback1</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 3.3.3.3 next-hop-self</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#R5与R6也建立IBGP邻居关系</span></span><br><span class="line">R5(config)<span class="comment">#router bgp 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 6.6.6.6 remote-as 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 6.6.6.6 update-source Loopback1</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 6.6.6.6 next-hop-self</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router bgp 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 5.5.5.5 remote-as 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 5.5.5.5 update-source Loopback1</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#在R1、R6上通告路由</span></span><br><span class="line">R1(config)<span class="comment">#router bgp 1</span></span><br><span class="line">R1(config-router)<span class="comment">#network 1.1.1.0 mask 255.255.255.0</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router bgp 3</span></span><br><span class="line">R6(config-router)<span class="comment">#network 6.6.6.0 mask 255.255.255.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R5上对特定邻居（6.6.6.6）下发默认路由</span></span><br><span class="line">R5(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 s2/2</span></span><br><span class="line">R5(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 s2/1</span></span><br><span class="line"><span class="comment">#ps：由于大型企业的内部的IP地址为私有地址，故不能在互联网上通告。可在边界网关处配置NAT。但此处为了方便使用了默认路由</span></span><br><span class="line">R5(config)<span class="comment">#router bgp 3</span></span><br><span class="line">R5(config-router)<span class="comment">#neighbor 6.6.6.6 default-originate </span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>要求大型企业访问ISP2上的服务器是通过R3前往的（只允许在大型企业设备上配置）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#更改本地优先级，使R3的本地优先级大于R4。从而让大型企业访问ISP2时是通过R3前往的</span></span><br><span class="line">R3(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R3(config-router)<span class="comment">#bgp default local-preference 200</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/10/16/0qpFmD.png" alt="image-20201016214158132"></p>
<p>&emsp;&emsp;当然，也可以针对ISP2特定的路由条目设置本地优先级，或者使用别的BGP选路原则。此处过多赘述，详细的<a href="https://huangzc.site/2020/10/15/BGP%E7%9A%84%E9%80%89%E8%B7%AF%E5%8E%9F%E5%88%99/">BGP选路原则</a>，可以点击查看我的<a href="https://huangzc.site/2020/10/15/BGP%E7%9A%84%E9%80%89%E8%B7%AF%E5%8E%9F%E5%88%99/">另一篇博客</a>。</p>
<ol start="6">
<li>要求ISP3访问ISP1上的服务器是通过R4访问的（只允许在大型企业设备上配置）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#将R3的metric值更改为20</span></span><br><span class="line">R3(config)<span class="comment">#route-map MED</span></span><br><span class="line">R3(config-route-map)<span class="comment">#set metric 20 </span></span><br><span class="line">R3(config-route-map)<span class="comment">#exit</span></span><br><span class="line">R3(config)<span class="comment">#router bgp 2 </span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 202.101.35.5 route-map MED out </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将R4的metric值更改为10</span></span><br><span class="line">R4(config)<span class="comment">#route-map MED </span></span><br><span class="line">R4(config-route-map)<span class="comment">#set metric 10 </span></span><br><span class="line">R4(config-route-map)<span class="comment">#exit</span></span><br><span class="line">R4(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 202.101.45.5 route-map MED out </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;更改MED前：</p>
<p><img src="https://s1.ax1x.com/2020/10/16/0qpPOO.png" alt="image-20201016214115339"></p>
<p>&emsp;&emsp;更改MED后：</p>
<p><img src="https://s1.ax1x.com/2020/10/16/0qpVkd.png" alt="image-20201016215215388"></p>
<p><img src="https://s1.ax1x.com/2020/10/16/0qpMX8.png" alt="image-20201016215845533"></p>
<p>&emsp;&emsp;此处是通过更改MED值来选择路由，其他<a href="https://huangzc.site/2020/10/15/BGP%E7%9A%84%E9%80%89%E8%B7%AF%E5%8E%9F%E5%88%99/">BGP选路原则</a>请点击查看。</p>
<ol start="7">
<li>要求IBGP邻居关系安全建立</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R2(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 3.3.3.3 password huangzc</span></span><br><span class="line">R2(config-router)<span class="comment">#neighbor 4.4.4.4 password huangzc </span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 2.2.2.2 password huangzc</span></span><br><span class="line">R3(config-router)<span class="comment">#neighbor 4.4.4.4 password huangzc</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router bgp 2</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 2.2.2.2 password huangzc</span></span><br><span class="line">R4(config-router)<span class="comment">#neighbor 3.3.3.3 password huangzc</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>测试下ISP1与ISP3上的服务器能正常通信</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/10/16/0qplnS.png" alt="image-20201016193315698"></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>BGP</tag>
        <tag>CCNP</tag>
        <tag>路由</tag>
      </tags>
  </entry>
  <entry>
    <title>CCNP路由综合实验四</title>
    <url>/2019/04/19/CCNP%E8%B7%AF%E7%94%B1%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C%E5%9B%9B/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍的是IGP的综合应用。</p>
<p>&emsp;&emsp;A B 两公司原本内网运行RIPv2 与 EIGRP 协议，现因为业务需要合并到 C 公司……</p>
<a id="more"></a>

<p>【实验拓扑】</p>
<p> <img src="https://s1.ax1x.com/2020/09/12/wdVKyT.png"></p>
<p>【实验说明】</p>
<ol>
<li><p>A B 两公司原本内网运行RIPv2 与 EIGRP 协议，现因为业务需要合并到 C 公司（内网运行 OSPF）</p>
</li>
<li><p>A 公司的R6 静态配置了默认路由指向自己连着的 ISP。B 公司的R7 静态配置了默认路由指向自己连着的 ISP（拓扑没有体现出来）</p>
</li>
<li><p>A 公司的网段是 10.1.0.0/16 的，R6 上起三个回环口 10.1.1.1/24， 10.1.2.2/24 ，10.1.3.3/24，用于模拟 A 公司内网的三个子网</p>
</li>
<li><p>B 公司的网段是 192.168.1.0/24 的， R7 上起三个回环口 192.168.1.1/28 ，192.168.1.17/28， 192.168.1.33/28 ，用于模拟B 公司内网的三个子网</p>
</li>
<li><p>C 公司的网段是 172.16.0.0/16 的，IP 地址为 172.16.XY.X 或者 172.16.XY.Y 均为/24 比如 R1 与 R5 的 IP 地址为 172.16.15.1/24 及 172.16.15.5/24</p>
</li>
<li><p>R3 是 C 公司的网关，通过两条专线链路连着两个 ISP 其中一条连着电信，带宽为10M ，另一条连着联通，带宽为 2M（拓扑中上面链路为电信，下面为联通），外网 IP 地址自行规划</p>
</li>
<li><p>R8 上配置两个回环口 1 及 2 分别模拟电信网的服务器及联通网的服务器</p>
</li>
<li><p>A B 两公司原本是通过联通接入因特网的，C 公司是通过电信接入因特网的</p>
</li>
<li><p>R9 上起三个回环口 172.16.1.1/24， 172.16.2.1/24 ，172.16.3.1/24，模拟区域 1的主机</p>
</li>
</ol>
<p>【实验需求】</p>
<ol>
<li>依据实验说明，配置好 IP 地址，配置好各路由协议，保证公司内网可达</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/09/15/wyOQr4.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#A公司（启用RIP协议）</span></span><br><span class="line">R1(config)<span class="comment">#router rip   </span></span><br><span class="line">R1(config-router)<span class="comment">#version 2</span></span><br><span class="line">R1(config-router)<span class="comment">#network 10.1.0.0 </span></span><br><span class="line">R1(config-router)<span class="comment">#no auto-summary</span></span><br><span class="line"></span><br><span class="line">R6(config)<span class="comment">#router rip </span></span><br><span class="line">R6(config-router)<span class="comment">#version 2 </span></span><br><span class="line">R6(config-router)<span class="comment">#network 10.0.0.0</span></span><br><span class="line">R6(config-router)<span class="comment">#no auto-summary </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#B公司（启用EIGRP协议）</span></span><br><span class="line">R2(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R2(config-router)<span class="comment">#network 192.168.1.0</span></span><br><span class="line"></span><br><span class="line">R7(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R7(config-router)<span class="comment">#network 192.168.10.0</span></span><br><span class="line">R7(config-router)<span class="comment">#network 192.168.20.0</span></span><br><span class="line">R7(config-router)<span class="comment">#network 192.168.30.0</span></span><br><span class="line">R7(config-router)<span class="comment">#network 192.168.1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#C公司（启用OSPF协议）</span></span><br><span class="line">R1(config)<span class="comment">#int e0/1</span></span><br><span class="line">R1(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line">R2(config-if)<span class="comment">#int e0/2</span></span><br><span class="line">R2(config-if)<span class="comment">#ip ospf 1 area 1</span></span><br><span class="line"></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#int e0/0</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line">R4(config-if)<span class="comment">#int e0/1</span></span><br><span class="line">R4(config-if)<span class="comment">#ip ospf 1 area 1</span></span><br><span class="line"></span><br><span class="line">R5(config)<span class="comment">#int range e0/0-3</span></span><br><span class="line">R5(config-if-range)<span class="comment">#ip ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">R9(config)<span class="comment">#int range e0/0-1</span></span><br><span class="line">R9(config-if-range)<span class="comment">#ip ospf 1 area 1</span></span><br><span class="line">R9(config-if-range)<span class="comment">#exit</span></span><br><span class="line">R9(config)<span class="comment">#int range lo1-3</span></span><br><span class="line">R9(config-if-range)<span class="comment">#ip ospf 1 area 1</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在相应设备上通过重分发技术，确保合并后的整个公司全网可达（注意避免路由回灌）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R1上进行路由的重分发</span></span><br><span class="line">R1(config)<span class="comment">#router rip</span></span><br><span class="line">R1(config-router)<span class="comment">#redistribute ospf 1 metric 2</span></span><br><span class="line">R1(config)<span class="comment">#router ospf 1 </span></span><br><span class="line">R1(config-router)<span class="comment">#redistribute rip metric 2 subnets </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在R2上进行路由的重复发</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute eigrp 90 subnets </span></span><br><span class="line">R2(config)<span class="comment">#router eigrp 90 </span></span><br><span class="line">R2(config-router)<span class="comment">#redistribute ospf 1 metric 1 1 1 1 1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyOtG6.png"></p>
<ol start="3">
<li>因为 R6 与 R7 性能不足，尽可能减少其路由表大小的同时又保证依然能访问 C 公司</li>
</ol>
<p>&emsp;&emsp;汇总前的路由表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R6<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      10.0.0.0/8 is variably subnetted, 8 subnets, 2 masks</span><br><span class="line"></span><br><span class="line">C        10.1.1.0/24 is directly connected, Loopback1</span><br><span class="line">L        10.1.1.1/32 is directly connected, Loopback1</span><br><span class="line">C        10.1.2.0/24 is directly connected, Loopback2</span><br><span class="line">L        10.1.2.2/32 is directly connected, Loopback2</span><br><span class="line">C        10.1.3.0/24 is directly connected, Loopback3</span><br><span class="line">L        10.1.3.3/32 is directly connected, Loopback3</span><br><span class="line">C        10.1.16.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        10.1.16.6/32 is directly connected, Ethernet0/0</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 9 subnets, 2 masks</span><br><span class="line">R        172.16.1.1/32 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.2.1/32 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.3.1/32 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.15.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.25.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.29.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.35.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.45.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R        172.16.49.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R     192.168.1.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R     192.168.10.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R     192.168.20.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br><span class="line">R     192.168.30.0/24 [120/2] via 10.1.16.1, 00:00:04, Ethernet0/0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R7<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      10.0.0.0/24 is subnetted, 4 subnets</span><br><span class="line"></span><br><span class="line">D EX     10.1.1.0 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     10.1.2.0 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     10.1.3.0 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     10.1.16.0 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 9 subnets, 2 masks</span><br><span class="line">D EX     172.16.1.1/32 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.2.1/32 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.3.1/32 [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.15.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.25.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.29.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.35.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.45.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D EX     172.16.49.0/24 </span><br><span class="line">           [170/2560025856] via 192.168.1.2, 00:00:02, Ethernet0/0</span><br><span class="line">D     192.168.0.0/16 is a summary, 00:00:02, Null0</span><br><span class="line">      192.168.1.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.1.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.1.7/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.10.0/24 is directly connected, Loopback1</span><br><span class="line">L        192.168.10.1/32 is directly connected, Loopback1</span><br><span class="line">      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.20.0/24 is directly connected, Loopback2</span><br><span class="line">L        192.168.20.1/32 is directly connected, Loopback2</span><br><span class="line">      192.168.30.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.30.0/24 is directly connected, Loopback3</span><br><span class="line">L        192.168.30.1/32 is directly connected, Loopback3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在R1、R2上对路由条目进行汇总，以较少其路由条目</span></span><br><span class="line">R1(config)<span class="comment">#int e0/0</span></span><br><span class="line">R1(config-if)<span class="comment">#ip summary-address rip 172.16.0.0 255.255.0.0</span></span><br><span class="line"><span class="comment">#由于RIP只支持对主类路由的汇总，故无法在R1上对192.168.0.0/16的路由进行汇总</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#int e0/1</span></span><br><span class="line">R2(config-if)<span class="comment">#ip summary-address eigrp 90 10.1.0.0 255.255.0.0</span></span><br><span class="line">R2(config-if)<span class="comment">#ip summary-address eigrp 90 172.16.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#但可以直接在R7上直接对192.168.0.0/16的路由进行汇总</span></span><br><span class="line">R7(config)<span class="comment">#int e0/0</span></span><br><span class="line">R7(config-if)<span class="comment">#ip summary-address eigrp 90 192.168.0.0 255.255.0.0</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;汇总过后的路由表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R6<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      10.0.0.0/8 is variably subnetted, 9 subnets, 3 masks</span><br><span class="line"></span><br><span class="line">R        10.1.0.0/16 [120/2] via 10.1.16.1, 00:00:01, Ethernet0/0</span><br><span class="line">C        10.1.1.0/24 is directly connected, Loopback1</span><br><span class="line">L        10.1.1.1/32 is directly connected, Loopback1</span><br><span class="line">C        10.1.2.0/24 is directly connected, Loopback2</span><br><span class="line">L        10.1.2.2/32 is directly connected, Loopback2</span><br><span class="line">C        10.1.3.0/24 is directly connected, Loopback3</span><br><span class="line">L        10.1.3.3/32 is directly connected, Loopback3</span><br><span class="line">C        10.1.16.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        10.1.16.6/32 is directly connected, Ethernet0/0</span><br><span class="line">R     172.16.0.0/16 [120/2] via 10.1.16.1, 00:00:01, Ethernet0/0</span><br><span class="line">R     192.168.0.0/16 [120/2] via 10.1.16.1, 00:00:01, Ethernet0/0</span><br><span class="line">R     192.168.1.0/24 [120/2] via 10.1.16.1, 00:00:01, Ethernet0/0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R7<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      10.0.0.0/16 is subnetted, 1 subnets</span><br><span class="line"></span><br><span class="line">D        10.1.0.0 [90/2560025856] via 192.168.1.2, 00:04:03, Ethernet0/0</span><br><span class="line">D     172.16.0.0/16 [90/2560025856] via 192.168.1.2, 00:03:54, Ethernet0/0</span><br><span class="line">D     192.168.0.0/16 is a summary, 00:00:35, Null0</span><br><span class="line">      192.168.1.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.1.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        192.168.1.7/32 is directly connected, Ethernet0/0</span><br><span class="line">      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.10.0/24 is directly connected, Loopback1</span><br><span class="line">L        192.168.10.1/32 is directly connected, Loopback1</span><br><span class="line">      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.20.0/24 is directly connected, Loopback2</span><br><span class="line">L        192.168.20.1/32 is directly connected, Loopback2</span><br><span class="line">      192.168.30.0/24 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        192.168.30.0/24 is directly connected, Loopback3</span><br><span class="line">L        192.168.30.1/32 is directly connected, Loopback3</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyO2z8.png"></p>
<ol start="4">
<li>尽可能减小OSPF 骨干区域路由器（R5）的路由表的同时又保证全网可达</li>
</ol>
<p>&emsp;&emsp;汇总前R5的路由表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R5<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">      10.0.0.0/24 is subnetted, 4 subnets</span><br><span class="line"></span><br><span class="line">O E2     10.1.1.0 [110/2] via 172.16.15.1, 03:32:58, Ethernet0/0</span><br><span class="line">O E2     10.1.2.0 [110/2] via 172.16.15.1, 03:32:58, Ethernet0/0</span><br><span class="line">O E2     10.1.3.0 [110/2] via 172.16.15.1, 03:32:58, Ethernet0/0</span><br><span class="line">O E2     10.1.16.0 [110/2] via 172.16.15.1, 03:34:27, Ethernet0/0</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 13 subnets, 2 masks</span><br><span class="line">O IA     172.16.1.1/32 [110/21] via 172.16.45.4, 03:42:02, Ethernet0/2</span><br><span class="line">                       [110/21] via 172.16.25.2, 03:41:55, Ethernet0/1</span><br><span class="line">O IA     172.16.2.1/32 [110/21] via 172.16.45.4, 03:42:02, Ethernet0/2</span><br><span class="line">                       [110/21] via 172.16.25.2, 03:41:55, Ethernet0/1</span><br><span class="line">O IA     172.16.3.1/32 [110/21] via 172.16.45.4, 03:42:02, Ethernet0/2</span><br><span class="line">                       [110/21] via 172.16.25.2, 03:41:55, Ethernet0/1</span><br><span class="line">C        172.16.15.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.15.5/32 is directly connected, Ethernet0/0</span><br><span class="line">C        172.16.25.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        172.16.25.5/32 is directly connected, Ethernet0/1</span><br><span class="line">O IA     172.16.29.0/24 [110/20] via 172.16.25.2, 03:45:51, Ethernet0/1</span><br><span class="line">C        172.16.35.0/24 is directly connected, Ethernet0/3</span><br><span class="line">L        172.16.35.5/32 is directly connected, Ethernet0/3</span><br><span class="line">C        172.16.45.0/24 is directly connected, Ethernet0/2</span><br><span class="line">L        172.16.45.5/32 is directly connected, Ethernet0/2</span><br><span class="line">O IA     172.16.49.0/24 [110/20] via 172.16.45.4, 03:44:55, Ethernet0/2</span><br><span class="line">O E2  192.168.0.0/16 [110/20] via 172.16.25.2, 00:08:46, Ethernet0/1</span><br><span class="line">O E2  192.168.1.0/24 [110/20] via 172.16.25.2, 03:30:15, Ethernet0/1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#分别在ABR、ASBR上对三类、五类的路由进行汇总</span></span><br><span class="line">R1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R1(config-router)<span class="comment">#summary-address 10.1.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#summary-address 192.168.0.0 255.255.0.0</span></span><br><span class="line">R2(config-router)<span class="comment">#area 1 range 172.16.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 1 range 172.16.0.0 255.255.0.0</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;汇总后R5的路由表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R5<span class="comment">#sh ip rou </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line"></span><br><span class="line">   + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is not <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">       10.0.0.0/16 is subnetted, 1 subnets</span><br><span class="line"></span><br><span class="line">O E2     10.1.0.0 [110/2] via 172.16.15.1, 00:00:02, Ethernet0/0</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 9 subnets, 3 masks</span><br><span class="line">O IA     172.16.0.0/16 [110/20] via 172.16.45.4, 00:00:02, Ethernet0/2</span><br><span class="line">                       [110/20] via 172.16.25.2, 00:00:02, Ethernet0/1</span><br><span class="line">C        172.16.15.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.15.5/32 is directly connected, Ethernet0/0</span><br><span class="line">C        172.16.25.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        172.16.25.5/32 is directly connected, Ethernet0/1</span><br><span class="line">C        172.16.35.0/24 is directly connected, Ethernet0/3</span><br><span class="line">L        172.16.35.5/32 is directly connected, Ethernet0/3</span><br><span class="line">C        172.16.45.0/24 is directly connected, Ethernet0/2</span><br><span class="line">L        172.16.45.5/32 is directly connected, Ethernet0/2</span><br><span class="line">O E2  192.168.0.0/16 [110/20] via 172.16.25.2, 00:00:02, Ethernet0/1</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyX1l8.png"></p>
<ol start="5">
<li>尽可能减少R9 的路由表的同时确保其能正常访问B 公司（通过 R2） 而访问 ISP 及A 公司是通过R4</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#将area 1设置为totally-nssa区域</span></span><br><span class="line">R2(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R2(config-router)<span class="comment">#area 1 nssa no-summary </span></span><br><span class="line"></span><br><span class="line">R4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R4(config-router)<span class="comment">#area 1 nssa no-summary </span></span><br><span class="line"></span><br><span class="line">R9(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R9(config-router)<span class="comment">#area 1 nssa</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R9<span class="comment">#show ip route </span></span><br><span class="line">Codes: L - <span class="built_in">local</span>, C - connected, S - static, R - RIP, M - mobile, B - BGP</span><br><span class="line">       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area </span><br><span class="line">       N1 - OSPF NSSA external <span class="built_in">type</span> 1, N2 - OSPF NSSA external <span class="built_in">type</span> 2</span><br><span class="line">       E1 - OSPF external <span class="built_in">type</span> 1, E2 - OSPF external <span class="built_in">type</span> 2</span><br><span class="line">       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2</span><br><span class="line">       ia - IS-IS inter area, * - candidate default, U - per-user static route</span><br><span class="line">       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP</span><br><span class="line">       a - application route</span><br><span class="line">       + - replicated route, % - next hop override</span><br><span class="line"></span><br><span class="line">Gateway of last resort is 172.16.49.4 to network 0.0.0.0</span><br><span class="line"></span><br><span class="line">O*IA  0.0.0.0/0 [110/11] via 172.16.49.4, 00:00:38, Ethernet0/1</span><br><span class="line">      172.16.0.0/16 is variably subnetted, 10 subnets, 2 masks</span><br><span class="line">C        172.16.1.0/24 is directly connected, Loopback1</span><br><span class="line">L        172.16.1.1/32 is directly connected, Loopback1</span><br><span class="line">C        172.16.2.0/24 is directly connected, Loopback2</span><br><span class="line">L        172.16.2.1/32 is directly connected, Loopback2</span><br><span class="line">C        172.16.3.0/24 is directly connected, Loopback3</span><br><span class="line">L        172.16.3.1/32 is directly connected, Loopback3</span><br><span class="line">C        172.16.29.0/24 is directly connected, Ethernet0/0</span><br><span class="line">L        172.16.29.9/32 is directly connected, Ethernet0/0</span><br><span class="line">C        172.16.49.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        172.16.49.9/32 is directly connected, Ethernet0/1</span><br><span class="line">O N2  192.168.0.0/16 [110/20] via 172.16.29.2, 00:01:07, Ethernet0/0</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;在R9的路由表中存在到达B公司192.168.0.0的明细路由，所以访问B公司时优先选择该路由，下一跳为R2；但不存在到达A公司10.1.0.0的明细路由，所以只能通过默认路由来访问A公司，存在两个下一跳，此时应更改接口的开销实现优先选择R4来访问A公司。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R9(config)<span class="comment">#int e0/1</span></span><br><span class="line">R9(config-if)<span class="comment">#ip ospf cost 1</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;查看R9路由表，可知此时默认路由的下一跳变为R4。</p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyX2kR.png"></p>
<p>&emsp;&emsp;测试：</p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyXIXD.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyX70H.png"></p>
<ol start="6">
<li>要求 A B 两公司自己拉的宽带断线时，可以通过 C 公司来访问 ISP 并且是依然通过联通线路，当联通线路不可用时，可以通过电信线路访问互联网</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#匹配感兴趣流量</span></span><br><span class="line">R3(config)<span class="comment">#access-list 1 permit 10.1.0.0 0.0.255.255    </span></span><br><span class="line">R3(config)<span class="comment">#access-list 1 permit 192.168.0.0 0.0.255.255 </span></span><br><span class="line">R3(config)<span class="comment">#access-list 2 permit 172.16.0.0 0.0.255.255</span></span><br><span class="line"><span class="comment">#设置NAT的内外接口</span></span><br><span class="line">R3(config)<span class="comment">#int e0/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip nat inside </span></span><br><span class="line">R3(config-if)<span class="comment">#int s1/0</span></span><br><span class="line">R3(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line">R3(config-if)<span class="comment">#int s1/1</span></span><br><span class="line">R3(config-if)<span class="comment">#ip nat outside </span></span><br><span class="line"><span class="comment">#设置路由图</span></span><br><span class="line">R3(config)<span class="comment">#route-map ab1  </span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 1</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match interface serial 1/1</span></span><br><span class="line">R3(config)<span class="comment">#route-map ab2</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 1</span></span><br><span class="line">R3(config)<span class="comment">#route-map c1</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 2</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match interface serial 1/0</span></span><br><span class="line">R3(config)<span class="comment">#route-map c2</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 2</span></span><br><span class="line"><span class="comment">#配置NAT</span></span><br><span class="line">R3(config)<span class="comment">#ip nat inside source route-map ab1 interface serial 1/1 overload </span></span><br><span class="line">R3(config)<span class="comment">#ip nat inside source route-map ab2 interface serial 1/0 overload </span></span><br><span class="line">R3(config)<span class="comment">#ip nat inside source route-map c1 interface serial 1/0 overload </span></span><br><span class="line">R3(config)<span class="comment">#ip nat inside source route-map c2 interface serial 1/1 overload </span></span><br><span class="line"><span class="comment">#配置默认路由</span></span><br><span class="line">R3(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 12.12.12.2</span></span><br><span class="line">R3(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 23.23.23.3</span></span><br><span class="line"><span class="comment">#在OSPF进程中下发默认路由</span></span><br><span class="line">R3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">R3(config-router)<span class="comment">#default-information originate </span></span><br><span class="line"><span class="comment">#配置策略路由</span></span><br><span class="line">R3(config)<span class="comment">#route-map PBR permit 10</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 1</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match interface serial 1/1</span></span><br><span class="line">R3(config-route-map)<span class="comment">#set interface serial 1/1</span></span><br><span class="line">R3(config)<span class="comment">#route-map PBR permit 20</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 1</span></span><br><span class="line">R3(config-route-map)<span class="comment">#set interface serial 1/0</span></span><br><span class="line">R3(config)<span class="comment">#route-map PBR permit 30</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 2</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match interface serial 1/0</span></span><br><span class="line">R3(config-route-map)<span class="comment">#set interface serial 1/0</span></span><br><span class="line">R3(config)<span class="comment">#route-map PBR permit 40</span></span><br><span class="line">R3(config-route-map)<span class="comment">#match ip address 2</span></span><br><span class="line">R3(config-route-map)<span class="comment">#set interface serial 1/1</span></span><br><span class="line"><span class="comment">#在端口中调用策略路由</span></span><br><span class="line">R3(config)<span class="comment">#int e0/0     </span></span><br><span class="line">R3(config-if)<span class="comment">#ip policy route-map PBR</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyXqAA.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyXzjS.png"></p>
<p>&emsp;&emsp;当联通线路不可用时，通过电信线路访问互联网：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config)</span></span><span class="selector-id">#int</span> s1/<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span>#shutdown</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyjkhq.png"></p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyjnuF.png"></p>
<ol start="7">
<li>C 公司访问互联网时是通过电信线路，当电信线路出故障，可以通过联通线路访问互联网</li>
</ol>
<p>&emsp;&emsp;具体配置已在6中完成。效果如下：</p>
<p><img src="https://s1.ax1x.com/2020/09/15/wyj89x.png"></p>
<p>&emsp;&emsp;电信线路出现故障时，通过联通线路访问互联网：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#int</span> s1/<span class="number">0</span></span><br><span class="line"><span class="function"><span class="title">R3</span><span class="params">(config-if)</span></span><span class="selector-id">#shutdown</span> </span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2020/09/15/wyjYjO.png"></p>
]]></content>
      <categories>
        <category>CCNP实验</category>
      </categories>
      <tags>
        <tag>CCNP</tag>
        <tag>路由</tag>
        <tag>IGP</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS中“#”与“.”的区别</title>
    <url>/2021/12/14/CSS%E4%B8%AD%E2%80%9C#%E2%80%9D%E4%B8%8E%E2%80%9C.%E2%80%9D%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍CSS中“#”与“.”的区别。</p>
<a id="more"></a>

<p>&emsp;&emsp;在CSS中用“**#<strong>”定义样式，在调用时必须使用</strong>id<strong>；用“</strong>.<strong>”定义样式，调用时必须使用</strong>class<strong>。用“</strong>#<strong>”定义的样式，一般都是定义结构框架，一些大的容器，且在同一个页面只能出现一次；而“</strong>.<strong>”定义的样式，一般都是起修饰作用或多次重复的样式。</strong>在同一个层里同时出现ID和CLASS样式，ID更优先于CLASS。**</p>
<p>id：用来定义页面中大的样式，如栏目划分，顶部，正文，底部等；用“**#top**”的形式来定义；</p>
<p>class：用来定义一些比较细节的样式，如具体的一个菜单，一行文字等，用“**.text**”的形式来定义。</p>
<p>&emsp;&emsp;在定义HTML中的标签，如ul，img，p等时，直接使用img{}即可。</p>
<p>&emsp;&emsp;calss是样式组，需用“**.<strong>”定义的样式，调用时必须使用</strong>class**，如class=”style”。“.style”定义样式组，可以被反复调用，即在一个页面里，可以有多个元素用同一个style； </p>
<p>&emsp;&emsp;id则是固定标签，需用“**#<strong>”定义，调用时必须使用</strong>id<strong>，如id=”style”。与“</strong>.<strong>”不同“</strong>#**”在同一个页面只能出现一次。</p>
<p>eg:</p>
<p><strong>“#main”和“.main”有什么区别:</strong></p>
<p>“#main”的意思是id为”main”这个元素的样式，也只定义了id为“main”这个元素的样式。<br>“.main”的意思是新建一个名为”main”的样式，“.main”一但定义以后，可以让其他的元素来调用，方法为class=”main”</p>
<p>&emsp;&emsp;简单来说：“#main”是定义具体对象”main”的专有属性；“.main”是定义抽象对象的共有属性”main”。比较广泛的用途是“**#<strong>”用于定义网页框架；“</strong>.**”用于定义各个网页元素。“#main”中的”main”只能在网页中出现一次，而“.main”中的”main”可以出现无数次。</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>MPLS基础知识</title>
    <url>/2020/11/03/MPLS%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<p>&emsp;&emsp;多协议标签交换（英语：Multi-Protocol Label Switching，缩写为MPLS）是一种在开放的通信网上利用标签引导数据高速、高效传输的新技术。多协议的含义是指MPLS不但可以支持多种网络层层面上的协议，还可以兼容第二层的多种数据链路层技术。</p>
<a id="more"></a>

<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h1><p>&emsp;&emsp;多协议标签交换（Multi-Protocol Label Switching，MPLS）是新一代的IP高速骨干网络交换标准，由因特网工程任务组（Internet Engineering Task Force，IETF）提出。</p>
<p>&emsp;&emsp;MPLS是利用标记（label）进行数据转发的。当分组进入网络时，要为其分配固定长度的短的标记，并将标记与分组封装在一起，在整个转发过程中，交换节点仅根据标记进行转发。</p>
<p>&emsp;&emsp;MPLS 独立于第二和第三层协议，诸如ATM 和IP。它提供了一种方式，将IP地址映射为简单的具有固定长度的标签，用于不同的包转发和包交换技术。它是现有路由和交换协议的接口，如IP、ATM、帧中继、资源预留协议（RSVP）、开放最短路径优先（OSPF）等等。</p>
<p>&emsp;&emsp;在MPLS 中，数据传输发生在标签交换路径（LSP）上。LSP 是每一个沿着从源端到终端的路径上的结点的标签序列。</p>
<p>&emsp;&emsp;MPLS 主要设计来解决网路问题，如网路速度、可扩展性、服务质量（QoS）管理以及流量工程，同时也为下一代IP 中枢网络解决宽带管理及服务请求等问题。</p>
<p>&emsp;&emsp;在这部分，我们主要关注通用MPLS 框架。有关LDP、CR-LDP 和RSVP-TE 的具体内容可以参考个别文件。</p>
<p>&emsp;&emsp;多协议标签交换MPLS最初是为了提高转发速度而提出的。与传统IP路由方式相比，它在数据转发时，只在网络边缘分析IP报文头，而不用在每一跳都分析IP报文头，从而节约了处理时间。</p>
<p>&emsp;&emsp;MPLS起源于IPv4（Internet Protocol version 4），其核心技术可扩展到多种网络协议，包括IPX（Internet Packet Exchange）、Appletalk、DECnet、CLNP（Connectionless Network Protocol）等。“MPLS”中的“Multiprotocol”指的就是支持多种网络协议。</p>
<h1 id="2-基础知识"><a href="#2-基础知识" class="headerlink" title="2 基础知识"></a>2 基础知识</h1><h2 id="2-1-MPLS的特性"><a href="#2-1-MPLS的特性" class="headerlink" title="2.1 MPLS的特性"></a>2.1 MPLS的特性</h2><ul>
<li>MPLS依赖IP路由和CEF交换</li>
<li>MPLS是一种依据数据包标签的转发技术</li>
<li>MPLS支持多种三层协议</li>
<li>MPLS涉及的目标网段与传统的IP转发是一样的</li>
</ul>
<h2 id="2-2-MPLS标签"><a href="#2-2-MPLS标签" class="headerlink" title="2.2 MPLS标签"></a>2.2 MPLS标签</h2><p><strong>1. 标签描述</strong></p>
<p>&emsp;&emsp;两种模式：frame mode；ATM mode（cell mode），我们主要研究的是 frame mode。</p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6nywD.png" alt="image-20201103125606257"></p>
<p>&emsp;&emsp;标签头一共32位，包含的字段如下：</p>
<table>
<thead>
<tr>
<th>LABEL</th>
<th>20bits</th>
</tr>
</thead>
<tbody><tr>
<td>BoS</td>
<td>1bit为栈底位（这一位置 1 ，则为最后一个标签。可以给一个数据压多层标签，最后一个标签的BoS位置1，当处理到这层，上层数据包为普通数据包。）</td>
</tr>
<tr>
<td>TTL</td>
<td>8bit 最大 255 ，通常在加标签的时候，把普通的IP报文中的TTL字段直接复制进来使用，在弹出标签是，再将标签中的TTL字段复制进IP报文中。</td>
</tr>
<tr>
<td>EXP</td>
<td>3bit 实验位用于QoS</td>
</tr>
</tbody></table>
<p><strong>2. 标签的位置</strong></p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6uUHS.png" alt="image-20201103130842541"></p>
<p>&emsp;&emsp;路由器如何知道一个报文是普通报文还是一个标签包呢？MPLS报文会在二层头和三层包间插入一个MPLS标签头。同时二层数据链路层帧头会做相应的指示，例如以太网数据帧，MAC 层的 TYPE 字段会指示上层数据是否为MPLS标签帧（如果是IPv4报文的话值为0x0800，如果是标签包则为8847-单播或8848-组播）</p>
<p>&emsp;&emsp;上图是封装了三层标签包，对于一个LSR来说，只处理第一个标签。每一层标签都有个BoS栈底位，用来表示是否已经是标签栈的栈底，最后一个标签的BoS=1。</p>
<p><strong>3. MPLS编码</strong></p>
<p>&emsp;&emsp;标签栈放置在第三层包头之前，也就是说，被传输的协议头部之前，同时在第二层包头之后。对于第2层链路层封装可以是CISCO IOS所支持的所有封装类型，PPP、HDLC、Ethenet等等。那么在这些第2层的帧头，就需要有相应的协议字段来指示上层是一个标签头。</p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6uHu6.png" alt="无标题"></p>
<p><strong>4. 标签的处理方式</strong></p>
<ul>
<li><p>Insert (impose or push)</p>
</li>
<li><p>swap</p>
</li>
<li><p>Remove (PoP)</p>
<p>关于标签处理方式的更详细内容，见下文。</p>
</li>
</ul>
<h1 id="3-标签报文的查找与转发"><a href="#3-标签报文的查找与转发" class="headerlink" title="3 标签报文的查找与转发"></a>3 标签报文的查找与转发</h1><h2 id="3-1-MPLS的三张表"><a href="#3-1-MPLS的三张表" class="headerlink" title="3.1 MPLS的三张表"></a>3.1 MPLS的三张表</h2><p><strong>1. FIB表</strong></p>
<p>&emsp;&emsp;FIB表其实就是CEF表</p>
<p><strong>2. LIB标签信息库</strong></p>
<p>&emsp;&emsp;路由器为每一个IGP前缀在本地生成一个标签并分发给LDP邻居，同时也从其他LDP邻居收到为特定前缀分发的标签。路由器将本地标签和远程标签（LDP邻居发给我的）存储在LIB中。</p>
<p><strong>3. LFIB标签转发信息库</strong></p>
<p>&emsp;&emsp;LSR路由可能收到某个特定前缀的多个标签（多个LDP邻居分发的），但他只需要使用其中一个，IP路由表用来确定这个IPv4前缀的下一跳（LFIB的构造需要一来IGP路由表，因为LFIB的下一跳就是IGP表算来的）LSR用这样的信息来创建它的LFIB。在 LFIB中本地捆绑的标签作为入站标签，LDP 邻居通告的标签作为出站标签。</p>
<p>&emsp;&emsp;构成LFIB的标签可以不是LDP分发的，在MPLS流量工程中使用RSVP分配标签，在MPLS VPN中，VPN标签由BGP分发。在任何情况下，LFIB总是用来转发入站的带标签的报文。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show mpls forwarding-table </span></span><br><span class="line">Local      Outgoing   Prefix           Bytes Label   Outgoing   Next Hop    </span><br><span class="line">Label      Label      or Tunnel Id     Switched      interface              </span><br><span class="line">16         16         172.16.2.0/24    0             Et0/1      192.168.12.2</span><br><span class="line">17         17         5.5.5.0/24       0             Et0/1      192.168.12.2</span><br><span class="line">18         18         4.4.4.0/24       0             Et0/1      192.168.12.2</span><br><span class="line">19         19         3.3.3.0/24       0             Et0/1      192.168.12.2</span><br><span class="line">20         Pop Label  2.2.2.0/24       0             Et0/1      192.168.12.2</span><br><span class="line">21         20         192.168.34.0/24  0             Et0/1      192.168.12.2</span><br><span class="line">22         21         192.168.35.0/24  0             Et0/1      192.168.12.2</span><br><span class="line">23         Pop Label  192.168.23.0/24  0             Et0/1      192.168.12.2</span><br><span class="line">24         Pop Label  192.168.25.0/24  0             Et0/1      192.168.12.2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show mpls forwarding-table 172.16.2.0 detail </span></span><br><span class="line">Local      Outgoing   Prefix           Bytes Label   Outgoing   Next Hop    </span><br><span class="line">Label      Label      or Tunnel Id     Switched      interface              </span><br><span class="line">16         16         172.16.2.0/24    0             Et0/1      192.168.12.2</span><br><span class="line">        MAC/Encaps=14/18, MRU=1500, Label Stack&#123;16&#125;</span><br><span class="line">        AABBCC002010AABBCC0010108847 00010000</span><br><span class="line">        No output feature configured</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;使用detail关键字能查看到LFIB转发条目的详细信息，包括二层的信息，以及所有的标签内容，如果不加则只能看到顶层标签。</p>
<h2 id="3-2-IP查找和标签查找"><a href="#3-2-IP查找和标签查找" class="headerlink" title="3.2 IP查找和标签查找"></a>3.2 IP查找和标签查找</h2><p><img src="https://s1.ax1x.com/2020/11/03/B6ubDK.png" alt="无标题"></p>
<p>&emsp;&emsp;如果LSR收到一个IP报文，则查看FIB表（CEF表），假设FIB（CEF表）相关表项输出如下： </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1<span class="comment">#show ip cef 172.16.2.0 detail </span></span><br><span class="line">172.16.2.0/24, epoch 0</span><br><span class="line">  <span class="built_in">local</span> label info: global/16</span><br><span class="line">  nexthop 192.168.12.2 Ethernet0/1 label 16</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;那么LSR将这个IP包压入一个标签头，打上标签16，再从 E0/1接口转发出去。在CISCO lOS中，CEF交换是唯一的一种可用于标记报文的IP转发模式，因此在启用MPLS的时候必须在路由器上开启CEF。</p>
<p>&emsp;&emsp;而当一台路由器收到一个带标签的报文的时候，则在LFIB表中进行查找，LFIB表中相关的匹配条目会有针对该入站标签的出站动作或标签，以及下一跳信息。</p>
<p>【注意】如果路由器收到一个带标签的数据包，并且顶部标签不能在本地LFIB中找到，那么CISCO IOS将丢弃这个数据包。</p>
<h2 id="3-3-标签分配过程概述"><a href="#3-3-标签分配过程概述" class="headerlink" title="3.3 标签分配过程概述"></a>3.3 标签分配过程概述</h2><p><strong>1. 构建IP路由表</strong></p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6uOED.png" alt="无标题"></p>
<p>&emsp;&emsp;首先呢，所有的路由器都运行路由协议，全网路由互通。接下去在路由器的接口上激活LDP，那么路由器两两之间就会形成LDP邻接关系。</p>
<p><strong>2. 分配并分发标签</strong></p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6KSgI.png" alt="无标题"></p>
<p>&emsp;&emsp;激活LDP后，每台路由器会为自己本地路由表中的路由前缀分配并捆绑标签，例如本图中的 X 路由，所有路由器都会自己为 X 路由分配一个标签，然后将为 X 路由捆绑的标签保存在本地的 LIB 表里。随后，所有的LDP路由器，将自己为各个路由前缀捆绑的标签发给它的LDP邻居，如图所示，B将捆绑的标签发给了A、E和C。这里有个小细节，注意，标签的分发没有水平分割的概念，也就是说虽然B可能是从C学习到路由 X，但是 B 仍然会将为前缀 X 捆绑的标签传递给C。C也会将传递自B的标签放在LIB中，不过不用担心会有环路，因为 LDP 可以借助IGP路由协议来防止环路。</p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6Kib8.png" alt="无标题"></p>
<p>&emsp;&emsp;当 LDP 路由器从他的 LDP 邻居收到邻居的标签捆绑，它会将捆绑的结果存储在自己的 LIB 表中，LIB 表中有 local label ，这是自己为特定路由前缀分发的标签，remote label 这是邻居为该路由前缀分发的标签。LDP 路由器会将邻居分配的 remote label 都放在 LIB，但是只会从 LIB 中所有可能的标签中选择出一个可能的出站标签放入 LFIB 中。LDP 路由器根据 LIB 表，结合路由表，构成 LFIB 表，如上图中 A 的 LFIB 表。<br>&emsp;&emsp;这里有一点要注意，我们看E路由器，实际上，它是会收到自己 LDP 邻居 B 和 C 的标签捆绑，其中都有关于路由 X 捆绑的标签，那么 E 在自己的 LFIB 表里，存的是哪位邻居的 remote label 呢？答案是 C，因为 C 是E路由器去往 X 的下一跳，E会借助路由表，来判断谁的标签捆绑“更优”。</p>
<p><strong>3. LIB and LFIB表的建立</strong></p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6KrIe.png" alt="无标题"></p>
<p>&emsp;&emsp;在所有的LDP路由器都互相发送标签捆绑后，大家逐步构建自己的LFIB。</p>
<p><img src="https://s1.ax1x.com/2020/11/03/B6Kbzn.png" alt="无标题"></p>
<p>&emsp;&emsp;大家的 LFIB 构建完成后，我们就能看到，当 A 收到一个 IP 数据包，要访问X，那么 A 查看自己的 CEF 表（为什么是查看CEF还记得么？)，发现要给数据包压标签，于是它压上标签头，标签值为201，然后下一跳是 B，也就是发送给 B。那么 B 收到这个标签包，发现标签头里的 label 字段为 201，于是查看自己的LFIB，发现 201 标签的 outgoing label 是 301 并且下一跳是 C，于是它将 201 标签替换成 301，然后交给 C。到了 C 它也去查 FIB 表，发现 301 标签对应的outgoing label 是 PoP 并且下一跳是 D，于是它将标签头弹出，这就露出了原始的 IPv4 数据，C 将这个数据包交给 D。</p>
<blockquote>
<p>本篇博客大部分内容节选自红茶三杯 CCIE学习文档之MPLS，目前只摘取的部分内容。感兴趣的话可以去<a href="http://ccietea.com/%E6%9F%A5%E7%9C%8B%E3%80%82">http://ccietea.com/查看。</a></p>
</blockquote>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>MPLS</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机FEX</title>
    <url>/2021/03/08/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAFEX/</url>
    <content><![CDATA[<p>&emsp;&emsp;FEX（Fabric Extenders），Cisco Nexus 2000 可以通过FEX技术成为N5K和N7K的一个远程线卡，被Cisco Nexus交换机管理和配置。</p>
<a id="more"></a>

<h2 id="1-FEX技术介绍"><a href="#1-FEX技术介绍" class="headerlink" title="1 FEX技术介绍"></a>1 FEX技术介绍</h2><h3 id="1-1-Cisco-Nexus交换机使用Fabric-Extenders"><a href="#1-1-Cisco-Nexus交换机使用Fabric-Extenders" class="headerlink" title="1.1 Cisco Nexus交换机使用Fabric Extenders"></a>1.1 Cisco Nexus交换机使用Fabric Extenders</h3><ul>
<li>Cisco Nexus 2000 FEX作为N5K和N7K的一个远程线卡<ul>
<li>被Cisco Nexus交换机管理和配置</li>
</ul>
</li>
<li>Cisco Nexus交换机和Cisco Nexus 2000 FEX合并在一起实现了最好的Top-of-rack的接线和end-of-row的管理。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/10/6GALjK.png" alt="image-20210308094611223"></p>
<h3 id="1-2-FEX术语"><a href="#1-2-FEX术语" class="headerlink" title="1.2 FEX术语"></a>1.2 FEX术语</h3><p><img src="https://s3.ax1x.com/2021/03/10/6GAXnO.png" alt="image-20210308094638383"></p>
<h3 id="1-3-NIV（Network-Interface-Virtualization）架构"><a href="#1-3-NIV（Network-Interface-Virtualization）架构" class="headerlink" title="1.3 NIV（Network Interface Virtualization）架构"></a>1.3 NIV（Network Interface Virtualization）架构</h3><ul>
<li>网络接口虚拟化（NIV）架构扩展了交换机的接口到下游设备</li>
<li>NIV关联逻辑接口（LIF）到一个虚拟接口（VIF）</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/10/6GEKCn.png" alt="image-20210308095045210"></p>
<h3 id="1-4-VN-Tag端口扩展"><a href="#1-4-VN-Tag端口扩展" class="headerlink" title="1.4 VN-Tag端口扩展"></a>1.4 VN-Tag端口扩展</h3><ul>
<li>Nexus 2000 Fabric Extender作为一个远程线卡使用，不支持本地交换。</li>
<li>所有的转发任务都在N5K或者N7K上被执行。</li>
<li>VNTag是一个网络接口虚拟化（NIV）技术，扩展N5K/N7K的端口（逻辑接口LIF）到下游N2K的虚拟接口（VIF），就和一个普通的主机接口（Host Interface=HIF）一样。<ul>
<li>VNTag被添加到N5K/N7K和Fabric Extender之间的包上。</li>
<li>当这个包被发送到主机时，VN-Tag被剥除。</li>
</ul>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/10/6GEQg0.png" alt="image-20210308095235357"></p>
<ul>
<li>Nexus 5K/7K在Fabric Ports上执行入方向处理。</li>
<li>UPC提取VNTag，这个VN-Tag表示一个逻辑接口（LIF）关联到一个N2K上的一个物理HIF。</li>
<li>入方向的策略基于在N5K/N7K物理端口和逻辑接口上的策略。<ul>
<li>访问控制和发送策略，根据帧内的字段和虚拟接口策略。</li>
<li>物理层的属性（例如：MACSec）根据N5K/N7K上的设置。</li>
</ul>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/10/6GElvV.png" alt="image-20210308095401782"></p>
<h3 id="1-5-包发送过程简介"><a href="#1-5-包发送过程简介" class="headerlink" title="1.5 包发送过程简介"></a>1.5 包发送过程简介</h3><p><img src="https://s3.ax1x.com/2021/03/10/6GE3uT.png" alt="image-20210308095459210"></p>
<h3 id="1-6-Cisco-N7K-FEX与VDC"><a href="#1-6-Cisco-N7K-FEX与VDC" class="headerlink" title="1.6 Cisco N7K FEX与VDC"></a>1.6 Cisco N7K FEX与VDC</h3><ul>
<li>所有的FEX Fabric Link必须在一个相同的VDC</li>
<li>所有的FEX主机端口属于相同的VDC</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/10/6GEGbF.png" alt="image-20210308095532633"></p>
<h3 id="1-7-连接模式"><a href="#1-7-连接模式" class="headerlink" title="1.7 连接模式"></a>1.7 连接模式</h3><h4 id="1-7-1-Static-Pinning"><a href="#1-7-1-Static-Pinning" class="headerlink" title="1.7.1 Static Pinning"></a>1.7.1 Static Pinning</h4><p><img src="https://s3.ax1x.com/2021/03/10/6GEYE4.png" alt="image-20210308095650529"></p>
<ul>
<li>当启动Fabric Extender时，它的主机接口在可用的结构接口之间平均分布。</li>
<li>如果某个fabric接口出现故障，则其所有相关的主机接口都将失效，直到fabric接口恢复。</li>
<li>必须使用pinning max-links命令创建固定的fabric接口连接数，以便父级交换机可以确定主机接口的分布。主机接口数除以最大链接数和相应地分配。默认值为max-links 1。</li>
<li>更改max-links的值会造成中断；所有主机Fabric Extender上的接口被关闭和备份，当父开关重新分配其static pinning。</li>
</ul>
<h4 id="1-7-2-EtherChannel"><a href="#1-7-2-EtherChannel" class="headerlink" title="1.7.2 EtherChannel"></a>1.7.2 EtherChannel</h4><p><img src="https://s3.ax1x.com/2021/03/10/6GEtUJ.png" alt="image-20210308095655503"></p>
<ul>
<li>将Fabric Extender配置为使用EtherChannel时连接到其父交换机的fabric接口，交换机使用负载均衡的方式连接主机的流量，并使用以下负载均衡的标准来创建链接：<ul>
<li>对于第2层帧，交换机使用源和目标MAC地址。</li>
<li>对于第3层帧，交换机使用源和目标MAC地址以及源和目标IP地址。</li>
</ul>
</li>
</ul>
<h3 id="1-8-端口命令的规则"><a href="#1-8-端口命令的规则" class="headerlink" title="1.8 端口命令的规则"></a>1.8 端口命令的规则</h3><p>interface ethernet chassis/slot/port (e101/1/25)</p>
<ul>
<li>chassis由管理员配置。Fabric Extender必须通过单个交换机直接连接到其父交换机via individual<br>fabric interfaces或EtherChannel fabric interface。您可以在交换机上的物理以太网接口或以太网通道上配置chassis ID，以标识通过这些接口发现的Fabric Extender。<ul>
<li>chassis ID的范围从100到199。</li>
<li>注意：只有访问上的主机接口时才需要chassis ID Fabric Extender。值小于100表示父交换机上的插槽。</li>
</ul>
</li>
<li>slot标识结构扩展器上的插槽号。</li>
<li>port标识特定插槽上的端口号和机箱ID。</li>
</ul>
<h3 id="1-9-Host-Interface问题"><a href="#1-9-Host-Interface问题" class="headerlink" title="1.9 Host Interface问题"></a>1.9 Host Interface问题</h3><ul>
<li>Host Interface不能连接交换机，这种接口设计来只用于提供主机和服务器的连接。</li>
<li>默认在所有的Host Interface上激活了BPDU Guard，如果连接交换机到Host Interface，一旦从这个接口收到BPDU，这个接口将被置为“error-disable”状态。</li>
<li>不能在Fabric Extender的Host Interface上禁用BPDU Guard功能。</li>
</ul>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>FEX</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机FabricPath</title>
    <url>/2021/03/15/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAFabricPath/</url>
    <content><![CDATA[<p>&emsp;&emsp;FabricPath是Cisco Nexus交换机上的一项技术特性，这个技术做到了以下几点：实现两点间多条路径同时转发流量EMCP(Equal Cost Multi Pathing)；类似IP网络的平滑扩展；快速收敛；防止广播风暴；保持原有二层网络配置的简洁性。FabricPath摆脱传统二层“交换”的弊端，在二层环境中实现类似三层IP的“路由”行为。</p>
<a id="more"></a>

<h2 id="1-FabricPath简介"><a href="#1-FabricPath简介" class="headerlink" title="1 FabricPath简介"></a>1 FabricPath简介</h2><h3 id="1-1-智能二层网络的革命"><a href="#1-1-智能二层网络的革命" class="headerlink" title="1.1 智能二层网络的革命"></a>1.1 智能二层网络的革命</h3><p><img src="https://s3.ax1x.com/2021/03/16/6sOC8J.png" alt="image-20210315164725657"></p>
<h3 id="1-2-当前数据中心设计"><a href="#1-2-当前数据中心设计" class="headerlink" title="1.2 当前数据中心设计"></a>1.2 当前数据中心设计</h3><p><img src="https://s3.ax1x.com/2021/03/16/6sOP29.png" alt="image-20210315164605993"></p>
<h3 id="1-3-经典二层网络的限制"><a href="#1-3-经典二层网络的限制" class="headerlink" title="1.3 经典二层网络的限制"></a>1.3 经典二层网络的限制</h3><ol>
<li>本地的STP问题将会影响整个网络，排错难度增大。</li>
<li>STP技术提供了限制的带宽（不能实现负载均衡）。</li>
<li>STP的收敛是混乱的。</li>
<li>树状接口引入了不优化的路径。</li>
<li>MAC地址表没有很好的扩展性。</li>
<li>泛洪流量将会影响整个网络。</li>
</ol>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOivR.png" alt="image-20210315165236704"></p>
<h3 id="1-4-Cisco-FabricPath的目标"><a href="#1-4-Cisco-FabricPath的目标" class="headerlink" title="1.4 Cisco FabricPath的目标"></a>1.4 Cisco FabricPath的目标</h3><p>&emsp;&emsp;FabricPath技术融合了路由与交换的优势，实现一个端到端的大二层网络。</p>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOkK1.png" alt="image-20210315165321194"></p>
<h3 id="1-5-FabricPath-A-Ethernet-Fabric"><a href="#1-5-FabricPath-A-Ethernet-Fabric" class="headerlink" title="1.5 FabricPath : A Ethernet Fabric"></a>1.5 FabricPath : A Ethernet Fabric</h3><ol>
<li><p>使用任意的拓扑，连接一组的交换机</p>
</li>
<li><p>使用一个简单的CLI命令，汇聚交换机到一个Fabric</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N7K(config)<span class="comment">#interface ethernet 1/1</span></span><br><span class="line">N7K(config-if)<span class="comment">#switchport mode fabricpath</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>没有STP技术，是一个基于三层技术的开放协议，提供了Fabric范围的智能，并且把所有的组件捆绑到一起。</p>
</li>
</ol>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOADx.png" alt="image-20210315165621259"></p>
<h3 id="1-6-Fabric的定义"><a href="#1-6-Fabric的定义" class="headerlink" title="1. 6 Fabric的定义"></a>1. 6 Fabric的定义</h3><p>&emsp;&emsp;从外部看，一个Fabric就像一个交换机。从内部看，一个协议提供了整个Fabric范围的智能，并且把所有组件绑定在一起。这个协议提供了即插即用的特性：</p>
<ul>
<li>优化的任意到任意的低延时连接</li>
<li>高带宽，高弹性</li>
<li>开放的管理和排错功能</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOeUO.png" alt="image-20210315164521167"></p>
<h4 id="1-6-1-优化的低延时交换"><a href="#1-6-1-优化的低延时交换" class="headerlink" title="1.6.1 优化的低延时交换"></a>1.6.1 优化的低延时交换</h4><p>&emsp;&emsp;Shortest Path Any-to-Any（任意到任意最短路径）</p>
<ul>
<li>在包进入Fabric的边界设备执行简单的地址查询。</li>
<li>流量使用可用的最短路劲来转发。</li>
<li>可靠的二层和三层任意到任意的连接（就像在一个交换机内部一样，没有STP技术）</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOJVf.png" alt="image-20210315165750821"></p>
<h4 id="1-6-2-高带宽，高弹性"><a href="#1-6-2-高带宽，高弹性" class="headerlink" title="1.6.2 高带宽，高弹性"></a>1.6.2 高带宽，高弹性</h4><p>&emsp;&emsp;Equal Cost Multi-pathing（等价多路径）</p>
<ul>
<li>多路径（Multi-pathing），在两个设备间，最多256个活动路径。</li>
<li>如果出现故障，流量将会在剩余的链路中被分布，提供快速的收敛。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOtIS.png" alt="image-20210315165845703"></p>
<h4 id="1-6-3-高扩展性"><a href="#1-6-3-高扩展性" class="headerlink" title="1.6.3 高扩展性"></a>1.6.3 高扩展性</h4><p>&emsp;&emsp;Conversational Learning（会话的MAC地址学习）</p>
<ul>
<li>每端口的MAC地址表，仅仅只学习那些可以通过Fabric抵达的对等体的MAC地址。</li>
<li>一个虚拟的无限数量的主机，能够被加入这个Fabric。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOd2j.png" alt="image-20210315165858185"></p>
<h3 id="1-7-二层的整合"><a href="#1-7-二层的整合" class="headerlink" title="1.7 二层的整合"></a>1.7 二层的整合</h3><p>&emsp;&emsp;vPC+</p>
<ul>
<li>允许无限制的延伸VLANs，不用担心出现环路。</li>
<li>设备可以使用IEEE标准的Port Channel技术，通过Active/Active链路接入到Fabric，不需要使用STP技术。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sORG4.png" alt="image-20210315170429015"></p>
<h3 id="1-8-边界设备的整合"><a href="#1-8-边界设备的整合" class="headerlink" title="1.8 边界设备的整合"></a>1.8 边界设备的整合</h3><p>&emsp;&emsp;主机可以利用多个三层默认网关</p>
<ul>
<li>主机只看到一个默认网关。</li>
<li>Fabric提供了多个透明的同时Active的默认网关。</li>
<li>允许从Fabric内部到外部三层网络的的多路径。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sO4MR.png" alt="image-20210315170527144"></p>
<h3 id="1-9-三层的整合"><a href="#1-9-三层的整合" class="headerlink" title="1.9 三层的整合"></a>1.9 三层的整合</h3><p>&emsp;&emsp;XL Tables，SVIs Anywhere</p>
<ul>
<li>Fabric提供了无缝的三层整合。</li>
<li>任意数量的路由接口，可以在边界或Fabric内部创建。</li>
<li>连接的三层设备可以使用这些接口连建立连接。</li>
<li>硬件有能力来处理这些百万级的路由。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6sOIqx.png" alt="image-20210315170641079"></p>
<h2 id="2-FabricPath理论介绍"><a href="#2-FabricPath理论介绍" class="headerlink" title="2 FabricPath理论介绍"></a>2 FabricPath理论介绍</h2><h3 id="2-1-新的控制层面"><a href="#2-1-新的控制层面" class="headerlink" title="2.1 新的控制层面"></a>2.1 新的控制层面</h3><p>&emsp;&emsp;即插即用的由IS-IS管理的发送拓扑：</p>
<ul>
<li>IS-IS自动为所有的FabricPath交换机指派地址。</li>
<li>计算最短路径。</li>
<li>在任意的FabricPath交换机之间支持等价多路径。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6y9t3T.png" alt="image-20210315171114341"></p>
<h3 id="2-2-新的数据层面"><a href="#2-2-新的数据层面" class="headerlink" title="2.2 新的数据层面"></a>2.2 新的数据层面</h3><ul>
<li>在边界设备上维护MAC地址与Switch-ID之间的关联。</li>
<li>流量被封装穿越整个Fabric</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6y9rU1.png" alt="image-20210315171137880"></p>
<h3 id="2-2-FabricPath术语"><a href="#2-2-FabricPath术语" class="headerlink" title="2.2 FabricPath术语"></a>2.2 FabricPath术语</h3><p><img src="https://s3.ax1x.com/2021/03/16/6y9c8K.png" alt="image-20210315171241755"></p>
<h4 id="2-2-1-FP-Core-Port"><a href="#2-2-1-FP-Core-Port" class="headerlink" title="2.2.1 FP Core Port"></a>2.2.1 FP Core Port</h4><ul>
<li>接口被连接到其它FabricPath设备</li>
<li>发送和接收有FabricPath头部的流量</li>
<li>不运行STP</li>
<li>不执行MAC地址学习</li>
<li>通过二层的IS-IS邻居，交换拓扑信息</li>
<li>基于Switch-ID表转发数据</li>
</ul>
<h4 id="2-2-2-CE-Edge-Port"><a href="#2-2-2-CE-Edge-Port" class="headerlink" title="2.2.2 CE Edge Port"></a>2.2.2 CE Edge Port</h4><ul>
<li>接口被连接到传统网络设备</li>
<li>发送和接收标准802.3以太网格式的帧</li>
<li>参与到一个STP域</li>
<li>基于MAC地址表转发流量</li>
</ul>
<h3 id="2-3-Unknown-Unicast"><a href="#2-3-Unknown-Unicast" class="headerlink" title="2.3 Unknown Unicast"></a>2.3 Unknown Unicast</h3><p><img src="https://s3.ax1x.com/2021/03/16/6y92vD.png" alt="image-20210315172739563"></p>
<h3 id="2-4-known-Unicast，Conversation-Learning"><a href="#2-4-known-Unicast，Conversation-Learning" class="headerlink" title="2.4 known Unicast，Conversation Learning"></a>2.4 known Unicast，Conversation Learning</h3><p><img src="https://s3.ax1x.com/2021/03/16/6y9H8f.png" alt="image-20210315172802054"></p>
<h3 id="2-5-vPC"><a href="#2-5-vPC" class="headerlink" title="2.5 vPC+"></a>2.5 vPC+</h3><h4 id="2-5-1-vPC-简介"><a href="#2-5-1-vPC-简介" class="headerlink" title="2.5.1 vPC+简介"></a>2.5.1 vPC+简介</h4><ul>
<li>允许边界端口到FabricPath域的“Dual-Homed”连接，实现Active/Active的转发。</li>
<li>连接经典以太网交换机，三层路由器，负载均衡器，Dual-homed服务器，等等。</li>
<li>仅仅只需要这些设备支持port-channel。</li>
<li>可以提供Active/Active的HSRP。</li>
<li>配置与标准的vPC几乎完全一样。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6y9XrQ.png" alt="image-20210315172908170"></p>
<h4 id="2-5-2-vPC-详细介绍"><a href="#2-5-2-vPC-详细介绍" class="headerlink" title="2.5.2 vPC+详细介绍"></a>2.5.2 vPC+详细介绍</h4><ul>
<li>vPC+对等体交换机，共享一个虚拟的FabricPath Switch-ID。</li>
<li>在vPC+ Port-Channels身后的MAC地址，就好像被连接到这个虚拟的交换机上一样，而不是连接到这两个vPC对等体交换机上。</li>
<li>允许在FabricPath域中，负载均衡的发送流量到这个vPC+虚拟交换机。</li>
<li>vPC+技术需要配置F模块并且激活FabricPath技术的VDC。</li>
<li>Peer-Link和所有的vPC+链路必须使用F端口。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6y9xVs.png" alt="image-20210315172946990"></p>
<h4 id="2-5-3-vPC-vs-vPC"><a href="#2-5-3-vPC-vs-vPC" class="headerlink" title="2.5.3 vPC vs. vPC+"></a>2.5.3 vPC vs. vPC+</h4><ul>
<li>一个特定的VDC，要么是一个vPC域的一部分，要么是一个vPC+域的一部分，不能同时属于两个域。</li>
<li>vPC+只能工作在，配置F模块，并且激活FabricPath特性的VDC中。</li>
<li>vPC与vPC+之间的转换，会造成流量的中断。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yC9P0.png" alt="image-20210315173022058"></p>
<h3 id="2-6-TRILL技术"><a href="#2-6-TRILL技术" class="headerlink" title="2.6 TRILL技术"></a>2.6 TRILL技术</h3><p>&emsp;&emsp;TRILL（Transparent Interconnection of Lots of Links）技术简介：</p>
<ul>
<li>IETF标准的二层多路径技术。</li>
<li>被Cisco在内的多个厂商所发起。</li>
<li>TRILL技术已经从一个草案成为了一个被提议的标准。</li>
<li>被提议的标准状态，意味着各个厂商可以开始开发与TRILL兼容的软件运用。</li>
<li>Cisco支持FabricPath的硬件也同时支持TRILL技术。</li>
</ul>
<h3 id="2-7-FabricPath-vs-TRILL"><a href="#2-7-FabricPath-vs-TRILL" class="headerlink" title="2.7 FabricPath vs. TRILL"></a>2.7 FabricPath vs. TRILL</h3><ul>
<li>FabricPath可以通过软件的升级，支持TRILL模式（硬件已经拥有TRILL能力）。</li>
<li>Cisco将会推送FabricPath的特性到TRILL。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yCCGV.png" alt="image-20210315173711478"></p>
<h3 id="2-8-FabricPath-vs-TRILL-封装"><a href="#2-8-FabricPath-vs-TRILL-封装" class="headerlink" title="2.8 FabricPath vs. TRILL:封装"></a>2.8 FabricPath vs. TRILL:封装</h3><ul>
<li>TRILL设备能够和在一个共享网络中的多个对等体进行通讯。</li>
<li>FabricPath使用了一个更加紧凑的帧格式（简化硬件，低延时），只能使用点对点链路。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yCAr4.png" alt="image-20210316161037508"></p>
<h3 id="2-9-FabricPath-vs-TRILL-多路径"><a href="#2-9-FabricPath-vs-TRILL-多路径" class="headerlink" title="2.9 FabricPath vs. TRILL:多路径"></a>2.9 FabricPath vs. TRILL:多路径</h3><ul>
<li>端到端的多路径（二层边界，Fabric，三层边界）提供弹性和快速的收敛。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yCmI1.png" alt="image-20210316161119567"></p>
<h3 id="2-10-FabricPath-vs-TRILL-多拓扑"><a href="#2-10-FabricPath-vs-TRILL-多拓扑" class="headerlink" title="2.10 FabricPath vs. TRILL:多拓扑"></a>2.10 FabricPath vs. TRILL:多拓扑</h3><ul>
<li>Topology（拓扑）：在一个Fabric中的一组链路。</li>
<li>默认所有的链路都属于Topology 0。</li>
<li>其它的拓扑可以被创建，并且把一部分链路关联到这些拓扑中去。</li>
<li>一个链路可以同时属于一系列拓扑。</li>
<li>一个VLAN只能映射到一个唯一的Topology</li>
<li>拓扑用于VLAN修剪，安全，流量工程，等等。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yCYdA.png" alt="image-20210316161206963"></p>
<h3 id="2-11-FabricPath-vs-TRILL-简化STP的交互"><a href="#2-11-FabricPath-vs-TRILL-简化STP的交互" class="headerlink" title="2.11 FabricPath vs. TRILL:简化STP的交互"></a>2.11 FabricPath vs. TRILL:简化STP的交互</h3><ul>
<li>Fabric看上去就像一个单一的交换机。</li>
<li>发送相同的STP信息到所有的边界端口。</li>
<li>希望成为STP的Root（边界端口将会被阻止，如果收到更加优化的信息）</li>
<li>没有BPDU信息在Fabric中被发送。</li>
<li>一个可选的机制，如果需要允许传播TCN。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/16/6yCtII.png" alt="image-20210316162730054"></p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>FabricPath</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机FabricPath配置</title>
    <url>/2021/03/16/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAFabricPath%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍在Nexus交换机上FabricPath的配步骤。</p>
<a id="more"></a>

<p><img src="https://s3.ax1x.com/2021/03/17/6ciGCR.png" alt="image-20210317131636782"></p>
<h2 id="1-配置N5K的FabricPath"><a href="#1-配置N5K的FabricPath" class="headerlink" title="1 配置N5K的FabricPath"></a>1 配置N5K的FabricPath</h2><h3 id="1-1-在N5K-1-N5K-2上启用特性集"><a href="#1-1-在N5K-1-N5K-2上启用特性集" class="headerlink" title="1.1 在N5K-1/N5K-2上启用特性集"></a>1.1 在N5K-1/N5K-2上启用特性集</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#N5K-1安装FabricPath特性集，并且启用FabricPath特性集</span></span><br><span class="line">N5K-1(config)<span class="comment">#install feature-set fabricpath </span></span><br><span class="line">N5K-1(config)<span class="comment">#feature-set fabricpath </span></span><br><span class="line"><span class="comment">#N5K-1手动配置Switch-ID </span></span><br><span class="line">N5K-1(config)<span class="comment">#fabricpath switch-id 51 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#N5K-2安装FabricPath特性集，并且启用FabricPath特性集</span></span><br><span class="line">N5K-2(config)<span class="comment">#install feature-set fabricpath </span></span><br><span class="line">N5K-2(config)<span class="comment">#feature-set fabricpath </span></span><br><span class="line"><span class="comment">#N5K-2手动配置Switch-ID </span></span><br><span class="line">N5K-2(config)<span class="comment">#fabricpath switch-id 52</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-在N5K-1-N5K-2上配置VLAN的FP模式"><a href="#1-2-在N5K-1-N5K-2上配置VLAN的FP模式" class="headerlink" title="1.2 在N5K-1/N5K-2上配置VLAN的FP模式"></a>1.2 在N5K-1/N5K-2上配置VLAN的FP模式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#N5K-1配置VLAN10为FabricPath模式</span></span><br><span class="line">N5K-1(config)<span class="comment">#vlan 10 </span></span><br><span class="line">N5K-1(config-vlan)<span class="comment">#mode fabricpath </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#N5K-2配置VLAN10为FabricPath模式</span></span><br><span class="line">N5K-2(config)<span class="comment">#vlan 10 </span></span><br><span class="line">N5K-2(config-vlan)<span class="comment">#mode fabricpath</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-在N5K-1接口上启用FabricPath"><a href="#1-3-在N5K-1接口上启用FabricPath" class="headerlink" title="1.3 在N5K-1接口上启用FabricPath"></a>1.3 在N5K-1接口上启用FabricPath</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-1(config)<span class="comment">#feature lacp</span></span><br><span class="line">N5K-1(config)<span class="comment">#interface ethernet 1/10-11</span></span><br><span class="line">N5K-1(config-if-range)<span class="comment">#channel-group 6 mode active</span></span><br><span class="line">N5K-1(config-if-range)<span class="comment">#exit</span></span><br><span class="line">N5K-1(config)<span class="comment">#interface port-channel 6</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#switchport mode fabricpath</span></span><br><span class="line"></span><br><span class="line">N5K-1(config)<span class="comment">#interface ethernet 1/5</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#shutdown</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-在N5K-2接口上启用FabricPath"><a href="#1-4-在N5K-2接口上启用FabricPath" class="headerlink" title="1.4 在N5K-2接口上启用FabricPath"></a>1.4 在N5K-2接口上启用FabricPath</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-2(config)<span class="comment">#feature lacp</span></span><br><span class="line">N5K-2(config)<span class="comment">#interface ethernet 1/10-11</span></span><br><span class="line">N5K-2(config-if-range)<span class="comment">#channel-group 6 mode active</span></span><br><span class="line">N5K-2(config-if-range)<span class="comment">#exit</span></span><br><span class="line">N5K-2(config)<span class="comment">#interface port-channel 6</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#switchport mode fabricpath</span></span><br><span class="line"></span><br><span class="line">N5K-2(config)<span class="comment">#interface ethernet 1/5</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#shutdown</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="1-5-查看FabricPath状态"><a href="#1-5-查看FabricPath状态" class="headerlink" title="1.5 查看FabricPath状态"></a>1.5 查看FabricPath状态</h3><p><img src="https://s3.ax1x.com/2021/03/17/6ciUKK.png" alt="image-20210317132832656"></p>
<p><img src="https://s3.ax1x.com/2021/03/17/6cidbD.png" alt="image-20210317132838655"></p>
<h3 id="1-6-测试会话MAC地址学习"><a href="#1-6-测试会话MAC地址学习" class="headerlink" title="1.6 测试会话MAC地址学习"></a>1.6 测试会话MAC地址学习</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1 MAC 地址与IP 地址配置:</span><br><span class="line">interface FastEthernet0/0</span><br><span class="line">mac-address 0001.0001.0001</span><br><span class="line">ip address 10.1.1.1 255.255.255.0</span><br><span class="line">no keepalive</span><br><span class="line">no cdp <span class="built_in">enable</span></span><br><span class="line">R2 MAC 地址与IP 地址配置:</span><br><span class="line">interface FastEthernet0/0</span><br><span class="line">mac-address 0002.0002.0002</span><br><span class="line">ip address 10.1.1.2 255.255.255.0</span><br><span class="line">no keepalive</span><br><span class="line">no cdp <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line">R1 R2 都开启“Debug ARP ”</span><br><span class="line"></span><br><span class="line">测试之前清除VLAN10 的MAC 地址表:</span><br><span class="line">N5K-1<span class="comment">#clear mac address-table dynamic vlan 10</span></span><br><span class="line">N5K-2<span class="comment">#clear mac address-table dynamic vlan 10</span></span><br><span class="line"></span><br><span class="line">Shut/no Shut R1 Fa0/0 进行测试:</span><br><span class="line"></span><br><span class="line">R1发送免费ARP的Debug</span><br><span class="line">*Mar 14 02:40:30.745: IP ARP: sent rep src 10.1.1.1 0001.0001.0001,</span><br><span class="line">dst 10.1.1.1 ffff.ffff.ffff FastEthernet0/0</span><br><span class="line"></span><br><span class="line">R2接收到R1的免费ARP的Debug</span><br><span class="line">*Mar 14 02:40:16.581: IP ARP: rcvd rep src 10.1.1.1 0001.0001.0001,</span><br><span class="line">dst 10.1.1.1 FastEthernet0/0</span><br></pre></td></tr></table></figure>

<p>N5K-1 学习到R1 的MAC 地址：</p>
<p><img src="https://s3.ax1x.com/2021/03/17/6ci0Ve.png" alt="image-20210317154900110"></p>
<p>N5K-2 并不会学习R1 的MAC 地址：</p>
<p><img src="https://s3.ax1x.com/2021/03/17/6ciWqS.png" alt="image-20210317154905092"></p>
<h2 id="2-配置N7K的FabricPath"><a href="#2-配置N7K的FabricPath" class="headerlink" title="2 配置N7K的FabricPath"></a>2 配置N7K的FabricPath</h2><h3 id="2-1-在N7K-3启用特性集"><a href="#2-1-在N7K-3启用特性集" class="headerlink" title="2.1 在N7K-3启用特性集"></a>2.1 在N7K-3启用特性集</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在Default VDC N7K-1 上安装FabricPath 特性集</span></span><br><span class="line">DC1-N7K-1(config)<span class="comment">#install feature-set fabricpath</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在N7K-3 上启用FabricPath 特性集</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#feature-set fabricpath</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#N7K-3 手动配置Switch-ID 与Root-Priority ，默认64</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#fabricpath switch-id 73</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#fabricpath domain default</span></span><br><span class="line">DC1-N7K-3(config-fabricpath-isis)<span class="comment">#root-priority 100</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-在N7K-4启用特性集"><a href="#2-2-在N7K-4启用特性集" class="headerlink" title="2.2 在N7K-4启用特性集"></a>2.2 在N7K-4启用特性集</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#N7K-4上启用FabricPath 特性集</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#feature-set fabricpath</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#N7K-4 手动配置Switch-ID 与Root-Priority ，默认64</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#fabricpath switch-id 74</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#fabricpath domain default</span></span><br><span class="line">DC1-N7K-4(config-fabricpath-isis)<span class="comment">#root-priority 90</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-在N7K-3-N7K-4上配置VLAN的FP模式"><a href="#2-3-在N7K-3-N7K-4上配置VLAN的FP模式" class="headerlink" title="2.3 在N7K-3/N7K-4上配置VLAN的FP模式"></a>2.3 在N7K-3/N7K-4上配置VLAN的FP模式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N7K-3配置VLAN10为FabricPath 模式</span><br><span class="line">DC1-N7K-3(config)<span class="comment">#vlan 10</span></span><br><span class="line">DC1-N7K-3(config-vlan)<span class="comment">#mode fabricpath</span></span><br><span class="line"></span><br><span class="line">N7K-4配置VLAN10为FabricPath 模式</span><br><span class="line">DC1-N7K-4(config)<span class="comment">#vlan 10</span></span><br><span class="line">DC1-N7K-4(config-vlan)<span class="comment">#mode fabricpath</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-在N7K-3接口上启用FabricPath"><a href="#2-4-在N7K-3接口上启用FabricPath" class="headerlink" title="2.4 在N7K-3接口上启用FabricPath"></a>2.4 在N7K-3接口上启用FabricPath</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-3(config)<span class="comment">#feature lacp</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e3/19-20</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#channel-group 1 mode active</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e3/21-22</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#channel-group 2 mode active</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e3/23-24</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#channel-group 5 mode active</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface po1 , po2 , po5</span></span><br><span class="line">DC1-N7K-3(config-if-range)<span class="comment">#switchport mode fabricpath</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-在N7K-4接口上启用FabricPath"><a href="#2-5-在N7K-4接口上启用FabricPath" class="headerlink" title="2.5 在N7K-4接口上启用FabricPath"></a>2.5 在N7K-4接口上启用FabricPath</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-4(config)<span class="comment">#feature lacp</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface e3/25-26</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#channel-group 1 mode active</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface e3/29-30</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#channel-group 3 mode active</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface e3/31-32</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#channel-group 4 mode active</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface po1 , po3 , po4</span></span><br><span class="line">DC1-N7K-4(config-if-range)<span class="comment">#switchport mode fabricpath</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-在N5K-1-N5K-2接口上启用FabricPath"><a href="#2-6-在N5K-1-N5K-2接口上启用FabricPath" class="headerlink" title="2.6 在N5K-1/N5K-2接口上启用FabricPath"></a>2.6 在N5K-1/N5K-2接口上启用FabricPath</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-1(config)<span class="comment">#interface e1/21-22</span></span><br><span class="line">N5K-1(config-if-range)<span class="comment">#channel-group 2 mode active</span></span><br><span class="line">N5K-1(config)<span class="comment">#interface e1/31-32</span></span><br><span class="line">N5K-1(config-if-range)<span class="comment"># channel-group 4 mode active</span></span><br><span class="line">N5K-1(config)<span class="comment">#interface po2 , po4</span></span><br><span class="line">N5K-1(config-if-range)<span class="comment">#switchport mode fabricpath</span></span><br><span class="line"></span><br><span class="line">N5K-2(config)<span class="comment">#interface e1/23-24</span></span><br><span class="line">N5K-2(config-if-range)<span class="comment">#channel-group 5 mode active</span></span><br><span class="line">N5K-2(config)<span class="comment">#interface e1/29-30</span></span><br><span class="line">N5K-2(config-if-range)<span class="comment"># channel-group 3 mode active</span></span><br><span class="line">N5K-2(config)<span class="comment">#interface po3 , po5</span></span><br><span class="line">N5K-2(config-if-range)<span class="comment">#switchport mode fabricpath</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-查看FabricPath邻居关系"><a href="#2-7-查看FabricPath邻居关系" class="headerlink" title="2.7 查看FabricPath邻居关系"></a>2.7 查看FabricPath邻居关系</h3><p><img src="https://s3.ax1x.com/2021/03/17/6ciqMV.png" alt="image-20210317155826746"></p>
<h3 id="2-8-查看FabricPath-Switch-id"><a href="#2-8-查看FabricPath-Switch-id" class="headerlink" title="2.8 查看FabricPath Switch-id"></a>2.8 查看FabricPath Switch-id</h3><p><img src="https://s3.ax1x.com/2021/03/17/6ciLrT.png" alt="image-20210317155839209"></p>
<h3 id="2-9-查看FabricPath路由"><a href="#2-9-查看FabricPath路由" class="headerlink" title="2.9 查看FabricPath路由"></a>2.9 查看FabricPath路由</h3><p><img src="https://s3.ax1x.com/2021/03/17/6civa4.png" alt="image-20210317155851308"></p>
<h3 id="2-10-查看FabricPath多目的树根"><a href="#2-10-查看FabricPath多目的树根" class="headerlink" title="2.10 查看FabricPath多目的树根"></a>2.10 查看FabricPath多目的树根</h3><p><img src="https://s3.ax1x.com/2021/03/17/6cFEZD.png" alt="image-20210317155905811"></p>
<p><img src="https://s3.ax1x.com/2021/03/17/6cFwQ0.png" alt="image-20210317155931448"></p>
<p><img src="https://s3.ax1x.com/2021/03/17/6cFUWn.png" alt="image-20210317155936151"></p>
<h2 id="3-配置N5K的vPC"><a href="#3-配置N5K的vPC" class="headerlink" title="3 配置N5K的vPC+"></a>3 配置N5K的vPC+</h2><h3 id="3-1-N5K-1配置vPC-Domain与Peer-Link"><a href="#3-1-N5K-1配置vPC-Domain与Peer-Link" class="headerlink" title="3.1 N5K-1配置vPC+ Domain与Peer-Link"></a>3.1 N5K-1配置vPC+ Domain与Peer-Link</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-1(config)<span class="comment">#feature vpc</span></span><br><span class="line">N5K-1(config)<span class="comment">#vpc domain 5</span></span><br><span class="line">N5K-1(config-vpc-domain)<span class="comment">#role priority 51</span></span><br><span class="line">N5K-1(config-vpc-domain)<span class="comment">#peer-keepalive destination 137.60.3.52 source 137.60.3.51 vrf management</span></span><br><span class="line">N5K-1(config-vpc-domain)<span class="comment">#fabricpath switch-id 55</span></span><br><span class="line">N5K-1(config)<span class="comment">#interface port-channel 6</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#vpc peer-link</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-N5K-2配置vPC-Domain与Peer-Link"><a href="#3-2-N5K-2配置vPC-Domain与Peer-Link" class="headerlink" title="3.2 N5K-2配置vPC+ Domain与Peer-Link"></a>3.2 N5K-2配置vPC+ Domain与Peer-Link</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-2(config)<span class="comment">#feature vpc</span></span><br><span class="line">N5K-2(config)<span class="comment">#vpc domain 5</span></span><br><span class="line">N5K-2(config-vpc-domain)<span class="comment">#role priority 52</span></span><br><span class="line">N5K-2(config-vpc-domain)<span class="comment">#peer-keepalive destination 137.60.3.51 source 137.60.3.52 vrf management</span></span><br><span class="line">N5K-2(config-vpc-domain)<span class="comment">#fabricpath switch-id 55</span></span><br><span class="line">N5K-2(config)<span class="comment">#interface port-channel 6</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#vpc peer-link</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-在N7K-3上查看Switch-ID"><a href="#3-3-在N7K-3上查看Switch-ID" class="headerlink" title="3.3 在N7K-3上查看Switch-ID"></a>3.3 在N7K-3上查看Switch-ID</h3><p><img src="https://s3.ax1x.com/2021/03/17/6cFBLT.png" alt="image-20210317160131268"></p>
<h3 id="3-4-在N7K-3上查看FabricPath-Route"><a href="#3-4-在N7K-3上查看FabricPath-Route" class="headerlink" title="3.4 在N7K-3上查看FabricPath Route"></a>3.4 在N7K-3上查看FabricPath Route</h3><p><img src="https://s3.ax1x.com/2021/03/17/6cFreU.png" alt="image-20210317160146330"></p>
<h3 id="3-5-N5K-1配置vPC-端口"><a href="#3-5-N5K-1配置vPC-端口" class="headerlink" title="3.5 N5K-1配置vPC+端口"></a>3.5 N5K-1配置vPC+端口</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-1(config)<span class="comment">#interface e1/25</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#shutdown</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#channel-group 100 mode on</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">N5K-1(config)<span class="comment">#interface port-channel 100</span></span><br><span class="line">N5K-1(config-if)<span class="comment">#vpc 100</span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-N5K-2配置vPC-端口"><a href="#3-6-N5K-2配置vPC-端口" class="headerlink" title="3.6 N5K-2配置vPC+端口"></a>3.6 N5K-2配置vPC+端口</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">N5K-2(config)<span class="comment">#interface e1/25</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#shutdown</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#channel-group 100 mode on</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">N5K-2(config)<span class="comment">#interface port-channel 100</span></span><br><span class="line">N5K-2(config-if)<span class="comment">#vpc 100</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-C921配置Port-Channel"><a href="#3-7-C921配置Port-Channel" class="headerlink" title="3.7 C921配置Port-Channel"></a>3.7 C921配置Port-Channel</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C1921(config)<span class="comment">#interface port-channel 1</span></span><br><span class="line">C1921(config-if)<span class="comment">#ip address 10.1.1.200 255.255.255.0</span></span><br><span class="line">C1921(config)<span class="comment">#interface range gi0/0-1</span></span><br><span class="line">C1921(config-if-range)<span class="comment">#channel-group 1</span></span><br><span class="line">C1921(config-if-range)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="3-8-关于FabricPath-STP的调整"><a href="#3-8-关于FabricPath-STP的调整" class="headerlink" title="3.8 关于FabricPath STP的调整"></a>3.8 关于FabricPath STP的调整</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">N5K-1(config)# spanning-tree<span class="built_in"> vlan </span>10 priority 8192</span><br><span class="line">N5K-1(config)# spanning-tree domain 55</span><br><span class="line">N5K-2(config)# spanning-tree<span class="built_in"> vlan </span>10 priority 8192</span><br><span class="line">N5K-2(config)# spanning-tree domain 55</span><br></pre></td></tr></table></figure>

<p><strong>在一个vPC+ 环境应该使用一个Domain ID</strong><br><strong>不同的Gateway Switch 使用不同的Domian ID</strong></p>
<p><img src="https://s3.ax1x.com/2021/03/17/6cFswF.png" alt="image-20210317161528188"></p>
<h2 id="4-配置N7K路由与HSRP"><a href="#4-配置N7K路由与HSRP" class="headerlink" title="4 配置N7K路由与HSRP"></a>4 配置N7K路由与HSRP</h2><h3 id="4-1-R4路由配置"><a href="#4-1-R4路由配置" class="headerlink" title="4.1 R4路由配置"></a>4.1 R4路由配置</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">R4(config)#interface lo 0</span><br><span class="line">R4(config-if)#ip<span class="built_in"> address </span>202.100.1.1 255.255.255.0</span><br><span class="line">R4(config-if)#ip<span class="built_in"> ospf </span>1<span class="built_in"> area </span>0</span><br><span class="line"></span><br><span class="line">R4(config)#interface gigabitEthernet 0/0</span><br><span class="line">R4(config-if)#ip<span class="built_in"> address </span>61.128.1.10 255.255.255.0</span><br><span class="line">R4(config-if)#ip<span class="built_in"> ospf </span>1<span class="built_in"> area </span>0</span><br><span class="line">R4(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line"></span><br><span class="line">R4(config)#interface gigabitEthernet 0/1</span><br><span class="line">R4(config-if)#ip<span class="built_in"> address </span>61.128.2.10 255.255.255.0</span><br><span class="line">R4(config-if)#ip<span class="built_in"> ospf </span>1<span class="built_in"> area </span>0</span><br><span class="line">R4(config-if)#<span class="literal">no</span> shutdown</span><br><span class="line"></span><br><span class="line">R4(config)#router<span class="built_in"> ospf </span>1</span><br></pre></td></tr></table></figure>

<h3 id="4-2-N7K-3路由配置"><a href="#4-2-N7K-3路由配置" class="headerlink" title="4.2 N7K-3路由配置"></a>4.2 N7K-3路由配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-3(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#feature interface-vlan</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#router ospf 1</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#vlan 20</span></span><br><span class="line">DC1-N7K-3(config-vlan)<span class="comment">#name R4-N7K3</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e3/17</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#switchport access vlan 20</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#feature interface-vlan</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#router ospf 1</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#vlan 20</span></span><br><span class="line">DC1-N7K-3(config-vlan)<span class="comment">#name R4-N7K3</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e3/17</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#switchport access vlan 20</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface vlan 20</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip address 61.128.1.3 255.255.255.0</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#vlan 40</span></span><br><span class="line">DC1-N7K-3(config-vlan)<span class="comment">#name N7K3-N7K4</span></span><br><span class="line">DC1-N7K-3(config-vlan)<span class="comment">#mode fabricpath</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface vlan 40</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip address 61.128.4.3/24</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-N7K-4路由配置"><a href="#4-3-N7K-4路由配置" class="headerlink" title="4.3 N7K-4路由配置"></a>4.3 N7K-4路由配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-4(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#feature interface-vlan</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#router ospf 1</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#vlan 30</span></span><br><span class="line">DC1-N7K-4(config-vlan)<span class="comment">#name R4-N7K4</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface e3/27</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#switchport access vlan 30</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface vlan 30</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip address 61.128.2.4/24</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#vlan 40</span></span><br><span class="line">DC1-N7K-4(config-vlan)<span class="comment">#name N7K3-N7K4</span></span><br><span class="line">DC1-N7K-4(config-vlan)<span class="comment">#mode fabricpath</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface vlan 40</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip address 61.128.4.4/24</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-N7K-3-HSRP配置"><a href="#4-4-N7K-3-HSRP配置" class="headerlink" title="4.4 N7K-3 HSRP配置"></a>4.4 N7K-3 HSRP配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-3(config)<span class="comment">#feature hsrp</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip address 10.1.1.254/24</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip ospf passive-interface</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#hsrp 1</span></span><br><span class="line">DC1-N7K-3(config-if-hsrp)<span class="comment">#ip 10.1.1.100</span></span><br><span class="line">DC1-N7K-3(config-if-hsrp)<span class="comment">#preempt</span></span><br><span class="line">DC1-N7K-3(config-if-hsrp)<span class="comment">#priority 105</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-N7K-4-HSRP配置"><a href="#4-5-N7K-4-HSRP配置" class="headerlink" title="4.5 N7K-4 HSRP配置"></a>4.5 N7K-4 HSRP配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-4(config)<span class="comment">#feature hsrp</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip address 10.1.1.253/24</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip ospf passive-interface</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#hsrp 1</span></span><br><span class="line">DC1-N7K-4(config-if-hsrp)<span class="comment">#ip 10.1.1.100</span></span><br><span class="line">DC1-N7K-4(config-if-hsrp)<span class="comment">#preempt</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-C1921测试"><a href="#4-6-C1921测试" class="headerlink" title="4.6 C1921测试"></a>4.6 C1921测试</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C1921(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 10.1.1.100</span></span><br><span class="line">C1921<span class="comment">#ping 202.100.1.1</span></span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 202.100.1.1, timeout is 2 seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/4 ms</span><br></pre></td></tr></table></figure>

<h2 id="5-配置N7K的vPC"><a href="#5-配置N7K的vPC" class="headerlink" title="5 配置N7K的vPC+"></a>5 配置N7K的vPC+</h2><h3 id="5-1-配置Peer-Keepalive链路"><a href="#5-1-配置Peer-Keepalive链路" class="headerlink" title="5.1 配置Peer Keepalive链路"></a>5.1 配置Peer Keepalive链路</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-3(config)<span class="comment">#vrf context P-K-L</span></span><br><span class="line">DC1-N7K-3(config)<span class="comment">#interface e4/18</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#vrf member P-K-L</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#ip address 192.168.1.3/24</span></span><br><span class="line">DC1-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#vrf context P-K-L</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface ethernet 4/26</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#vrf member P-K-L</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#ip address 192.168.1.4/24</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确认链路连通性:</span></span><br><span class="line">DC1-N7K-3<span class="comment">#ping 192.168.1.4 vrf P-K-L</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-配置N7K-3-vPC-Domain"><a href="#5-2-配置N7K-3-vPC-Domain" class="headerlink" title="5.2 配置N7K-3 vPC Domain"></a>5.2 配置N7K-3 vPC Domain</h3><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config)</span></span><span class="number">#fea</span>ture vpc</span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config)</span></span><span class="selector-id">#vpc</span> domain <span class="number">7</span></span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config-vpc-domain)</span></span><span class="selector-id">#role</span> priority <span class="number">73</span></span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config-vpc-domain)</span></span><span class="selector-id">#peer-keepalive</span> destination <span class="number">192.168</span>.<span class="number">1.4</span> source <span class="number">192.168</span>.<span class="number">1.3</span> vrf P-K-L</span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config-vpc-domain)</span></span><span class="selector-id">#dual-active</span> exclude interface-vlan <span class="number">10</span>,<span class="number">20</span></span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config-vpc-domain)</span></span><span class="number">#fab</span>ricpath switch-id <span class="number">77</span></span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config)</span></span><span class="selector-id">#interface</span> port-channel1</span><br><span class="line"><span class="function"><span class="title">DC1-N7K-3</span><span class="params">(config-if)</span></span><span class="selector-id">#vpc</span> peer-link</span><br></pre></td></tr></table></figure>

<h3 id="5-3-配置N7K-4-vPC-Domain"><a href="#5-3-配置N7K-4-vPC-Domain" class="headerlink" title="5.3 配置N7K-4 vPC Domain"></a>5.3 配置N7K-4 vPC Domain</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DC1-N7K-4(config)<span class="comment">#feature vpc</span></span><br><span class="line"></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#vpc domain 7</span></span><br><span class="line">DC1-N7K-4(config-vpc-domain)<span class="comment">#role priority 74</span></span><br><span class="line">DC1-N7K-4(config-vpc-domain)<span class="comment">#peer-keepalive destination 192.168.1.3 source 192.168.1.4 vrf P-K-L</span></span><br><span class="line">DC1-N7K-4(config-vpc-domain)<span class="comment">#dual-active exclude interface-vlan 10,30</span></span><br><span class="line">DC1-N7K-4(config-vpc-domain)<span class="comment">#fabricpath switch-id 77</span></span><br><span class="line">DC1-N7K-4(config)<span class="comment">#interface port-channel1</span></span><br><span class="line">DC1-N7K-4(config-if)<span class="comment">#vpc peer-link</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Nexus实验</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>FabricPath</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机VDC</title>
    <url>/2021/03/05/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAvDC/</url>
    <content><![CDATA[<p>&emsp;&emsp;VDC技术提供了分离的资源和操作环境，并且VDC创建了一个分离的故障域。</p>
<a id="more"></a>

<h2 id="1-VDC基本理论介绍"><a href="#1-VDC基本理论介绍" class="headerlink" title="1 VDC基本理论介绍"></a>1 VDC基本理论介绍</h2><h3 id="1-1-不同程度的虚拟化"><a href="#1-1-不同程度的虚拟化" class="headerlink" title="1.1 不同程度的虚拟化"></a>1.1 不同程度的虚拟化</h3><ul>
<li>数据/ 控制层面：<br>——VLANs和VRFs提供逻辑的数据层面（一定程度的控制层面）分离。</li>
<li>数据/控制层面+管理层面：<br>——Virtual contexts技术（Cisco ASA和FWSM的虚拟防火墙）提供了对数据，配置和管理层面的分离。</li>
<li>数据/ 控制层面+管理层面+资源+操作环境：<br>——在数据层面，控制层面和管理层面分离的基础之上，Cisco Nexus 7000 VDC技术提供了分离的资源和操作环境，并且VDC创建了一个分离的故障域。</li>
<li>Hypervisor 模式提供了完整的虚拟化：</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6ef0dH.png" alt="image-20210305132005487"></p>
<h3 id="1-2-今天的虚拟化与Cisco-VDC架构"><a href="#1-2-今天的虚拟化与Cisco-VDC架构" class="headerlink" title="1.2 今天的虚拟化与Cisco VDC架构"></a>1.2 今天的虚拟化与Cisco VDC架构</h3><p><img src="https://s3.ax1x.com/2021/03/05/6effeg.png" alt="image-20210305132036582"></p>
<p><img src="https://s3.ax1x.com/2021/03/05/6efoYn.png" alt="image-20210305132050060"></p>
<h3 id="1-3-虚拟化的可扩展性"><a href="#1-3-虚拟化的可扩展性" class="headerlink" title="1.3 虚拟化的可扩展性"></a>1.3 虚拟化的可扩展性</h3><ul>
<li><p>4个VDC（2E引擎支持8个）</p>
<ul>
<li>1个default VDC</li>
<li>3个no-default VDC</li>
</ul>
<p>或者</p>
<ul>
<li>1个admin VDC</li>
<li>4个no-default VDC</li>
</ul>
</li>
<li><p>4K VLANs每一个VDC</p>
</li>
<li><p>256 VRFs每一个VDC</p>
</li>
<li><p>最多768个port-channel在一个物理设备上</p>
</li>
<li><p>最多两个SPAN在一个物理设备上</p>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6ehSYR.png" alt="image-20210305132516647"></p>
<h3 id="1-4-Default-VDC"><a href="#1-4-Default-VDC" class="headerlink" title="1.4 Default VDC"></a>1.4 Default VDC</h3><ul>
<li>完整功能的VDC，拥有所有的能力</li>
<li>有些任务只能在default VDC中被执行<ul>
<li>VDC的创建，删除和挂起</li>
<li>资源的关联：接口，内存，等等</li>
<li>NX-OS的升级</li>
<li>Ethanalyzer抓包</li>
<li>为NX2000，FabricPath和FCoE安装Feature-set</li>
<li>CoPP</li>
<li>Port Channel负载均衡</li>
<li>激活ACL捕获特性</li>
</ul>
</li>
<li>Default VDC完全可以被用来承载生产流量<ul>
<li>有些客户更加愿意选择保留他的管理功能</li>
</ul>
</li>
</ul>
<h3 id="1-5-Non-Default-VDC"><a href="#1-5-Non-Default-VDC" class="headerlink" title="1.5 Non-Default VDC"></a>1.5 Non-Default VDC</h3><ul>
<li>完整功能的VDC，拥有所有的能力</li>
<li>在non-default VDC中的修改，只会影响这个特殊的VDC</li>
<li>每一个VDC中，每一个协议有相互独立的进程</li>
<li>每一个VDC有独立的配置文件</li>
<li>每一个VDC有独立的checkpoint</li>
<li>有独立的RBAC，TACACS，SNMP，等等配置</li>
</ul>
<h3 id="1-6-VDC故障域"><a href="#1-6-VDC故障域" class="headerlink" title="1.6 VDC故障域"></a>1.6 VDC故障域</h3><p><img src="https://s3.ax1x.com/2021/03/05/6eh6AJ.png" alt="image-20210305132905218"></p>
<p>&emsp;&emsp;每一个VDC是一个分离的故障域，当在一个VDC中的一个进程崩溃，其它VDC的进程不受影响，并且继续运行。</p>
<h3 id="1-7-VDC资源"><a href="#1-7-VDC资源" class="headerlink" title="1.7 VDC资源"></a>1.7 VDC资源</h3><ul>
<li>物理资源<ul>
<li>以太网接口</li>
</ul>
</li>
<li>逻辑资源<ul>
<li>SPAN监控的会话，port channel，VLAN和VRFs</li>
</ul>
</li>
<li>配置文件<ul>
<li>每一个VDC在NVRAM内维护一个分离的配置文件。</li>
</ul>
</li>
</ul>
<h3 id="1-8-VDC资源共享"><a href="#1-8-VDC资源共享" class="headerlink" title="1.8 VDC资源共享"></a>1.8 VDC资源共享</h3><p>&emsp;&emsp;当创建VDC，一些资源会在VDC之间被共享，然而另外一些资源却只能被某一个VDC所独享。<br>&emsp;&emsp;有些资源只能在默认VDC为所有的VDC全局的关联，设置和配置，这种资源也叫做（Global Resources）全局资源，例如：启动镜像和配置，Ethanalyzer会话，CoPP。<br>&emsp;&emsp;被关联到特定VDC的资源叫做（Dedicated Resources）专属资源或者独享资源，例如：二层三层端口，VLAN，IP地址空间，等等。<br>&emsp;&emsp;有些资源在所有VDC之间被共享叫做（Shared Resources），例如：带外以太网管理端口。</p>
<h3 id="1-9-VDC模块关联限制"><a href="#1-9-VDC模块关联限制" class="headerlink" title="1.9 VDC模块关联限制"></a>1.9 VDC模块关联限制</h3><ul>
<li>NX-OS 5.1之后，“module-type”参数可以限制VDC能够关联的模块类型</li>
<li>不同的模块类型可以被指派<ul>
<li>m1&emsp;&emsp;——指定VDC能够包含M1系列模块</li>
<li>m1-xl&emsp;——指定VDC能够包含M1-XL系列模块</li>
<li>m2-xl&emsp;——指定VDC能够包含M2-XL系列模块</li>
<li>f1&emsp;&emsp;&ensp;——指定VDC能够包含f1系列模块</li>
<li>f2&emsp;&emsp;&ensp;——指定VDC能够包含f2系列模块</li>
</ul>
</li>
<li>“limit-resource module-type f1 m1 m1-xl m2-xl”是默认配置，允许在一个VDC中混合配置M1，M1-XL，M2-XL和F1模块</li>
</ul>
<h3 id="1-10-Storage-VDC"><a href="#1-10-Storage-VDC" class="headerlink" title="1.10 Storage VDC"></a>1.10 Storage VDC</h3><ul>
<li>分离LAN和SAN管理员的工作</li>
<li>在Nexus7000中，创建一个虚拟的MDS，支持所有的FC特性</li>
<li>支持FCoE Target</li>
<li>支持与其它交换机（N7K，N5K，MDS）之间的FCoE ISLs</li>
<li>每一个物理设备只支持一个storage VDC<ul>
<li>不需要VDC的advanced licence</li>
<li>消耗N7K4个VDC中的一个</li>
</ul>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6ehR91.png" alt="image-20210305134938772"></p>
<h3 id="1-11-Admin-VDC"><a href="#1-11-Admin-VDC" class="headerlink" title="1.11 Admin VDC"></a>1.11 Admin VDC</h3><ul>
<li>如果default VDC出现故障，造成切换或者重启，会影响在这个系统中的所有VDC。</li>
<li>Cisco NX-OS 6.1引入了一种新的VDC类型:Admin VDC。</li>
<li>只有Supervisor 2和Supervisor2E引擎才能够支持Admin VDC</li>
<li>Supervisor2 支持4个VDC + 1个Admin VDC</li>
<li>Supervisor2E 支持8个VDC + 1个Admin VDC</li>
<li>当Admin VDC被激活仅仅只有mgmt0这个接口被关联到Admin VDC。</li>
<li>激活Admin VDC不需要Advanced Services Package Licence和VDC Licence。</li>
</ul>
<h3 id="1-12-Port-Group介绍"><a href="#1-12-Port-Group介绍" class="headerlink" title="1.12 Port Group介绍"></a>1.12 Port Group介绍</h3><h4 id="1-12-1-N7K-M132XP-12-Port-Group介绍"><a href="#1-12-1-N7K-M132XP-12-Port-Group介绍" class="headerlink" title="1.12.1 N7K-M132XP-12 Port Group介绍"></a>1.12.1 N7K-M132XP-12 Port Group介绍</h4><p><img src="https://s3.ax1x.com/2021/03/05/6ehIBD.png" alt="image-20210305135335736"></p>
<ul>
<li>N7K-M132XP-12每4个端口1个Port Group，一共有8个Port Group。</li>
<li>在一个模块上，接口必须以port group为单位关联到VDCs。</li>
</ul>
<h4 id="1-12-2-N7K-F132XP-15-Port-Group介绍"><a href="#1-12-2-N7K-F132XP-15-Port-Group介绍" class="headerlink" title="1.12.2 N7K-F132XP-15 Port Group介绍"></a>1.12.2 N7K-F132XP-15 Port Group介绍</h4><p><img src="https://s3.ax1x.com/2021/03/05/6eh7AH.png" alt="image-20210305135358681"></p>
<ul>
<li>N7K-F132XP-15每2个端口1个Port Group，一共有16个Port Group。</li>
<li>在一个模块上，接口必须以port group为单位关联到VDCs。</li>
</ul>
<h4 id="1-12-3-N7K-F248XP-25-Port-Group介绍"><a href="#1-12-3-N7K-F248XP-25-Port-Group介绍" class="headerlink" title="1.12.3 N7K-F248XP-25 Port Group介绍"></a>1.12.3 N7K-F248XP-25 Port Group介绍</h4><p><img src="https://s3.ax1x.com/2021/03/05/6ehxu8.png" alt="image-20210305135404317"></p>
<ul>
<li>N7K-F248XP-25每4个端口1个Port Group，一共有12个Port Group。</li>
<li>在一个模块上，接口必须以port group为单位关联到VDCs。</li>
</ul>
<h3 id="1-13-接口关联与共享"><a href="#1-13-接口关联与共享" class="headerlink" title="1.13 接口关联与共享"></a>1.13 接口关联与共享</h3><ul>
<li>默认的规则只允许一个接口只存在于一个VDC中，但这种情况是一种例外。</li>
<li>通过“Ethertype”来分离流量</li>
<li>以太网类型的VDC拥有自己的接口</li>
<li>存储VDC也能够同样看到这个接口</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6e49EQ.png" alt="image-20210305135854722"></p>
<h3 id="1-14-VDC之间的通讯"><a href="#1-14-VDC之间的通讯" class="headerlink" title="1.14 VDC之间的通讯"></a>1.14 VDC之间的通讯</h3><ul>
<li>需要使用前面板的端口来实现VDC之间的通讯</li>
<li>不存在软件cross-connect，或者背板的VDC间的通讯</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6e4CNj.png" alt="image-20210305140002931"></p>
<h3 id="1-15-Resource-Template"><a href="#1-15-Resource-Template" class="headerlink" title="1.15 Resource Template"></a>1.15 Resource Template</h3><ul>
<li>在引擎上的CPU和内存资源，在所有的VDC之间共享。</li>
<li>Resource Templates被用来限制VDC对引擎资源的影响。</li>
<li>在一个VDC中的VLAN和VRF的限制数量，可以直接被设置。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6e4eDU.png" alt="image-20210305140140589"></p>
<h3 id="1-16-VDC管理"><a href="#1-16-VDC管理" class="headerlink" title="1.16 VDC管理"></a>1.16 VDC管理</h3><h4 id="1-16-1-带外VDC管理"><a href="#1-16-1-带外VDC管理" class="headerlink" title="1.16.1 带外VDC管理"></a>1.16.1 带外VDC管理</h4><ul>
<li>VDC共享在引擎上的带外网管接口</li>
<li>IP地址必须在一个相同的网段</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/05/6e4lCR.png" alt="image-20210305141453741"></p>
<h4 id="1-16-2-带内VDC管理"><a href="#1-16-2-带内VDC管理" class="headerlink" title="1.16.2 带内VDC管理"></a>1.16.2 带内VDC管理</h4><p>带内管理访问可以用来分离VDC之间的管理流量</p>
<p><img src="https://s3.ax1x.com/2021/03/05/6e43gx.png" alt="image-20210305141531882"></p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>VDC</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机vPC</title>
    <url>/2021/03/12/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAvPC/</url>
    <content><![CDATA[<p>&emsp;&emsp;Port Channel是将多个端口，可以是同一块板卡，也可以使不同板卡上的端口，捆绑在一起，增大级联带宽和冗余性。同时，port-channel中的所有端口完全负载均衡。而vPC技术是一种虚拟捆绑的技术，相较于直接使用port-channel来讲，他可以实现将不同的线路进行捆绑。</p>
<a id="more"></a>

<h2 id="1-Port-Channel"><a href="#1-Port-Channel" class="headerlink" title="1 Port Channel"></a>1 Port Channel</h2><h3 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1.1 基本概念"></a>1.1 基本概念</h3><ul>
<li><p>绑定多个物理链路到一个单一的逻辑链路，在两个物理设备之间。</p>
</li>
<li><p>每一个物理端口只能被放入一个port-channel中。</p>
</li>
<li><p>在一个port-channel中的所有的端口必须兼容，并且需要有相同的速率和双工模式。</p>
</li>
<li><p>2 层和3层都可以配置port-channel 。</p>
</li>
<li><p>不能把2层和3层的接口放入相同的port-channel。</p>
</li>
<li><p>Port-Channel分为如下两种类型：</p>
<p>‒Access port - Routed interface</p>
<p>‒Trunk port - Routed with sub interfaces</p>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UuT4P.png" alt="image-20210310170612367"></p>
<h3 id="1-2-Port-Channel模式"><a href="#1-2-Port-Channel模式" class="headerlink" title="1.2 Port Channel模式"></a>1.2 Port Channel模式</h3><ul>
<li>如果希望创建没有聚合协议的静态的port channels ，配置channel 模式为“on ”</li>
<li>如果希望使用LACP 作为聚合协议，需要全局激活LACP </li>
<li>为每一个Channel 启用LACP ，通过为每一个接口设置channel“ 模式为“active ”或者“passive ”</li>
<li>不支持PAgP 协议</li>
</ul>
<h3 id="1-3-散列选项（Hash-Options）"><a href="#1-3-散列选项（Hash-Options）" class="headerlink" title="1.3 散列选项（Hash Options）"></a>1.3 散列选项（Hash Options）</h3><ul>
<li>头部散列为了负载均衡，分布流量穿越多条链路</li>
<li>如下的方式可以被用来做散列<ul>
<li>source-destination-ip &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source &amp; Destination IP address (Default)</li>
<li>source-ip   &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source IP address</li>
<li>destination-ip   &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Destination IP address</li>
<li>source-destination-port &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source &amp; Destination TCP/UDP port</li>
<li>source-port   &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source TCP/UDP port</li>
<li>destination-port  &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Destination TCP/UDP port</li>
<li>source-destination-mac    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source &amp; Destination MAC address</li>
<li>source-mac  &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Source MAC address</li>
<li>destination-mac  &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Destination MAC address</li>
</ul>
</li>
</ul>
<h3 id="1-4-Port-Channel-配置简介"><a href="#1-4-Port-Channel-配置简介" class="headerlink" title="1.4 Port Channel 配置简介"></a>1.4 Port Channel 配置简介</h3><h4 id="1-4-1-Switchport-Access"><a href="#1-4-1-Switchport-Access" class="headerlink" title="1.4.1 Switchport Access"></a>1.4.1 Switchport Access</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">interface<span class="built_in"> ethernet </span>1/4</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface<span class="built_in"> ethernet </span>2/4</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface port-channel 1</span><br><span class="line">  switchport</span><br><span class="line">  switchport access<span class="built_in"> vlan </span>200</span><br></pre></td></tr></table></figure>

<h4 id="1-4-2-Switchport-Trunk"><a href="#1-4-2-Switchport-Trunk" class="headerlink" title="1.4.2 Switchport Trunk"></a>1.4.2 Switchport Trunk</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">interface<span class="built_in"> ethernet </span>1/4</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface<span class="built_in"> ethernet </span>2/4</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface port-channel 1</span><br><span class="line">  switchport</span><br><span class="line">  switchport mode trunk</span><br><span class="line">  switchport trunk allowed<span class="built_in"> vlan </span>10-20</span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-Routed-Interface"><a href="#1-4-3-Routed-Interface" class="headerlink" title="1.4.3 Routed Interface"></a>1.4.3 Routed Interface</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">interface<span class="built_in"> ethernet </span>1/4</span><br><span class="line">  <span class="literal">no</span> switchport</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface<span class="built_in"> ethernet </span>2/4</span><br><span class="line">  <span class="literal">no</span> switchport</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface port-channel 1</span><br><span class="line"> <span class="built_in"> ip address </span>10.0.0.1/24</span><br></pre></td></tr></table></figure>

<h4 id="1-4-4-Routed-Subinterfaces"><a href="#1-4-4-Routed-Subinterfaces" class="headerlink" title="1.4.4 Routed Subinterfaces"></a>1.4.4 Routed Subinterfaces</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">interface<span class="built_in"> ethernet </span>1/4</span><br><span class="line">  <span class="literal">no</span> switchport</span><br><span class="line">  channel-group 1 mode active</span><br><span class="line">interface<span class="built_in"> ethernet </span>2/4</span><br><span class="line">  <span class="literal">no</span> switchport</span><br><span class="line">channel-group 1 mode active</span><br><span class="line"> <span class="built_in"> interface </span>port-channel 1.10</span><br><span class="line"> <span class="built_in"> ip address </span>10.0.10.1/24</span><br><span class="line">  encapsulation dot1q 10</span><br></pre></td></tr></table></figure>

<h2 id="2-vPC"><a href="#2-vPC" class="headerlink" title="2 vPC"></a>2 vPC</h2><h3 id="2-1-vPC简介"><a href="#2-1-vPC简介" class="headerlink" title="2.1 vPC简介"></a>2.1 vPC简介</h3><ul>
<li>允许一个设备使用有两个上游设备的port channel </li>
<li>消除STP阻止端口</li>
<li>提供一个无环的拓扑</li>
<li>使用所有可用的上联带宽</li>
<li>在链路或者设备出现故障时，提供最快的收敛</li>
<li>提供链路级的冗余</li>
<li>确保高可用性</li>
<li>第三方设备可以是一个服务器，一个交换机或者任何网络持设备，只要这些设备支持channel Group技术</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6Uub38.png" alt="image-20210310172206731"></p>
<h3 id="2-2-STP-vs-vPC"><a href="#2-2-STP-vs-vPC" class="headerlink" title="2.2 STP vs vPC"></a>2.2 STP vs vPC</h3><p><img src="https://s3.ax1x.com/2021/03/12/6UuLjg.png" alt="image-20210310173413831"></p>
<h3 id="2-3-使用vPC创建无环的网络"><a href="#2-3-使用vPC创建无环的网络" class="headerlink" title="2.3 使用vPC创建无环的网络"></a>2.3 使用vPC创建无环的网络</h3><p>&emsp;&emsp;可以在现有的架构上使用vPC创建无环的网络</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UuXuQ.png" alt="image-20210310173524474"></p>
<h3 id="2-4-最多32路Port-Channel（Double-Sided-vPC）"><a href="#2-4-最多32路Port-Channel（Double-Sided-vPC）" class="headerlink" title="2.4 最多32路Port-Channel（Double-Sided vPC）"></a>2.4 最多32路Port-Channel（Double-Sided vPC）</h3><ul>
<li>多层vPC能够加入一个有8个active成员端口的port-channel到一个16路的port-channel中。</li>
<li>vPC对等体的负载均衡方式是由这个对等体设备本地判断的。</li>
<li>在M系列模块中，每一个vPC对等体只有8个active链路，两个vPC对等体加在一起一共提供16路active的负载均衡的链路。</li>
<li>F系列模块，支持16路active的port-channel，因此提供一个32路的vPC。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UujBj.png" alt="image-20210310173657117"></p>
<h3 id="2-5-配置流程"><a href="#2-5-配置流程" class="headerlink" title="2.5 配置流程"></a>2.5 配置流程</h3><ol>
<li>在配置vPC 之前需要先激活vPC 特性</li>
<li>先配置Peer-keepalive 链路，然后配置Peer-link 链路，最后设置vPC domain</li>
<li>必须手动配置两个vPC 设备，配置不会从一个设备发送到另外一个设备上</li>
<li>检查在vPC Peer 链路的两端，需要配置的参数是一致的</li>
<li>当配置vPCs 时，可能会经历短暂的流量中断</li>
<li>推荐所有vPC 的port channel 使用LACP </li>
</ol>
<h3 id="2-6-vPC-架构的组件"><a href="#2-6-vPC-架构的组件" class="headerlink" title="2.6 vPC 架构的组件"></a>2.6 vPC 架构的组件</h3><ul>
<li>vPC Peers：一对vPC激活的交换机。</li>
<li>vPC Domain：一对vPC对等体，和相关的vPC组件。</li>
<li>vPC Peer Keepalive Link：路由链路，承载心跳数据包，进行双Active的检测。</li>
<li>vPC Peer Link：在两个vPC对等体设备间，承载控制层面流量。</li>
<li>vPC：在vPC对等体和有port-channel 能力的下的游设备之间的port channel 。</li>
<li>vPC Member Port：形成vPC 的一系列端口中的一个。</li>
<li>Orphan Device：一个设备使用非vPC 链路连接到一个vPC对等体。</li>
<li>Orphan Port：一个vPC 对等体连接一个Orphan设备的端口。</li>
<li>Cisco Fabric Services：在vPC 对等体设备间，用于状态同步和配置确认的协议。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UuzEn.png" alt="image-20210310174406528"></p>
<h3 id="2-7-vPC与N7K模块设计图"><a href="#2-7-vPC与N7K模块设计图" class="headerlink" title="2.7 vPC与N7K模块设计图"></a>2.7 vPC与N7K模块设计图</h3><p><img src="https://s3.ax1x.com/2021/03/12/6UKSNq.png" alt="image-20210310175147498"></p>
<h3 id="2-8-vPC控制层面操作"><a href="#2-8-vPC控制层面操作" class="headerlink" title="2.8 vPC控制层面操作"></a>2.8 vPC控制层面操作</h3><ul>
<li><p>CFS用于同步vPC的控制层面信息</p>
<ul>
<li>MAC地址学习</li>
<li>IGMP snooping</li>
<li>配置一致性检查</li>
<li>vPC成员端口状态</li>
<li>ARP缓存</li>
</ul>
</li>
<li><p>一个交换机被选举成为Primary，另外一端被选举为Secondary </p>
<ul>
<li>角色决定当Peer Link失效时的行为</li>
<li>Primary交换机主导在vPC中的STP </li>
<li>不支持抢占选举</li>
</ul>
</li>
<li><p>vPC对等体对于连接到vPC对等体对于连接到vPC的邻居设备而言，表现为一个单一交换机</p>
</li>
<li><p>vPC Peer Link只承载如下流量</p>
<ul>
<li>vPC控制层流量</li>
<li>泛洪流量</li>
<li>Orphan端口的流量</li>
</ul>
</li>
<li><p>普通交换机的MAC地址学习被替换为为vPC于设计的基于CFS的MAC地址学习</p>
</li>
<li><p>从Peer Link进入vPC对等体的帧不过会通过vPC成员端口转发</p>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UKP3T.png" alt="image-20210312121006088"></p>
<h3 id="2-9-数据层防环"><a href="#2-9-数据层防环" class="headerlink" title="2.9 数据层防环"></a>2.9 数据层防环</h3><p>&emsp;&emsp;来至于Peer-Link 的流量将会被标记，并且不允许从vPC成员端口发出</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UKEDJ.png" alt="image-20210312121040388"></p>
<p>&emsp;&emsp;如果一端的vPC出现故障，Peer-Link可以作为备用链路来实现冗余</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UKmU1.png" alt="image-20210312121059301"></p>
<h3 id="2-10-vPC-Peer-Link-Device-Failure"><a href="#2-10-vPC-Peer-Link-Device-Failure" class="headerlink" title="2.10 vPC Peer Link Device Failure"></a>2.10 vPC Peer Link Device Failure</h3><p>&emsp;&emsp;交换机A的vPC Peer Link失效，交换机A则会通过Peer-Keepalive链路检查远端vPC Peer B的状态，如果vPC Peer B是Up的，Secondary vPC B将会禁用所有的vPC端口，从而阻止环路，黑洞和泛洪流量。数据依然在port channel中剩余的Active 链路上被发送。</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UKKC6.png" alt="image-20210312121253248"></p>
<h3 id="2-11-vPC-Peer-Failure-—-Peer-keepalive-Link"><a href="#2-11-vPC-Peer-Failure-—-Peer-keepalive-Link" class="headerlink" title="2.11 vPC Peer Failure — Peer-keepalive Link"></a>2.11 vPC Peer Failure — Peer-keepalive Link</h3><p>&emsp;&emsp;当没有通过对等keepalive Link返回keepalive消息时，软件将了解vPC对等设备故障。可以使用单独的链接（vPC Peerkeepalive Link）在vPC对等设备之间发送可配置的keepalive消息。vPC对等keepalive Link上的keepalive消息确定故障是仅在vPC对等链路上还是在vPC对等设备上。只有当对等链接中的所有链接都失败时，才使用keepalive消息。</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UKM8K.png" alt="image-20210312125741363"></p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>vPC</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexus交换机vPC配置</title>
    <url>/2021/03/12/Nexus%E4%BA%A4%E6%8D%A2%E6%9C%BAvPC%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>&emsp;&emsp;Nexus交换机vPC配置。</p>
<a id="more"></a>

<p><img src="https://s3.ax1x.com/2021/03/12/6UMRwd.png" alt="image-20210312130934319"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#启用Feature</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#feature vpc </span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#feature lacp </span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#feature vpc</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#feature lacp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置Peer Keepalive Link</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#vrf context P-K-L</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface e4/16-17</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#channel-group 10 mode active</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface port-channel 10</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#vrf member P-K-L</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip address 192.168.1.1/24</span></span><br><span class="line">DC2-N7K-3( config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#vrf context P-K-L</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface e4/18-19</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#channel-group 10 mode active</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface port-channel 10</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#vrf member P-K-L</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip address 192.168.1.2/24</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置vPC Domain与Peer Keepalive Link</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#vpc domain 7</span></span><br><span class="line">DC2-N7K-3(config-vpc-domain)<span class="comment">#role priority 73</span></span><br><span class="line">DC2-N7K-3(config-vpc-domain)<span class="comment">#system-priority 2500</span></span><br><span class="line">DC2-N7K-3(config-vpc-domain)<span class="comment">#peer-keepalive destination 192.168.1.2 source 192.168.1.1 vrf P-K-L</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#vpc domain 7</span></span><br><span class="line">DC2-N7K-4(config-vpc-domain)<span class="comment">#role priority 74</span></span><br><span class="line">DC2-N7K-4(config-vpc-domain)<span class="comment">#system-priority 2500</span></span><br><span class="line">DC2-N7K-4(config-vpc-domain)<span class="comment">#peer-keepalive destination 192.168.1.1 source 192.168.1.2 vrf P-K-L</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置Peer Link</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface e3/18-19</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#channel-group 20 mode active</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-3(config-if-range )<span class="comment">#exit</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface port-channel 20</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#vpc peer-link</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface e3/26-27</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#channel-group 20 mode active</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#exit</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface port-channel 20</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#vpc peer-link</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置vPC</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface e3/21-22</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#channel-group 30 mode active</span></span><br><span class="line">DC2-N7K-3(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface port-channel 30</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#vpc 30</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface e3/31-32</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#channel-group 30 mode active</span></span><br><span class="line">DC2-N7K-4(config-if-range)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface port-channel 30</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#vpc 30</span></span><br><span class="line"></span><br><span class="line">DC2-N5K-1(config)<span class="comment">#feature lacp</span></span><br><span class="line">DC2-N5K-1(config)<span class="comment">#interface e1/21-22,e1/27-28</span></span><br><span class="line">DC2-N5K-1(config-if-range)<span class="comment">#channel-group 30 mode active</span></span><br><span class="line">DC2-N5K-1(config-if-range)<span class="comment">#exit</span></span><br><span class="line">DC2-N5K-1(config)<span class="comment">#interface port-channel 30</span></span><br><span class="line">DC2-N5K-1(config-if)<span class="comment">#switchport mode trunk</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置Interface—Vlan</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#feature interface-vlan</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#vlan 10</span></span><br><span class="line">DC2-N7K-3(config-vlan)<span class="comment">#name QYT-Test</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip address 202.100.1.252/24</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#feature interface-vlan</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#vlan 10</span></span><br><span class="line">DC2-N7K-4(config-vlan)<span class="comment">#name QYT-Test</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip address 202.100.1.253/24</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置OSPF</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#router ospf 1</span></span><br><span class="line">DC2-N7K-1(config-router)<span class="comment">#router-id 1.1.1.1</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#interfacee4/15</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip address 202.100.13.1/24</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#interfacee4/2</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip address 202.100.14.1/24</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#interfaceloopback 0</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip address 61.128.1.1/24</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip router ospf area 0</span></span><br><span class="line">DC2-N7K-1(config)<span class="comment">#interfaceloopback 1</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip address 128.6.7.6/24</span></span><br><span class="line">DC2-N7K-1(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">DC2-N7K-3(config-router)<span class="comment">#router-id 3.3.3.3</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interfacee4/34</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip address 202.100.13.3/24</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interfacee4/26</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip address 202.100.34.3/24</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#ip prefix-list D2O permit 202.100.1.0/24</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#route-map D2O</span></span><br><span class="line">DC2-N7K-3(config-route-map)<span class="comment">#match ip address prefix-list D2O</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#router ospf 1</span></span><br><span class="line">DC2-N7K-3(config-router)<span class="comment">#redistribute direct route-map D2O</span></span><br><span class="line"></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#feature ospf</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">DC2-N7K-4(config-router)<span class="comment">#router-id 4.4.4.4</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interfacee4/4</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip address 202.100.14.4/24</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interfacee4/27</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip address 202.100.34.4/24</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#ip router ospf 1 area 0</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#ip prefix-list D20 permit 202.100.1.0/24</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#route-map D2O</span></span><br><span class="line">DC2-N7K-4(config-route-map)<span class="comment">#match ip address prefix-list D2O</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#router ospf 1</span></span><br><span class="line">DC2-N7K-4(config-router)<span class="comment">#redistribute direct route-map D2O</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置HSRP</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#feature hsrp</span></span><br><span class="line">DC2-N7K-3(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC2-N7K-3(config-if)<span class="comment">#hsrp 1</span></span><br><span class="line">DC2-N7K-3(config-if-hsrp)<span class="comment">#ip 202.100.1.254</span></span><br><span class="line">DC2-N7K-3(config-if-hsrp)<span class="comment">#preempt</span></span><br><span class="line">DC2-N7K-3(config-if-hsrp)<span class="comment">#priority 105</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#feature hsrp</span></span><br><span class="line">DC2-N7K-4(config)<span class="comment">#interface vlan 10</span></span><br><span class="line">DC2-N7K-4(config-if)<span class="comment">#hsrp 1</span></span><br><span class="line">DC2-N7K-4(config-if-hsrp)<span class="comment">#ip 202.100.1.254</span></span><br><span class="line">DC2-N7K-4(config-if-hsrp)<span class="comment">#preempt</span></span><br><span class="line"></span><br><span class="line">DC2-N5K-1(config)<span class="comment">#vlan 10</span></span><br><span class="line">DC2-N5K-1(config-vlan)<span class="comment">#name QYT-Test</span></span><br><span class="line">DC2-N5K-1(config)<span class="comment">#interface e1/26</span></span><br><span class="line">DC2-N5K-1(config-if)<span class="comment">#speed 1000</span></span><br><span class="line">DC2-N5K-1(config-if)<span class="comment">#switchport mode access</span></span><br><span class="line">DC2-N5K-1(config-if)<span class="comment">#switchport access vlan 10</span></span><br><span class="line">DC2-N5K-1(config-if)<span class="comment">#spanning-tree port type edge</span></span><br><span class="line"></span><br><span class="line">Router(config)<span class="comment">#interface fa0/0</span></span><br><span class="line">Router(config-if)<span class="comment">#ip address 202.100.1.2 255.255.255.0</span></span><br><span class="line">Router(config-if)<span class="comment">#no shutdown</span></span><br><span class="line">Router(config)<span class="comment">#ip route 0.0.0.0 0.0.0.0 202.100.1.254</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nexus实验</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>vPC</tag>
      </tags>
  </entry>
  <entry>
    <title>OSPF协议详解</title>
    <url>/2020/10/01/OSPF%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p>&emsp;&emsp;OSPF(Open Shortest Path First开放式最短路径优先）是一个内部网关协议(Interior Gateway Protocol，简称IGP），用于在单一自治系统（autonomous system,AS）内决策路由。是对链路状态路由协议的一种实现，隶属内部网关协议（IGP），故运作于自治系统内部。著名的Dijkstra算法被用来计算最短路径树。OSPF支持负载均衡和基于服务类型的选路，也支持多种路由形式，如特定主机路由和子网路由等。</p>
<a id="more"></a>

<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>&emsp;&emsp;OSPF路由协议是一种典型的链路状态（Link-state）的路由协议，一般用于同一个路由域内。在这里，路由域是指一个自治系统（Autonomous System），即AS，它是指一组通过统一的路由政策或路由协议互相交换路由信息的网络。在这个AS中，所有的OSPF路由器都维护一个相同的描述这个AS结构的数据库，该数据库中存放的是路由域中相应链路的状态信息，OSPF路由器正是通过这个数据库计算出其OSPF路由表的。</p>
<p>&emsp;&emsp;作为一种链路状态的路由协议，OSPF将链路状态组播数据LSA（Link State Advertisement）传送给在某一区域内的所有路由器，这一点与距离矢量路由协议不同。运行距离矢量路由协议的路由器是将部分或全部的路由表传递给与其相邻的路由器。</p>
<p>&emsp;&emsp;在信息交换的安全性上，OSPF规定了路由器之间的任何信息交换在必要时都可以经过认证或鉴别（Authentication），以保证只有可信的路由器之间才能传播选路信息。OSPF支持多种鉴别机制，并且允许各个区域间采用不同的鉴别机制。OSPF对链路状态算法在广播式网络（如以太网）中的应用进行了优化，以尽可能地利用硬件广播能力来传递链路状态报文。通常链路状态算法的拓扑图中一个结点代表一个路由器。若K个路由器都连接到以太网上，在广播链路状态时，关于这K个路由器的报文将达到K的平方个。为此，OSPF在拓扑结构图允许一个结点代表一个广播网络。每个广播网络上所有路由器发送链路状态报文，报告该网络中的路由器的链路状态。</p>
<h3 id="OSPF常用术语"><a href="#OSPF常用术语" class="headerlink" title="OSPF常用术语"></a>OSPF常用术语</h3><ul>
<li><strong>ABR：</strong>ABR路由器至少有两个接口分别连接不同区域（包括骨干区域在内）。ABR中包含每个区域的LSDB信息，为每个区域进行路由计算，且在区域之间通告路由信息。 </li>
<li><strong>ASBR：</strong>ASBR路由器至少有一个接口连接到一个OSPF区域，且至少有一个接口连接到外部非OSPF区域。 </li>
<li><strong>内部路由器：</strong>内部路由器的所有接口都只连接到一个OSPF区域。此路由器完全在区域内部。 </li>
<li><strong>骨干路由器：</strong>骨干路由器至少有一个接口连接到骨干区域。</li>
</ul>
<h3 id="OSPF的三张表"><a href="#OSPF的三张表" class="headerlink" title="OSPF的三张表"></a>OSPF的三张表</h3><ol>
<li><p><strong>邻居表：</strong>当启用OSPF之后，就会往组播地址224.0.0.5发送hello包，也会收到邻居发送的hello包，那么会把hello包的RID添加进自己的邻居表中。</p>
</li>
<li><p><strong>拓扑表（链路状态数据库）：</strong>存放的是每台设备对网路的认知（网络中的地址）。</p>
</li>
<li><p><strong>路由表：</strong>OSPF的路由器由链路状态数据库进行SPF的算法得到最优路径。</p>
</li>
</ol>
<h3 id="OSPF的五个包"><a href="#OSPF的五个包" class="headerlink" title="OSPF的五个包"></a>OSPF的五个包</h3><ol>
<li><p><strong>Hello：</strong>周期性发送，用来发现和维持OSPF邻居关系。内容包括一些定时器的数值、DR（DesignatedRouter，指定路由器）、BDR(Backup DesignatedRouter，备份指定路由器）以及自己己知的邻居（默认情况下，Hello 时间为10s，死亡时间为40s。可在接口下修改hello时间与死亡时间）。</p>
</li>
<li><p><strong>DBD（数据库描述包）：</strong>描述了本地LSDB中每一条LSA的摘要信息，用于两台路由器进行数据库的同步。</p>
</li>
<li><p><strong>LSR（链路状态请求包）：</strong>向对方请求所需的LSA。两台路由器互相交换DBD报文之后，得知对端的路由器有哪些LSA是本地的LSDB所缺少的，这时需要发送LSR报文向对方请求所需的LSA。内容包括所需要的LSA的摘要。</p>
</li>
<li><p><strong>LSU（链路状态更新包）：</strong>向对方发送其所需要的LSA。</p>
</li>
<li><p><strong>LSACK（链路状态确认包）：</strong>用来对收到的LSA进行确认。内容是需要确认的LSA的Header(一个报文可对多个LSA进行确认）。</p>
</li>
</ol>
<h3 id="OSPF的状态机"><a href="#OSPF的状态机" class="headerlink" title="OSPF的状态机"></a>OSPF的状态机</h3><ol>
<li><strong>Down：</strong>未启用OSPF的状态。建立成功后，以下情况三种情况会使OSPF状态从full到down：①接口松动；②重启进程；③到达规定的死亡时间。</li>
<li><strong>Init：初始化状态。</strong>收到了来自邻居的Hello包（包含对方的route-id），并将对方的状态设置为init。</li>
<li><strong>2-way：邻居状态。</strong>双方彼此都收到了的hello包，并周期性的发送Hello包（双方建立会话）。</li>
<li><strong>Exstart：预启动状态。</strong>进入双向通信之后，双方进行数据库摘要交换，在数据库摘要交换之前，要进行主从关系的选举（比较RID与优先级，如果RID一样会卡在该状态）</li>
<li><strong>Exchange：交换状态。</strong>进行数据库的摘要（DBD）的交换，告知对端本地所有的LSA的目录。在收到对方的数据库摘要后，对比自己的数据库摘要，如果没有，就会发送链路请求包（LSR）要求对方把对应的详细LSA信息发送过来（要求对方发送对应LSA的LSU），收到LSU后向对方发送LSACK。</li>
<li><strong>Loading：加载状态。</strong>发送LSR、LSU、LSACK，学习对端的LSA的详细信息。</li>
<li><strong>Full：完全邻接。</strong>双方的数据库一致。</li>
<li><strong>Attempt：</strong>该状态仅在NBMA环境，例如帧中继、X.25或ATM环境中有效，表示在一定时间内没有接收到某一相邻路由器的信息，但是OSPF路由器仍必须通过以一个较低的频率向该相邻路由器发送Hello数据包来保持联系。</li>
</ol>
<h3 id="OSPF的分层"><a href="#OSPF的分层" class="headerlink" title="OSPF的分层"></a>OSPF的分层</h3><p> &emsp;&emsp;OSPF使用两层的区域分级。</p>
<ul>
<li><strong>骨干区域（区域0）：</strong>骨干区域的两个主要要求是，骨干区域必须连接其他所有非骨干区域，且此骨干区域必须总是连续的；不允许分割骨干区域。一般来说，骨干区域中没有终端用户。</li>
<li><strong>非骨干区域（非0区域）：</strong>此区域的主要功能是连接终端用户和资源。非骨干区域通常根据功能性或地理性进行划分。不同非骨干区域之间的流量必须经过骨干区域。</li>
</ul>
<h3 id="OSPF-的LSA类型"><a href="#OSPF-的LSA类型" class="headerlink" title="OSPF 的LSA类型"></a>OSPF 的LSA类型</h3><p>&emsp;&emsp;路由器必须知道OSPF区域的详细拓扑才能计算最优路径。LSA描述了拓扑的详细信息，它是构成OSPF LDSB的基石。每个LSA都是独立的数据库记录，它们组合起来描述了OSPF网络区域的整体拓扑。下面介绍OSPF最常见的一些LSA类型。</p>
<ul>
<li><strong>类型1，路由器LSA：</strong>每台路由器为所属的每个区域生成路由器链路通告。路由器链路通告描述了区域中的路由器链路状态，只在特定区域中泛洪。对于所有类型的LSA，都有20字节的LSA头部。LSA头部中的一个字段是链路状态ID。类型1 LSA的链路状态ID是源路由器ID。   </li>
<li><strong>类型2，网络LSA：</strong> DR为多路访问网络生成网络链路通告。网络链路通告在包含该网络的区域中泛洪。类型2 LSA的链路状态ID是DR的接口的IP地址。  </li>
<li><strong>类型3，汇总LSA：</strong>ABR将从一个区域中学习到的信息汇总成汇总链路通告，并发给另一个区域。汇总并不是默认开启的。类型3 LSA的链路状态ID是目的网络地址。  </li>
<li><strong>类型4，ASBR汇总LSA：</strong>ASBR汇总链路通告负责通知OSPF域的其余部分，如何到达ASBR。链路状态ID包含所描述ASBR的路由器ID。 </li>
<li><strong>类型5，自制系统LSA：</strong>自治系统外部链路通告由ASBR生成，描述了到达自治系统外部目的网络的路由。在除了特殊区域外的其他区域中泛洪。类型5 LSA的链路状态ID是外部网络地址。 </li>
<li><strong>类型6：</strong>组播OSPF应用中使用的专用LSA 。</li>
<li><strong>类型7：</strong>在特殊区域类型NSSA中对外部路由使用。</li>
<li><strong>类型8、9：</strong>在OSPFv3中对链路本地地址和区域内前缀使用。</li>
<li><strong>类型10、11：</strong>通用LSA，也成为透明（Opaque）,允许OSPF未来的拓展。</li>
</ul>
<h3 id="RID的选择"><a href="#RID的选择" class="headerlink" title="RID的选择"></a>RID的选择</h3><p>&emsp;&emsp;在OSPF进程初始化时，路由器使用以下条件选择OSPF路由器的RID。</p>
<ol>
<li>使用<strong>router-id</strong>&ensp; <em>ip-address</em>命令指定路由器的RID。可为路由器配置一个IPv4格式的随机值，但该值必须唯一。如果router-id命令指定的IPv4地址与另一个已经活跃的OSPF进程重叠，router-id命令则执行失败。</li>
<li>使用路由器上所有活跃的 loopback 接口中最高IPv4地址。</li>
<li>使用所有活跃的非 loopback 接口中最高IPv4地址。</li>
</ol>
<h3 id="DR-BDR的选举规则"><a href="#DR-BDR的选举规则" class="headerlink" title="DR/BDR的选举规则"></a>DR/BDR的选举规则</h3><ol>
<li>先比较优先级，优先级大的优先；默认情况下以太网接口的优先级都为1，串行链路的接口优先级都为0（优先级为0不能参与DR/BDR的选举）</li>
<li>如果优先级都一样，继续比较RID，RID大的优先</li>
<li>DR的选举是非抢占的</li>
</ol>
<h3 id="OSPF的网络类型"><a href="#OSPF的网络类型" class="headerlink" title="OSPF的网络类型"></a>OSPF的网络类型</h3><ol>
<li><strong>点到点（Point-to-point）：</strong>路由器使用组播动态地发现邻居。没有DR/BDR的选举，因为在一个点到点网段上只能连接两台路由器。这是串行链路和点到点帧中继子接口的默认OSPF网络类型。</li>
<li><strong>点到多点（Point-to-multipoint）：</strong>OSPF将此网络作为一个点到点链路的结合来对待，即使所有接口都属于同一个IP子网。每个接口的IP地址都将作为主机/32路由出现在邻居的路由表中。路由器使用组播动态发现邻居，不进行DR/BDR选举。</li>
<li><strong>广播型多路访问网络（Broadcast）：</strong>路由器使用广播来动态发现邻居。选举DR和BDR，用来优化信息交换的交换过程。这是以太网链路的默认OSPF网络类型。</li>
<li><strong>非广播型多路访问网络（NBMA）：</strong>用在互联超过两台路由器，但没有广播能力的网络上。帧中继和ATM都属于NBMA网络。在此网络下，需要静态配置邻居，接着进行DR/BDR选举。此网络类型是使用帧中继封装的所有物理接口和多点子接口的默认网络类型。 </li>
</ol>
<p>特点总结：</p>
<ul>
<li><p>点家族都不用选举DR和BDR</p>
</li>
<li><p>多路访问都需要选举DR和BDR</p>
</li>
<li><p>非广播都要手动指定邻居，非广播都是单播更新</p>
</li>
<li><p>neighbor命令后指定的cost只有在非广播下才有效</p>
</li>
<li><p>OSPF只用接口的第一IP地址建立邻居和形成邻接</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>网络类型</th>
<th>Hello</th>
<th>DBD</th>
<th>LSR</th>
<th>LSU</th>
<th>LSAck</th>
</tr>
</thead>
<tbody><tr>
<td>点对点</td>
<td>224.0.0.5</td>
<td>224.0.0.5</td>
<td>224.0.0.5</td>
<td>224.0.0.5</td>
<td>224.0.0.5</td>
</tr>
<tr>
<td>Broadcast</td>
<td>224.0.0.5</td>
<td>单播</td>
<td>单播</td>
<td>224.0.0.5或224.0.0.6</td>
<td>224.0.0.5或224.0.0.6</td>
</tr>
<tr>
<td>NBMA</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
</tr>
<tr>
<td>点对多点</td>
<td>224.0.0.5</td>
<td>单播</td>
<td>单播</td>
<td>224.0.0.5或单播</td>
<td>224.0.0.5</td>
</tr>
<tr>
<td>Virual Link</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
<td>单播</td>
</tr>
</tbody></table>
<h3 id="OSPF最优路径计算"><a href="#OSPF最优路径计算" class="headerlink" title="OSPF最优路径计算"></a>OSPF最优路径计算</h3><p>&emsp;&emsp;一旦LDSB在OSPF邻居间实现了同步，每台路由器就需要确定其在网络拓扑中的最优路径。</p>
<p>&emsp;&emsp;当SPF尝试判断去往某个已知目的的最优路径时，它会比较各个路径的总开销值。开销值最低的路径会被选为最优路径。OSPF开销是通过一个接口发送数据包的开销的指标。OSPF开销是自动为每个分配到OSPF进程中的接口计算的，计算的公式为：</p>
<center>开销=参考带宽/接口带宽</center>

<p>&emsp;&emsp;开销值是一个在1~65535之间的数，开销值越低路径越优先。参考带宽默认设置为100Mbit/s。</p>
<p>&emsp;&emsp;在高于默认带宽（100Mbit/s）的链路上，自动的开销分配不再起作用（它会让所有开销都等于1）。在这些链路上，OSPF开销必须手动在每个接口进行设置。</p>
<center>OSPF的默认开销表</center>

<table>
<thead>
<tr>
<th>链路类型</th>
<th>默认开销</th>
</tr>
</thead>
<tbody><tr>
<td>T1（1.544Mbit/s 串行链路）</td>
<td>64</td>
</tr>
<tr>
<td>以太网</td>
<td>10</td>
</tr>
<tr>
<td>快速以太网</td>
<td>1</td>
</tr>
<tr>
<td>吉比特以太网</td>
<td>1</td>
</tr>
<tr>
<td>10吉比特以太网</td>
<td>1</td>
</tr>
</tbody></table>
<p>&emsp;&emsp;由于在OSPF协议中，默认的参考带宽为100Mbit/s不适用与计算比快速以太网更快的链路的OSPF开销。所有这样的链路被分配的开销都是1，这样会造成OSPF无法选择出理想的最短路径，因为它将会多有高速链路视为等价。</p>
<p>&emsp;&emsp;要是想改善OSPF的这种方式，管理员可以使用OSPF配置命令 <strong>auto-cost reference-bandwith</strong> 将参考带宽调整为更高值 。需要注意的是只有在OSPF域中使用一致的参考带宽才能确保所有的路由器都正确地计算出最优路径。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>路由协议</tag>
      </tags>
  </entry>
  <entry>
    <title>OSPF特殊区域</title>
    <url>/2020/11/13/OSPF%E7%89%B9%E6%AE%8A%E5%8C%BA%E5%9F%9F/</url>
    <content><![CDATA[<p>&emsp;&emsp;从网络优化的角度，我们一直在试图在保证网络通畅的情况下减少网络中传递的路由条目及LSA的数量，路由汇总就是一种很好的方式，当然，从 OSPF的设计规划角度，我们还有特殊区域可供我们灵活运用，下面来看看OSPF特殊区域是如何帮助我们减少LSA泛洪的。</p>
<a id="more"></a>

<p><img src="https://s3.ax1x.com/2020/11/14/DCcRLq.png" alt="无标题"></p>
<p>&emsp;&emsp;我将以上面这个拓扑图介绍OSPF的特殊区域。拓扑中共有三个区域，骨干区域 area 0为一级行及二级行所运行，三级行运行的是OSPF的常规区域，为了保证网络的畅通，我们将网络中的各个角落都宣告进了OSPF，这感觉没有什么问题。但是随着设备越老越多、网络前缀越来越多，路由条目势必逐渐增多，那么路由器就有些承担不住了，毕竟庞大的路由表及LSA在极大地消耗着路由器的资源。所以我们需要对网络进行优化，在保证网络通畅的情况下减少网络中传递的路由条目及LSA的数量，除了路由汇总外，我们也可以使用OSPF的特殊区域来减少LSA的泛洪。</p>
<p>&emsp;&emsp;在这里我们拿area 1举例，当area 1为常规区域时，区域中会有多少种LSA在泛洪呢？1类是必然有的，由于area 1中存在MA网络，因此2类LSA也有。其他区域的3类LSA被ABR也都注入进了本区域。另外，由于area 2的ASBR引入的外部路由（5类LSA）也会被泛洪进area 1，当然4类LSA也跟着来了。那么如此一来，area 1中就有1、2、3、4、5，共计5种类型的LSA。但是仔细一想我们就发现，其实area 1作为“叶”区域，没必要知道外部路由的详细情况，我只需要知道有那么一条路，让我到达域外即可，因此，第一种特殊区域：末梢区域stub area。</p>
<h2 id="1-末梢区域（stub-area）"><a href="#1-末梢区域（stub-area）" class="headerlink" title="1 末梢区域（stub area）"></a>1 末梢区域（stub area）</h2><p><img src="https://s3.ax1x.com/2020/11/14/DCcqyR.png" alt="image-20201114133720565"></p>
<p>&emsp;&emsp;我们可以通过配置，将一个常规区域设置为stub 区域。</p>
<p>&emsp;&emsp;Stub区域将禁止4、5类LSA进入该区域，同时该区域的ABR将会自动下发一条默认路由（3类LSA）进该区域，以确保数据通路没有问题。这可以形象的理解为：“外面的世界再怎么精彩，你不用告诉我细节，只要让我出去就行了”。这就是stub area的设计思路。当引入大量的外部路由进OSPF，适当的规划某些区域为stub，可以起到不错的网络优化作用。</p>
<p>&emsp;&emsp;值得注意的是，不能将骨干区域area 0配置为stub区域，同时，让一个区域被指定为stub，区域内将不允许注入外部路由，也就是不能做重发布。</p>
<p>配置命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#router ospf 1</span></span><br><span class="line">Router(config-router)<span class="comment">#area 1 stub </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;需要注意的是，该命令要配置在stub区域中的所有路由器上，如果某台路由器没有配置，那么它将无法去其他stub area router建立邻接关系。</p>
<p>实现效果：</p>
<p>&emsp;&emsp;Area1中将不会在有4、5类LSA，也就是area 2重发布进来的路由，被ABR过滤掉了，同时area 1中的路由器将获取到一条3类LSA 的默认路由，该默认路由是由area1的ABR自动下发。</p>
<h2 id="2-完全末梢区域（totally-stub）"><a href="#2-完全末梢区域（totally-stub）" class="headerlink" title="2 完全末梢区域（totally stub）"></a>2 完全末梢区域（totally stub）</h2><p><img src="https://s3.ax1x.com/2020/11/14/DCcXex.png" alt="image-20201114140049631"></p>
<p>&emsp;&emsp;通过将区域规划为stub area，可以起到一定的网络优化作用，但是感觉上还不够彻底，除了外部路由，其他区域的路由其实我也没必要知道太多细节，完全用一条默认路由替代也行嘛，那么你可以将area 1配置为完全末梢区域（totally stub area），当一个区域被配置为完全末梢区域，这个区域将：</p>
<ul>
<li>阻挡3、4、5类LSA进入本区域</li>
<li>区域的ABR自动下发一条3类LSA的默认路由进入本区域</li>
</ul>
<p>&emsp;&emsp;这么一来，area 1内路由器收到的LSA将进一步减少，在存储LSA及进行SPF算法运算的时候，耗费的资源自然也就减少了，另外当区域外拓扑出现变更的时候，对本区域的影响也将变为最小。<br>&emsp;&emsp;与stub区域类似，你无法将骨干区域area 0配置为totally stub area，当然如果一个区域被指定为totally stub area，你将不能在区域中的路由器上做路由重发布动作。</p>
<p>配置命令：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Router(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">Router(config-router)#area 1 stub </span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;在完全末梢区域内的所有路由器，都配置上述命令，与stub区域的区别在于ABR的配置，下面是配置在完全末梢区域的ABR上的。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Router(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">Router(config-router)#area 1 stub no-summary </span><br></pre></td></tr></table></figure>

<p>实现效果：</p>
<p>&emsp;&emsp;完成上述配置后，area1内的路由器将只有本区域内的路由（ABR除外），同时都能获取到ABR下发的3类的默认路由。也就是说其他区域的路由以及外部注入的路由都被ABR阻挡在外，取而代之的是一条默认路由。</p>
<h2 id="4-非完全末梢区域（NSSA）"><a href="#4-非完全末梢区域（NSSA）" class="headerlink" title="4 非完全末梢区域（NSSA）"></a>4 非完全末梢区域（NSSA）</h2><p><img src="https://s3.ax1x.com/2020/11/14/DCWG7t.png" alt="image-20201114142231423"></p>
<p>&emsp;&emsp;在前面的知识基础上，我们已经了解到，在保证网络连通性的情况下，减少LSA的泛洪以及精简路由表，我们可以将特定区域配置为末梢区域或完全末梢区域。看上面的拓扑，我们将area 2配置为stub，那么，这个区域一来将阻挡来自其他区域的4、5类LSA，同时区域内的路由器禁止重发布外部路由，那么如果此时我期望这个区域保持“阻挡其他区域过来的4、5类LSA”这个特性，同时允许我在区域本地重发布路由呢？<br>&emsp;&emsp;例如，假设area 2原先是作为一个末梢区域运行的，但突然有一个外部网络，需要接入到我们这个OSPF网络中，并且连接在area 2中，那么这个时候，为了保证路由的可达，就必须向area 2中注入外部路由了，而这又违法了stub area的规则。</p>
<p><img src="https://s3.ax1x.com/2020/11/14/DCWCpF.png" alt="image-20201114142308257"></p>
<p>&emsp;&emsp;这里就引入NSSA（not-so-stubby-area）的概念，中文翻译过来，可以理解为非完全末梢区域，当你将一个区域配置为NSSA，那么这个区域一来将阻挡骨干区域过来的4、5类LSA，同时允许区域本地注入外部路由，这些外部路由以一种特殊的LSA类型——7类LSA在NSSA中泛洪并且7类LSA不允许进入骨干区域或常规区域，NSSA的ABR会负责将7类LSA“转换”成5类LSA，从而在常规区域中进一步泛洪。上面的“允许区域本地注入”的意思是，NSSA这个区域的路由器配置重发布。</p>
<p>&emsp;&emsp;值得注意的是与stub area及totally stub area不同的是如果你将一个区域配置为NSSA、默认情况下NSSA的ABR不会自动下发默认路由进NSSA，因此在NSSA环境下，需留意网络连通性问题。</p>
<p>配置命令∶</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Router(config)#router<span class="built_in"> ospf </span>1</span><br><span class="line">Router(config-router)#area 2 nssa </span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;上述命令需配置在NSSA内的所有路由器上。</p>
<p>实现效果：</p>
<p>&emsp;&emsp;将area 2配置为NSSA后，从骨干区域过来的4、5类LSA将无法进入NSSA，也就是说如果area 1做了重发布，那么这些重发布的外部路由将无法进入NSSA（这是因为NSSA中不允许出现5类LSA），与此同时，area 2允许本地的路由器做重发布动作，重发布进来的路由，以LSA7在NSSA中泛洪，大家在路由表中看到的这些外部路由，标记为“O N”，而这些7类LSA在“穿越”NSSA的ABR进入骨干区域之前，由ABR负责将7类LSA“转换”成5类LSA。最终area 0及area 1也都能学习到这些外部路由，只不过，他们路由表中呈现的是“O E”标记。</p>
<h2 id="5-Totally-NSSA"><a href="#5-Totally-NSSA" class="headerlink" title="5 Totally NSSA"></a>5 Totally NSSA</h2><p><img src="https://s3.ax1x.com/2020/11/14/DChzkt.png" alt="image-20201114142500409"></p>
<p>&emsp;&emsp;Totally NSSA，这是一个不太好用中文翻译的词汇，完全非完全末梢区域？显得有点尴尬，不过这个概念的理解并不像其名字那么唬人，Totally NSSA是在NSSA区域的基础之上，进一步阻挡NSSA区域外的其他区域过来的3类LSA，同时ABR自动下发一条3类的默认路由进 NSSA 区域。<br>配置命令∶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#router ospf 1</span></span><br><span class="line">Router(config-router)<span class="comment">#area 2 nssa </span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;上述命令需配置在NSSA中的所有路由器上，ABR的配置有所不同，如下∶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Router(config)<span class="comment">#router ospf 1</span></span><br><span class="line">Router(config-router)<span class="comment">#area 2 nssa no-summary</span></span><br></pre></td></tr></table></figure>

<p>实现效果：</p>
<p>&emsp;&emsp;Area2之外的其他OSPF area过来的3、4、5类LSA，都会被阻挡在NSSA之外，同时ABR会自动下发默认路由进NSSA，另外，NSSA内的路由器做重发布动作，区域内的其他路由器将会学习到7类的外部LSA，这些外部LSA会被ABR转成5类LSA并注入进骨干区域。</p>
<h2 id="6-特殊区域总结"><a href="#6-特殊区域总结" class="headerlink" title="6 特殊区域总结"></a>6 特殊区域总结</h2><ul>
<li><p><strong>骨干区域 Backbone Area 0</strong></p>
<p>本身是一个标准区域，负责连接非骨干区域，其它区域(非骨干区域）必须保证和骨干区域有直接的物理连接，因为区域之间的LSA必须经过骨干区域中转</p>
</li>
<li><p><strong>常规（标准）区域 Standard Area</strong></p>
<p>一个区域缺省是常规区域</p>
</li>
<li><p><strong>末梢区域 Stub Area</strong></p>
<p>把一个区域配成存根区域的好处是，阻挡LSA4、LSA5外部路由进入本地区域，从而精简路由表;同时ABR会自动产生3类的默认路由LSA注入进该区域。</p>
</li>
<li><p><strong>完全末梢区域 Totally Stubby Area</strong></p>
<p>完全末梢区域是一种对末梢区域的改进，进一步精简路由表;阻挡LSA3、4、5进入该区域，同时ABR自动下发3类默认路由。</p>
</li>
<li><p><strong>非完全末梢区域 Not-so-stubby Area</strong></p>
<p>即想阻挡LSA5，自身又想引入外部路由，stub的变种；</p>
<p>NSSA既阻挡外部LSA5的进入，同时区域内的路由器又可以引入外部路由LSA7 ;LSA7在NSSA内洪泛，通过ABR时转换为LSA5并被注入进骨干区域。</p>
<p>ABR不会缺省生成0/O默认路由进入本地区域，需手工配置</p>
</li>
<li><p><strong>完全NSSA totally Not-so-stubby Area</strong></p>
<p>在NSSA的基础上进一步阻挡骨干区域过来的3,4,5类LSA 并且ABR自动下发3类的默认路由进NSSA。</p>
</li>
</ul>
<p>&emsp;&emsp;<strong>各区域内所允许出现LSA总结如下：</strong></p>
<ul>
<li><p>骨干区域：1、2、3、4、5</p>
</li>
<li><p>标准区域：1、2、3、4、5</p>
</li>
<li><p>Stub区域：1、2、3、3类0.0.0.0/0（ABR向区域内发起的一条3类缺省路由LSA）</p>
</li>
<li><p>完全Stub区域： 1、2、3类0.0.0.0/0（ABR向区域内发起的一条3类缺省路由LSA）</p>
</li>
<li><p>NSSA 区域：1、2、3、7</p>
</li>
<li><p>完全NSSA区域:1、2、7、3类0.0.0.0/0 (ABR向区域内发起的一条3类缺省路由LSA )</p>
</li>
</ul>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>路由协议</tag>
      </tags>
  </entry>
  <entry>
    <title>OSPF路由优选规则</title>
    <url>/2020/11/15/OSPF%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%99/</url>
    <content><![CDATA[<p>&emsp;&emsp;在路由表中我们可以看到通过OSPF路由协议学习到的路由是哪一种类型（如O、O IA、O E1、O E2、O N1、O N2）的。当路由器学习到不同类型的同一路由时是如何选择的呢？本篇文章主要介绍OSPF路由的优先选择原则。</p>
<a id="more"></a>

<h2 id="1-基本优选规则"><a href="#1-基本优选规则" class="headerlink" title="1 基本优选规则"></a>1 基本优选规则</h2><ol>
<li><p>直连路由：本路由器发起的LSA1、2 ；</p>
</li>
<li><p>区域内路由：O： LSA1、2；</p>
</li>
<li><p>区域间路由：O IA： LSA 3 ；</p>
</li>
<li><p>1类外部路由：O E1： LSA5类型1；</p>
</li>
<li><p>2类外部路由：O E2： LSA5类型2；</p>
</li>
<li><p>1类NSSA路由：O N1： LSA7类型1；</p>
</li>
<li><p>2类NSSA路由∶O N2：LSA7类型2。</p>
</li>
</ol>
<p>&emsp;&emsp;注意：O E1绝对优于O E2，O N1绝对优于O N2。而E1之间、E2之间的比较，则需要另做讨论。另外，O E及O N的优选，要看厂商，不同的厂商，优选方式不同。</p>
<h3 id="1-1-O-及O-IA的比较"><a href="#1-1-O-及O-IA的比较" class="headerlink" title="1.1 O 及O IA的比较"></a>1.1 O 及O IA的比较</h3><p><img src="https://s3.ax1x.com/2020/11/16/DEUHj1.png" alt="image-20201115215555698"></p>
<p>&emsp;&emsp;在这个图中，R1同时从R2及R3学习到3.3.3.0的路由，一条是О，一条是OIA，R1将绝对优选R3作为前往3.3.3.0的下一跳，而不看metric。</p>
<h3 id="1-2-O-IA之间的比较"><a href="#1-2-O-IA之间的比较" class="headerlink" title="1.2 O IA之间的比较"></a>1.2 O IA之间的比较</h3><p>&emsp;&emsp;一般来说，O IA之间比较metric，谁小取谁，但是也有特例，如下：</p>
<p><img src="https://s3.ax1x.com/2020/11/16/DEUOHK.png" alt="image-20201115215940616"></p>
<p>&emsp;&emsp;上图中，R2上，能学习到由ABRR1及R3发出的关于路由1.1.1.0的3类LSA，两条路由都是О IA，但是R2将恒定优选R1作为去往1.1.1.0的下一跳，而不管这条路由的metric多大。</p>
<h3 id="1-3-多进程OSPF问题1"><a href="#1-3-多进程OSPF问题1" class="headerlink" title="1.3 多进程OSPF问题1"></a>1.3 多进程OSPF问题1</h3><p><img src="https://s3.ax1x.com/2020/11/16/DEUvND.png" alt="image-20201115220045832"></p>
<p>&emsp;&emsp;同一台路由器，本地如果跑两个OSPF进程，则各自独立，路由信息不会自动相互注入；另外如果同时从两个进程学习到同一条路由，则不管metric如何，先到先用，而不会负载均衡。</p>
<h3 id="1-4-多进程OSPF问题2"><a href="#1-4-多进程OSPF问题2" class="headerlink" title="1.4 多进程OSPF问题2"></a>1.4 多进程OSPF问题2</h3><p><img src="https://s3.ax1x.com/2020/11/16/DEaS9H.png" alt="image-20201115220146896"></p>
<p>&emsp;&emsp;由于是两个OSPF进程，因此依然是先到先得，R1上，如果率先与R2建立邻居关系，那么4.4.4.0的路由在路由表中，仍然是О IA的。即使通过R3过来的是О，但是由于是不同的进程，因此只看谁先来不管metric也不管什么O&gt;O IA&gt;O E1&gt;O E2。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>路由协议</tag>
      </tags>
  </entry>
  <entry>
    <title>OSPF邻居关系建立及维护</title>
    <url>/2020/11/11/OSPF%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E5%8F%8A%E7%BB%B4%E6%8A%A4/</url>
    <content><![CDATA[<p>&emsp;&emsp;OSPF邻居关系的建立是经历了七个不同的状态逐步建立起来的，状态之间的转换以及邻居关系建立后的维护主要通过OSPF的五个报文进行数据的传输。 本篇文章详细介绍了OSPF邻居关系的建立与维护。</p>
<a id="more"></a>

<h2 id="1-邻居建立过程"><a href="#1-邻居建立过程" class="headerlink" title="1 邻居建立过程"></a>1 邻居建立过程</h2><p><img src="https://s3.ax1x.com/2020/11/11/BvWneO.png" alt="image-20201111201619205"></p>
<p>&emsp;&emsp;在初始情况下，A、B 在某个接口激活了OSPF后，都会开始在这个接口上去发组播的Hello包，目的是发现OSPF邻居。Hello包里，有个active neighbor字段，用来存储路由器在某个OSPF接口上发现的邻居。当然，初始情况下，这个Hello包里是不包含任何活跃的邻居的(也就没有active neighbor字段)，因为它谁也没发现。<br>&emsp;&emsp;当OSPF路由器（B）在某个OSPF 接口上收到邻居发来的Hello包（里面没有装active neighbor ），它会记录下A（在自己的OSPF接口数据结构中）并且将 A 的状态视为Init ，然后将A的Router lD存储在自己将要发送的Hello包的active neighbor字段里发送出去，这样 A 就会收到这个Hello包，并且在这个Hello包当中找到自己的Router lD，那么 A 会认为，与 B 已经完成了双边关系的建立，因此 A 会将 B 的邻居状态置为two-way。<br>&emsp;&emsp;与此同时，A 也会继续发送Hello包，并且将B的Router lD放置于Hello包中，而B收到这个Hello包并看见了自己的Router lD后，B 也会将 A 的状态置为Two-way，至此OSPF的第一个稳态就达到了。</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvWKTe.png" alt="image-20201111202300693"></p>
<p>&emsp;&emsp;接下去A、B会进入Ex-start 状态并开始进行master、slave的协商，协商MIS的目的是为了决定在后续的LSA交互中，谁来决定DD的序列号，而Router lD 大的那个OSPF路由器的接口将会成为master，由它来决定DD seq，对端成为slave。这里要注意master不是DR，要注意与DR的概念进行区分。这个协商过程，是由交互DBD包实现的，注意这里使用的是空的DBD包，也就是不包含任何LSA头部的DBD包，这个包当中，有三个位非常关键：I、M、MS。用于Ex-start阶段协商master、slave的DBD包，I 位（或叫做 Init 位）都是置0的；另外MS位如果置1，表示DBD报文始发路由器认为自己的master，当然起初大家都这么认为，在一系列DBD交换后，就会得到选举结果，被选举为slave的OSPF接口，会将发送的DBD包MS位置为0；另外M位表示more，如果一个OSPF接口发送的DBD包M位置1，在表示这不是最后一个DBD，后续还有DBD包待发送。<br>&emsp;&emsp;当OSPF接口收到一个DBD包且其中 I 位置0的时候，它就知道与该邻居的Ex-start阶段已经过去了，于是将邻居的状态置为Exchange，并存储对端发来的DBD包所包含的LSA头部，当然，他自己也发送关于自己OSPF DB的摘要给邻居。如此一来，双方都能通过DBD的交互，了解到对方OSPF DB中的摘要情况。在这个过程中，可能交互数个DBD报文，并要注意，这些报文的 I 位都置0，且M位一般也置0，除非这是某个OSPF接口发送的最后一个DBD包。</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvWlYd.png" alt="image-20201111203911471"></p>
<p>&emsp;&emsp;当Router A收到一个M位置0的DBD包的时候，它就知道，这是邻居发来的最后一个DBD包了，如果它搜集完这个邻居（假设是B）发来的DBD并且发现，这些DBD里有它感兴趣的LSA，它期望更详细的LSA信息时，它将B置为 Loading 状态，并且开始发送LSR报文去请求特定LSA的详细信息。B收到这个LSR后，会以LSU进行回应，其中就包含了对方请求的LSA详细信息，因此，只有在LSU报文中，才能看到LSA的完整信息。收到LSU后，A将LSU中所包含的LSA放进自己的LSDB，并且给B发一个LSACK进行确认。当OSPF接口上所有的待请求的LSA全部收到更新后，它会将邻居置为FULL。至此，OSPF邻接关系的建立达到全毗邻。<br>&emsp;&emsp;在这里我们有个地方需要留意，我们通常说，OSPF 路由器A与B进入了xx状态，其实这句话并不严谨，原因之一，是因为OSPF 是接口敏感型协议，许多的操作都是以OSPF 接口作为立足点去考虑的，譬如邻居关系的建立，再如DR和BDR，我们不能说一台路由器是DR，准确的说，应该是某路由器的某个接口是DR；再者，说两台路由器之间是xx状态，这个也不严谨，所谓的邻居状态，必须是以某台路由器为观察点，在其某个接口上观察到的某个邻居的状态，因此可能出现的一个情况是，在A上，看到的B的状态为Loading，但是在B上，A的状态已经是FULL了。</p>
<h2 id="2-状态机"><a href="#2-状态机" class="headerlink" title="2 状态机"></a>2 状态机</h2><p><strong>1. Down</strong></p>
<p>&emsp;&emsp;在DOWN状态下，OSPF 接口仍然有尝试发现邻居的意愿，因此会不断的发送组播hello包。</p>
<p><strong>2. Init</strong></p>
<p>&emsp;&emsp;当OSPF 接口收到链路上某个邻居发来的第一个Hello包的时候，它会在接口上将该邻居置为 Init 状态，注意这个Hello包中可能并未包含任何的邻居信息。但是这至少证明，我这个OSPF接口在这个链路上，至少有个活跃的邻居。</p>
<p>&emsp;&emsp;下面是一个没有发现任何active neighbor的Hello包：</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvW1fA.png" alt="image-20201111205235674"></p>
<p><strong>3. Two-way</strong></p>
<p>&emsp;&emsp;当OSPF路由器在某个链路上发现了邻居后，它自己发送的Hello包里就会增加active neighbor字段，用于存储在该链路上发现的OSPF邻居。当一台OSPF Router看到自己（的Router lD）出现在邻居发过来的的Hello 分组中，它就会将该邻居置为Two-way。该状态是OSPF 邻居之间可以具有的最基本的关系，也是第一个稳态，但是此时两者还不能共享路由信息。</p>
<p>&emsp;&emsp;下面是一个已经在链路上发现了邻居1.1.1.1的Hello：</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvWJ6P.png" alt="image-20201111205414612"></p>
<p><strong>4. Ex-Start</strong></p>
<p>&emsp;&emsp;一台OSPF路由器在将某个邻居置为Two-way状态后，就开始发送空的DBD包，用于协商master/slave。这个就是 Ex-start 状态。两台Router 间用空的BDB分组确定master和slave关系（注意不是DR和BDR），在DBD包中有3个标记位用来管理邻接关系的建立过程：</p>
<ul>
<li>l位         或称为初始位（Initial bit ）用于Ex-start协商主从关系的初始化协商的DBD包，该位置1</li>
<li>M位       或称为后继位（More bit）如果这不是OSPF Router 发送的最后一个DBD，该位置1</li>
<li>MS位     或称为主/从位（Master / slave bit）如果始发路由器是Master，则该位置1</li>
</ul>
<p>&emsp;&emsp;如果某台OSPF Router收到邻居发来的DBD I 位也就是Init位置0则意味着Ex-start状态结束并且master/slave已经选出来了那么该路由器会将邻居置为Exchange状态开始用包含LSA头部的DBD交换各自的LSBD。下面是一个用于初始化协商的DBD消息：</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvWYOf.png" alt="image-20201111205948163"></p>
<p><strong>5. Exchange</strong></p>
<p>&emsp;&emsp;这个过程，双方使用包含自己LSA头部的DBD报文进行交互，并且将对方发过来的LSA头部、并且自己感兴趣的LSA（或自己没有的LSA）存储在一个本地OSPF 接口的队列里，以便在下一个阶段进行LSA详细信息的请求。当某个OSPF接口收到邻居发来的DBD，M位置0 ，则表示对方已经发完DBD了，与此同时如果该路由器的这个OSPF接口上存在待请求的LSA，那么它会将这个邻居置为Loading状态。</p>
<p>&emsp;&emsp;下面是一个装载了LSA头部的DBD消息：</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvWNm8.png" alt="image-20201111210116338"></p>
<p><strong>6. Loading</strong></p>
<p>&emsp;&emsp;OSPF Router使用LSR去请求LSA的详细信息，对方使用LSU发来更新，因此只有LSU里才有LSA的完整信息。在收到LSU后，一方面本地使用LSACK进行确认，另一方面将LSU 中包含的LSA装载进自己的LSDB。</p>
<p>&emsp;&emsp;以下是一个LSR消息，非常的简单：</p>
<p><img src="https://s3.ax1x.com/2020/11/11/BvW0Yj.png" alt="image-20201111210243739"></p>
<p><strong>7. FULL</strong></p>
<p>&emsp;&emsp;Loading 状态结束后，也就是本地OSPF接口上再没有待更新的LSA队列后，将邻居置为FULL。</p>
<p><strong>8. Attempt</strong></p>
<p>&emsp;&emsp;如果一个路由器，它邻居处于这种状态，则表示它从邻居没有收到任何信息，但是做了努力来与邻居联系。仅在NBMA网络上存在，当NBMA网络上具有DR选取资格的路由器和其邻居路由器相连的接口开始变为有效（Active）时，或者当这台路由器成为DR或BDR时，这台具有DR选取资格的路由器将会把邻居路由器的状态转换到Attempt状态。在Attempt状态下，路由器将使用Hello interval时间代替Poll interval的时间来作为向邻居发送Hello数据包的时间间隔。</p>
<h2 id="3-OSPF邻居关系建立中的问题"><a href="#3-OSPF邻居关系建立中的问题" class="headerlink" title="3 OSPF邻居关系建立中的问题"></a>3 OSPF邻居关系建立中的问题</h2><p><strong>1. MTU问题</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">R1(config-if)<span class="comment">#ip ospf mtu-ignore</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;在接口模式下配置可以忽略MTU，注意是在MTU小的那一个OSPF 路由器接口上（如果两端MTU不一样）</p>
<p><strong>2. 接口掩码问题</strong></p>
<p>&emsp;&emsp;<strong>a)在一个MA网络中，如果邻居两端接口掩码不一致，则邻居建立不起来。</strong></p>
<p><strong>&emsp;&emsp;b)在p2p的网络中，如果邻居两端接口掩码不一致，邻居能建立，并且路由也能学习到。</strong></p>
<p><strong>3. 网络类型问题</strong><br>&emsp;&emsp;两端如果OSPF网络类型不同,那么邻居关系能建立起来，路由器甚至能收到对方的LSA ,但是路由学不到。</p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>OSPF</tag>
        <tag>路由协议</tag>
      </tags>
  </entry>
  <entry>
    <title>vPC术语介绍</title>
    <url>/2021/03/12/vPC%E6%9C%AF%E8%AF%AD%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>&emsp;&emsp;本篇文章主要介绍一些在vPC中常见的一些术语。</p>
<a id="more"></a>

<h3 id="vPC-Domian"><a href="#vPC-Domian" class="headerlink" title="vPC Domian"></a>vPC Domian</h3><ul>
<li>vPC Domain定义参与vPC的一组交换机</li>
<li>定义了全局vPC系统参数</li>
<li>vPC对等体设备使用vPC Domain ID自动指派一个唯一的vPC系统MAC地址</li>
<li>在比邻的二层区域的所有vPC对，必须使用唯一的Domain lD。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6Uwcd0.png" alt="image-20210301135251504"></p>
<p><img src="https://s3.ax1x.com/2021/03/12/6Uwbo6.png" alt="image-20210301135322300"></p>
<h3 id="System-MAC"><a href="#System-MAC" class="headerlink" title="System MAC"></a>System MAC</h3><ul>
<li>LACP邻居看到两个vPC对等体有相同的System ID</li>
<li>vPC的“System MAC”被两个vPC对等体使用</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UBy5V.png" alt="image-20210301135716155"></p>
<ul>
<li>vPC对等体对于邻居而言呈现为一个独立的设备</li>
<li>本地“System-MAC”用于所有的非vPC PDUs（LACP，STP，…）</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0eyj.png" alt="image-20210301140141170"></p>
<h3 id="vPC-Role"><a href="#vPC-Role" class="headerlink" title="vPC Role"></a>vPC Role</h3><ul>
<li>vPC根据Priority（优先级）选举Primary交换机。</li>
<li>低优先级的交换机会胜出，如果优先级一样，低的system mac会胜出。</li>
<li>Role（角色）是不能抢占的，因此应该关注Operational Role（操作角色）。</li>
<li>操作角色可能与在Domain（域）下配置的优先级有所不同。</li>
<li>vPC的角色决定了具体是那个vPC对等体来处理BPDUs。</li>
<li>角色会影响当Peer Link失效后的行为。</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0lkV.png" alt="image-20210301140610280"></p>
<h3 id="vPC-Peer-Link"><a href="#vPC-Peer-Link" class="headerlink" title="vPC Peer Link"></a>vPC Peer Link</h3><ul>
<li><p>基本特性介绍：</p>
<ul>
<li><p>标准的802.1Q Trunk</p>
</li>
<li><p>能够承载vPC和非vPC的VLAN</p>
</li>
<li><p>承载CFS信息（为了保障可靠的通讯，设置标签为CoS=4）</p>
</li>
<li><p>承载来自于vPC对等体的泛洪流量</p>
</li>
<li><p>承载 STP BPDUs，HSRP Hellos和IGMP updates等等流量</p>
</li>
</ul>
</li>
<li><p>需求：</p>
<ul>
<li><p>vPC Peer Link的成员端口必须是10GE接口</p>
</li>
<li><p>vPC Peer Link是点对点链路，在vPC对等体之间不能插入其它设备</p>
</li>
</ul>
</li>
<li><p>推荐：</p>
<ul>
<li>为了冗余，至少需要两个分布在不同接口卡上的10GE接口</li>
<li>使用（Dedicated）专用10GE端口（不要使用共享端口）</li>
</ul>
</li>
</ul>
<p>PS：最好分离vPC和非vPC VLANs在不同的交换机之间的Port-Channel上。</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0GpF.png" alt="image-20210312140707877"></p>
<h3 id="vPC-Peer-Link故障检测"><a href="#vPC-Peer-Link故障检测" class="headerlink" title="vPC Peer Link故障检测"></a>vPC Peer Link故障检测</h3><p>&emsp;&emsp;当vPC Peer-Link 故障（连接丢失），交换机通过vPC Peer-Keepalive Link的心跳信息，检查远端vPC对等体的状态。如果两个对等体都处于“Active”状态，Secondary（次要）vPC对等体会禁用所有的vPC来避免双Active的状况，数据依然能够通过剩余的Port-Channel的Active端口来转发数据。当CFS信息故障或者UDLD连接状态检查失效时，产生故障切换。</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0dTx.png" alt="image-20210312141854339"></p>
<h3 id="vPC-Peer-Keepalive-Link"><a href="#vPC-Peer-Keepalive-Link" class="headerlink" title="vPC Peer Keepalive Link"></a>vPC Peer Keepalive Link</h3><ul>
<li>基本特性介绍：<ul>
<li>在vPC对等体间发送心跳信息</li>
<li>在Peer-Link失效的情况下，检查vPC是否Active/Active</li>
<li>信息发送间隔为1秒</li>
<li>当Peer-Link失效后，有3秒的Hold超时时间，超时时间默认为5秒</li>
</ul>
</li>
<li>包结构：<ul>
<li>UDP/3200，长度为96字节（32字节负载长度），包括版本，时间戳，本地和远端IP地址，和domain ID。</li>
<li>Keepalive信息可以通过板载的Wireshark工具进行捕获和显示。</li>
</ul>
</li>
<li>推荐：<ul>
<li>应该是一条专用链路（1Gb就足够了）</li>
<li>千万不要通过Peer-Link进行转发</li>
<li>可以使用mgmt0接口（和管理流量走在一起）</li>
<li>作为最后的方案，可以通过三层架构进行路由</li>
</ul>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0UmR.png" alt="image-20210312141313207"></p>
<h3 id="vPC-Peer-Keepalive-Link注意事项"><a href="#vPC-Peer-Keepalive-Link注意事项" class="headerlink" title="vPC Peer Keepalive Link注意事项"></a>vPC Peer Keepalive Link注意事项</h3><p>&emsp;&emsp;当使用引擎的管理接口来承载vPC Peer Keepalive信息时，不要在两个交换机之间直接进行连接。因为同一时间只能有一个管理接口处于active状态，如果引擎出现故障切换，就会阻断Keep-alive连接。当存在带外网管网络时，才可以考虑管理接口作为Peer Keepalive Link（在vPC对等体之间存在管理交换机）</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6U0vNV.png" alt="image-20210312141617506"></p>
<h3 id="vPC-Member-Port"><a href="#vPC-Member-Port" class="headerlink" title="vPC Member Port"></a>vPC Member Port</h3><ul>
<li>基本特性介绍：<ul>
<li>vPC对等体的Port-channel成员</li>
</ul>
</li>
<li>需求：<ul>
<li>两个vPC对等体的成员端口的配置需要匹配</li>
<li>不一致的VLAN或者整个Port-Channel将会被挂起（例如不匹配的MTU）</li>
<li>两个vPC对等体的成员端口的数量不需要一样</li>
<li>在两个vPC对等体间最多能够有8个active的成员端口（如果使用多层的vPC最多可以支持16路的Port-Channel）</li>
</ul>
</li>
</ul>
<p><img src="https://s3.ax1x.com/2021/03/12/6UBkH1.png" alt="image-20210312142047657"></p>
<h3 id="vPC-与-VDC"><a href="#vPC-与-VDC" class="headerlink" title="vPC 与 VDC"></a>vPC 与 VDC</h3><ul>
<li>vPC与VDC：<ul>
<li>vPC可以工作在VDC环境</li>
<li>每一个VDC只能够支持一个vPC Domain</li>
<li>在每一个VDC部署中，依然需要使用分离的Peer-Link和Peer-Keepalive Link</li>
</ul>
</li>
<li>vPC是否能够运行在一个交换机内的两个VDC之间？<ul>
<li>在技术上是可以支持的，但是并不被官方支持</li>
<li>可以作为实验和练习使用，但是强烈不推荐在工作环境使用，因为这样就人为造成了单点故障。</li>
</ul>
</li>
</ul>
<h3 id="vPC-Peer-Gateway"><a href="#vPC-Peer-Gateway" class="headerlink" title="vPC Peer-Gateway"></a>vPC Peer-Gateway</h3><p>&emsp;&emsp;允许一个vPC交换机，为那些去往对端路由器MAC的数据包扮演一个active网关。从而保持使用本地vPC节点，在本地转发流量。避免使用Peer-Link；不会影响流量和现有架构；允许和一些NAS和负载均衡器的特性进行互操作。</p>
<p>&emsp;&emsp;推荐激活这个特性</p>
<p><img src="https://s3.ax1x.com/2021/03/12/6UBZ4K.png" alt="image-20210312143704824"></p>
]]></content>
      <categories>
        <category>学习笔记</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
        <tag>vPC</tag>
      </tags>
  </entry>
  <entry>
    <title>安恒杯四月月赛misc——Writeup</title>
    <url>/2020/04/27/%E5%AE%89%E6%81%92%E6%9D%AF%E5%9B%9B%E6%9C%88%E6%9C%88%E8%B5%9B%E2%80%94%E2%80%94Writeup/</url>
    <content><![CDATA[<p>&emsp;&emsp;内存取证还是蛮有意思的呀！</p>
<h3 id="1-6G还远吗？"><a href="#1-6G还远吗？" class="headerlink" title="1.6G还远吗？"></a>1.6G还远吗？</h3><p>​        文件下载下来，速度特别慢，但是在文件夹中用记事本打开即可发现flag。<a id="more"></a></p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYltI.png" alt="0"></p>
<h3 id="2-blueshark"><a href="#2-blueshark" class="headerlink" title="2.blueshark"></a>2.blueshark</h3><p>​        在协议中搜索OBEX协议可以发现传输了一个what_you_want.7z文件。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYG1f.png" alt="01"></p>
<p>​        将what_you_want.7z导出，发现需要密码。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYJc8.png" alt="img"></p>
<p>​        根据文件名的提示找到pin，解压获得flag。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYa7j.png" alt="img"></p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqY0Nn.png" alt="img"></p>
<h3 id="3-keyboard"><a href="#3-keyboard" class="headerlink" title="3.keyboard"></a>3.keyboard</h3><p>​        解压后发现是一个Secret和一个Keyboard.raw。首先用010 Editor打开Secret，里面都是乱码，猜测可能是加密文件。</p>
<p>​        因此我们用kali自带的内存取证工具volatility对该内存进行操作。</p>
<p>​        首先获取该内存的配置文件</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYs3V.png"></p>
<p>​        查看进程，发现其使用了VeraCrypt，这说明之前的猜想是正确的，Secret是一个加密的磁盘文件。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqY6jU.png"></p>
<p>​        因此我们要寻找一个密码来对磁盘进行解密，我们在进程中找到了keyboard-log，因此使用filescan扫描文件，发现了t.txt文件。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqY2B4.png"></p>
<p>​        将其导出</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYfE9.png"></p>
<p>​        将文件打开后，发现密文，根据提示确定是qwe密码。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqY441.png"></p>
<p>​        解密得到磁盘密码<strong>KEYBOARDDRAOBYEK</strong>，使用VeraCrypt进行解密并挂载，获得here.vhd文件。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYo36.png"></p>
<p>​        用winhex打开即可找到flag。</p>
<p><img src="https://s1.ax1x.com/2020/08/30/dqYTgK.png"></p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>ctf</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络参考模型</title>
    <url>/2019/01/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<p>&emsp;&emsp;在计算机的网络中，有两个十分重要的参考模型，所有网络通信设备都是以参考模型为标准来研发的。因此熟知参考模型在学习网络知识的过程中是十分重要的。下面就简单的介绍一下两个参考模型。</p>
<a id="more"></a>

<p><strong>一、OSI参考模型</strong></p>
<p>&emsp;&emsp;OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互联模型。</p>
<p>&emsp;&emsp;它将网络划分成了七层，从下往依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。</p>
<p>&emsp;&emsp;第一层<strong>物理层（physical layer）</strong>的主要功能:是完成相邻节点之间原始比特流的传输物理层的设计主要涉及物理接口的机械电气功能和过程特性，以及物理层接口连接的传输介质等问题。</p>
<p>&emsp;&emsp;第二层<strong>数据链路层（data link layer）</strong>负责将上层数据封装成固定格式的帧</p>
<p>&emsp;&emsp;第三层<strong>网络层(network layer）</strong>的主要功能:是实现数据从源端到目的端的传输</p>
<p>&emsp;&emsp;第四层<strong>传输层（transport layer）</strong>的主要功能:是实现网络中不同主机上用户进程之间的数据通信。</p>
<p>&emsp;&emsp;第五层<strong>会话层（session layer）</strong>允许不同机器上的用户之间建立会话关系。管理会话控制令牌管理（token management）数据中插入同步点</p>
<p>&emsp;&emsp;第六层<strong>表示层（presentation layer ）</strong>表示层以下各层只关心从源端机到目标机可靠地传输比特，而表示层关心的是所传输的语法和语义。用一种大家一致选定的标准方法对数据进行编码。同时，也能提供压缩解压、加密解密。</p>
<p>&emsp;&emsp;第七层<strong>应用层（application layer）</strong>应用层能与应用程序界面沟通，以达到展示给用户的目的。在此常见的协议有:HTTP，HTTPS，FTP，TELNET，SSH，SMTP，POP3等。</p>
<p>&emsp;&emsp;传输层要决定对会话层用户（最终的网络用户）提供什么样的服务。因此我们把1-3层的协议称为点对点的协议，而把4-7层的协议叫做端对端协议。</p>
<p><strong>二、TCP/IP参考模型</strong></p>
<p>&emsp;&emsp;TCP/IP参考模型是计算机网络的祖父ARPANET和其后续的因特网使用的参考模型。当无线网络和卫星出现以后，现有的协议在和它们相连的时候出现了问题，所以需要一种新的参考体系结构。这个体系结构在它的两个主要协议出现以后，被称为TCP/IP参考模型。</p>
<p>&emsp;&emsp;TCP/IP是如今用于现实网络互联的通信协议。TCP/IP参考模型以TCP/IP为核心，将协议分成四个层次，分别是：网络接口层、网路层、传输层、应用层。</p>
<p>&emsp;&emsp;但是由于TCP/IP的网络接口层并未定义该层的协议，且参与互联的各网络使用自己的物理层和数据链路层协议，然后与TCP/IP的网络接入层（即网络层）进行连接。所以后期的TCP/IP参考模型为五层：即将网络接口层分为物理层和数据链路层。</p>
<p>第一层<strong>网络接入层</strong></p>
<p>&emsp;&emsp;该层提供的服务与OSI参考模型中的物理层与数据链路层相对应。它负责监视数据在主机和网络之间的交换。事实上，TCP/IP本身并未定义该层的协议，而由参与互连的各网络使用自己的物理层和数据链路层协议，然后与TCP/IP的网络接入层进行连接。地址解析协议（ARP）工作在此层，即OSI参考模型的数据链路层。在前文也说过TCP/IP参考模型并未定义网络接入层的协议，又因为TCP/IP参考模型的广泛应用，所以为了方便理解网络接入层采用了OSI参考模型的物理层和数据链路层的定义。</p>
<p>第二层<strong>网络层</strong>  </p>
<p>&emsp;&emsp;网际互联层对应于OSI参考模型的网络层，主要解决主机到主机的通信问题。它所包含的协议设计数据包在整个网络上的逻辑传输。注重重新赋予主机一个IP地址来完成对主机的寻址，它还负责数据包在多种网络中的路由。该层有三个主要协议：网际协议（IP）、互联网组管理协议（IGMP）和互联网控制报文协议（ICMP）。</p>
<p>第三层<strong>传输层</strong></p>
<p>&emsp;&emsp;传输层对应于OSI参考模型的传输层，为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。该层定义了两个主要的协议：传输控制协议（TCP）和用户数据报协议（UDP)。</p>
<p>&emsp;&emsp;TCP协议提供的是一种可靠的、通过“三次握手”来连接的数据传输服务；而UDP协议提供的则是不保证可靠的（并不是不可靠）、无连接的数据传输服务。</p>
<p>第四层<strong>应用层</strong></p>
<p>&emsp;&emsp;应用层对应于OSI参考模型的高层，为用户提供所需要的各种服务，例如：FTP、Telnet、DNS、SMTP等。</p>
<p>&emsp;&emsp;以上就是计算机网络模型的大致内容，下面简单写下OSI参考模型和TCP/IP参考模型的<strong>异同点</strong>：</p>
<p><strong>共同点：</strong></p>
<p>&emsp;&emsp;（1）OSI参考模型和TCP/IP参考模型都采用了层次结构的概念。</p>
<p>&emsp;&emsp;（2）都能够提供面向连接和无连接两种通信服务机制。</p>
<p><strong>不同点：</strong></p>
<p>&emsp;&emsp;（1）OSI采用的七层模型，而TCP/IP是四层结构。</p>
<p>&emsp;&emsp;（2）TCP/IP参考模型的网络接口层实际上并没有真正的定义，只是一些概念性的描述。而OSI参考模型不仅分了两层，而且每一层的功能都很详尽，甚至在数据链路层又分出一个介质访问子层，专门解决局域网的共享介质问题。</p>
<p>&emsp;&emsp;（3）OSI模型是在协议开发前设计的，具有通用性。TCP/IP是先有协议集然后建立模型，不适用于非TCP/IP网络。</p>
<p>&emsp;&emsp;（4）OSI参考模型与TCP/IP参考模型的传输层功能基本相似，都是负责为用户提供真正的端对端的通信服务，也对高层屏蔽了底层网络的实现细节。所不同的是TCP/IP参考模型的传输层是建立在网络互联层基础之上的，而网络互联层只提供无连接的网络服务，所以面向连接的功能完全在TCP协议中实现，当然TCP/IP的传输层还提供无连接的服务，如UDP；相反OSI参考模型的传输层是建立在网络层基础之上的，网络层既提供面向连接的服务，又提供无连接的服务，但传输层只提供面向连接的服务。</p>
<p>&emsp;&emsp;（5）OSI参考模型的抽象能力高，适合与描述各种网络；而TCP/IP是先有了协议，才制定TCP/IP模型的。</p>
<p>&emsp;&emsp;（6）OSI参考模型的概念划分清晰，但过于复杂；而TCP/IP参考模型在服务、接口和协议的 区别上不清楚，功能描述和实现细节混在一起。</p>
<p>&emsp;&emsp;（7）TCP/IP参考模型的网络接口层并不是真正的一层；OSI参考模型的缺点是层次过多，划分意义不大但增加了复杂性。</p>
<p>&emsp;&emsp;（8）OSI参考模型虽然被看好，由于没把握好时机，技术不成熟，实现困难；相反，TCP/IP参考模型虽然有许多不尽人意的地方，但还是比较成功的。</p>
<p>&emsp;&emsp;本篇本章只是作者在学习过程中整理的一些笔记。仅仅对计算机网络参考模型做了简单的介绍，概念的定义是网上收集的一些资料。因此如果想要更深入学习计算机网络参考模型，可以查找更专业的书籍。</p>
]]></content>
      <categories>
        <category>网络基础</category>
      </categories>
      <tags>
        <tag>CCNA</tag>
        <tag>网络与数据通信</tag>
      </tags>
  </entry>
</search>
